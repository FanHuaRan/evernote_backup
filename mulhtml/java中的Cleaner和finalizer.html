<html>
<head>
  <title>java中的Cleaner和finalizer</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="901"/>
<h1>java中的Cleaner和finalizer</h1>

<div>
<span><div>finalizer就是我们重写finalize方法后，垃圾回收时标记的载体，可以用于资源释放和对象自我拯救（只能）。</div><div>Cleaner实际上是一个Reference的子类，可以注册到一个对象上（registe方法），注册以后，Cleaner的referent引用就会指向该对象，所以当该对象只有几个特殊引用可达（软、弱、虚、cleaner）且经过垃圾收集器的GC标记，ReferenceHandler线程将调用其Clean方法，而Clean方法实际上是一个调用一个回调对象（runnable）。典型用例：DirectBuffer内部的直接内存回收。</div><div><br/></div><div>见Cleaner文档：</div><div style="clear: both; margin: 0px 20px; padding: 5px 0px 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="margin: 5px 0px 0px;"><span style="font-size: 14px; color: rgb(53, 56, 51); font-family: &quot;DejaVu Sans&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">Module</span><span style="font-size: 14px; color: rgb(53, 56, 51); font-family: &quot;DejaVu Sans&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><a href="https://docs.oracle.com/javase/9/docs/api/java.base-summary.html" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">java.base</a></div><div style="margin: 5px 0px 0px;"><span style="font-size: 14px; color: rgb(53, 56, 51); font-family: &quot;DejaVu Sans&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">Package</span><span style="font-size: 14px; color: rgb(53, 56, 51); font-family: &quot;DejaVu Sans&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/ref/package-summary.html" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">java.lang.ref</a></div><h2 style="font-size: 18px; margin: 10px 0px;" title="Class Cleaner"><span style="font-size: 18px; color: rgb(44, 69, 87); font-family: &quot;DejaVu Sans&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;" title="Class Cleaner">Class Cleaner</span></h2></div><div><div><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Object.html" style="color: rgb(74, 103, 130);" title="class in java.lang">java.lang.Object</a>java.lang.ref.Cleaner</div><ul style="list-style-type: disc; margin: 10px 0px; padding: 0px;"><li style="list-style: none; margin-bottom: 15px;"><br/><span style="line-height: 1.4;">public final class</span> <span style="font-weight: bold; line-height: 1.4;">Cleaner</span><br/><span style="line-height: 1.4;">extends</span> <a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Object.html" style="color: rgb(74, 103, 130); line-height: 1.4;" title="class in java.lang">Object</a><br/><br/><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">Cleaner</span><span style="line-height: 1.4;"> manages a set of object references and corresponding cleaning actions.</span><br/><span style="line-height: 1.4;">Cleaning actions are </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/ref/Cleaner.html#register-java.lang.Object-java.lang.Runnable-" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;-en-paragraph:true;">registered</a><span style="line-height: 1.4;"> to run after the cleaner is notified that the object has become phantom reachable. The cleaner uses </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/ref/PhantomReference.html" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;-en-paragraph:true;" title="class in java.lang.ref">PhantomReference</a><span style="line-height: 1.4;"> and </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/ref/ReferenceQueue.html" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;-en-paragraph:true;" title="class in java.lang.ref">ReferenceQueue</a><span style="line-height: 1.4;"> to be notified when the </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/ref/package-summary.html#reachability" style="color: rgb(74, 103, 130); line-height: 1.4;-en-paragraph:true;">reachability</a><span style="line-height: 1.4;">changes.</span><br/><span style="line-height: 1.4;">Each cleaner operates independently, managing the pending cleaning actions and handling threading and termination when the cleaner is no longer in use. Registering an object reference and corresponding cleaning action returns a </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/ref/Cleaner.Cleanable.html" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;-en-paragraph:true;" title="interface in java.lang.ref">Cleanable</a><span style="line-height: 1.4;">. The most efficient use is to explicitly invoke the </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/ref/Cleaner.Cleanable.html#clean--" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;-en-paragraph:true;">clean</a><span style="line-height: 1.4;"> method when the object is closed or no longer needed. The cleaning action is a </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Runnable.html" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;-en-paragraph:true;" title="interface in java.lang">Runnable</a><span style="line-height: 1.4;"> to be invoked at most once when the object has become phantom reachable unless it has already been explicitly cleaned. Note that the cleaning action must not refer to the object being registered. If so, the object will not become phantom reachable and the cleaning action will not be invoked automatically.</span><br/><span style="line-height: 1.4;">The execution of the cleaning action is performed by a thread associated with the cleaner. All exceptions thrown by the cleaning action are ignored. The cleaner and other cleaning actions are not affected by exceptions in a cleaning action. The thread runs until all registered cleaning actions have completed and the cleaner itself is reclaimed by the garbage collector.</span><br/><span style="line-height: 1.4;">The behavior of cleaners during </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/System.html#exit-int-" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;-en-paragraph:true;">System.exit</a><span style="line-height: 1.4;"> is implementation specific. No guarantees are made relating to whether cleaning actions are invoked or not.</span><br/><span style="line-height: 1.4;">Unless otherwise noted, passing a </span><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;-en-paragraph:true;">null</span><span style="line-height: 1.4;"> argument to a constructor or method in this class will cause a </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/NullPointerException.html" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;-en-paragraph:true;" title="class in java.lang">NullPointerException</a><span style="line-height: 1.4;"> to be thrown.</span><br/><div><br/></div><div><br/></div><div><span style="font-weight: bold; line-height: 1.4;">API Note:</span></div><div><br/></div><br/><dl><dd><span style="line-height: 1.4;">The cleaning action is invoked only after the associated object becomes phantom reachable, so it is important that the object implementing the cleaning action does not hold references to the object. In this example, a static class encapsulates the cleaning state and action. An &quot;inner&quot; class, anonymous or not, must not be used because it implicitly contains a reference to the outer instance, preventing it from becoming phantom reachable. The choice of a new cleaner or sharing an existing cleaner is determined by the use case.</span></dd><dd><div style="margin-top: 1em; margin-bottom: 1em;"><span style="line-height: 1.4;">If the CleaningExample is used in a try-finally block then the </span><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;-en-paragraph:true;">close</span><span style="line-height: 1.4;"> method calls the cleaning action. If the </span><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;-en-paragraph:true;">close</span><span style="line-height: 1.4;"> method is not called, the cleaning action is called by the Cleaner when the CleaningExample instance has become phantom reachable.</span></div><div style="font-size: 14px; margin-top: 0px;"><div><br/></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">public class CleaningExample implements AutoCloseable {</span></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">// A cleaner, preferably one shared within a library</span></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">private static final Cleaner cleaner = &lt;cleaner&gt;;</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">static class State implements Runnable {</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">State(...) {</span></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">// initialize State needed for cleaning action</span></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">}</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">public void run() {</span></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">// cleanup action accessing State, executed at most once</span></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">}</span></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">}</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">private final State;</span></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">private final Cleaner.Cleanable cleanable</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">public CleaningExample() {</span></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">this.state = new State(...);</span></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">this.cleanable = cleaner.register(this, state);</span></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">}</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">public void close() {</span></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">cleanable.clean();</span></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">}</span></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">}</span></div></div></dd><dd><span style="line-height: 1.4;">The cleaning action could be a lambda but all too easily will capture the object reference, by referring to fields of the object being cleaned, preventing the object from becoming phantom reachable. Using a static nested class, as above, will avoid accidentally retaining the object reference.</span></dd><dd><div style="margin-top: 1em; margin-bottom: 1em;"><span style="line-height: 1.4;"> Cleaning actions should be prepared to be invoked concurrently with other cleaning actions. Typically the cleaning actions should be very quick to execute and not block. If the cleaning action blocks, it may delay processing other cleaning actions registered to the same cleaner. All cleaning actions registered to a cleaner should be mutually compatible.</span></div><div><br/></div><div><span style="font-weight: bold; line-height: 1.4;">Since:</span></div><div><span style="line-height: 1.4;">9</span></div></dd></dl></li><li style="list-style: none; margin-bottom: 15px; padding: 0px 20px 5px 10px; border: 1px solid rgb(237, 237, 237); background-color: rgb(248, 248, 248);"><span style="font-size: 16px; font-style: italic; line-height: 1.4;">Nested Class Summary</span></li><table style="border-spacing: 0px; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 503px;"></col><col style="width: 503px;"></col><col style="width: 503px;"></col></colgroup><tbody><tr><td style="vertical-align: top; text-align: left; white-space: nowrap; font-size: 13px; background-color: rgb(222, 227, 233); border: 1px solid rgb(204, 204, 204); width: 503px; padding: 8px;"><div><span style="font-size: 13px;">Modifier and Type</span></div></td><td style="vertical-align: top; text-align: left; font-size: 13px; background-color: rgb(222, 227, 233); border: 1px solid rgb(204, 204, 204); width: 503px; padding: 8px;"><div><span style="font-size: 13px;">Class</span></div></td><td style="vertical-align: top; text-align: left; font-size: 13px; background-color: rgb(222, 227, 233); border: 1px solid rgb(204, 204, 204); width: 503px; padding: 8px;"><div><span style="font-size: 13px;">Description</span></div></td></tr><tr style="background-color: rgb(255, 255, 255);"><td style="text-align: left; vertical-align: top; white-space: nowrap; font-size: 13px; border: 1px solid rgb(204, 204, 204); width: 503px; padding: 8px;"><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">static interface </span></div></td><td style="vertical-align: top; text-align: left; font-size: 13px; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 503px; padding: 8px;"><div><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/ref/Cleaner.Cleanable.html" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-weight: bold; line-height: 1.4em;" title="interface in java.lang.ref">Cleaner.Cleanable</a></div></td><td style="text-align: left; vertical-align: top; font-size: 13px; border: 1px solid rgb(204, 204, 204); width: 503px; padding: 8px;"><div style="margin: 3px 10px 2px 0px; font-size: 14px; padding-top: 0px;"><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">Cleanable</span><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;"> </span><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;">represents an object and a cleaning action registered in a</span><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;"> </span><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">Cleaner</span><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;">.</span></div></td></tr></tbody></table><li style="list-style: none; margin-bottom: 15px; padding: 0px 20px 5px 10px; border: 1px solid rgb(237, 237, 237); background-color: rgb(248, 248, 248);"><span style="font-size: 16px; font-style: italic; line-height: 1.4;">Method Summary</span></li><table style="border-spacing: 0px; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 503px;"></col><col style="width: 503px;"></col><col style="width: 503px;"></col></colgroup><tbody><tr><td style="vertical-align: top; text-align: left; white-space: nowrap; font-size: 13px; background-color: rgb(222, 227, 233); border: 1px solid rgb(204, 204, 204); width: 503px; padding: 8px;"><div><span style="font-size: 13px;">Modifier and Type</span></div></td><td style="vertical-align: top; text-align: left; font-size: 13px; background-color: rgb(222, 227, 233); border: 1px solid rgb(204, 204, 204); width: 503px; padding: 8px;"><div><span style="font-size: 13px;">Method</span></div></td><td style="vertical-align: top; text-align: left; font-size: 13px; background-color: rgb(222, 227, 233); border: 1px solid rgb(204, 204, 204); width: 503px; padding: 8px;"><div><span style="font-size: 13px;">Description</span></div></td></tr><tr style="background-color: rgb(255, 255, 255);"><td style="text-align: left; vertical-align: top; white-space: nowrap; font-size: 13px; border: 1px solid rgb(204, 204, 204); width: 503px; padding: 8px;"><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">static</span><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/ref/Cleaner.html" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-weight: bold; line-height: 1.4em;" title="class in java.lang.ref">Cleaner</a></div></td><td style="vertical-align: top; text-align: left; font-size: 13px; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 503px; padding: 8px;"><div><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/ref/Cleaner.html#create--" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-weight: bold; line-height: 1.4em;">create</a><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-weight: normal; line-height: 1.4em;">()</span></div></td><td style="text-align: left; vertical-align: top; font-size: 13px; border: 1px solid rgb(204, 204, 204); width: 503px; padding: 8px;"><div style="margin: 3px 10px 2px 0px; font-size: 14px; padding-top: 0px;"><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;">Returns a new</span><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;"> </span><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">Cleaner</span><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;">.</span></div></td></tr><tr style="background-color: rgb(238, 238, 239);"><td style="text-align: left; vertical-align: top; white-space: nowrap; font-size: 13px; border: 1px solid rgb(204, 204, 204); width: 503px; padding: 8px;"><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">static</span><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/ref/Cleaner.html" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-weight: bold; line-height: 1.4em;" title="class in java.lang.ref">Cleaner</a></div></td><td style="vertical-align: top; text-align: left; font-size: 13px; background-color: rgb(238, 238, 239); border: 1px solid rgb(204, 204, 204); width: 503px; padding: 8px;"><div><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/ref/Cleaner.html#create-java.util.concurrent.ThreadFactory-" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-weight: bold; line-height: 1.4em;">create</a><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-weight: normal; line-height: 1.4em;">(</span><a href="https://docs.oracle.com/javase/9/docs/api/java/util/concurrent/ThreadFactory.html" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-weight: bold; line-height: 1.4em;" title="interface in java.util.concurrent">ThreadFactory</a><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-weight: normal; line-height: 1.4em;"> threadFactory)</span></div></td><td style="text-align: left; vertical-align: top; font-size: 13px; border: 1px solid rgb(204, 204, 204); width: 503px; padding: 8px;"><div style="margin: 3px 10px 2px 0px; font-size: 14px; padding-top: 0px;"><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;">Returns a new</span><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;"> </span><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">Cleaner</span><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;"> </span><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;">using a</span><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;"> </span><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">Thread</span><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;"> </span><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;">from the</span><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;"> </span><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">ThreadFactory</span><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;">.</span></div></td></tr><tr style="background-color: rgb(255, 255, 255);"><td style="text-align: left; vertical-align: top; white-space: nowrap; font-size: 13px; border: 1px solid rgb(204, 204, 204); width: 503px; padding: 8px;"><div><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/ref/Cleaner.Cleanable.html" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-weight: bold; line-height: 1.4em;" title="interface in java.lang.ref">Cleaner.Cleanable</a></div></td><td style="vertical-align: top; text-align: left; font-size: 13px; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 503px; padding: 8px;"><div><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/ref/Cleaner.html#register-java.lang.Object-java.lang.Runnable-" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-weight: bold; line-height: 1.4em;">register</a><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-weight: normal; line-height: 1.4em;">(</span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Object.html" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-weight: bold; line-height: 1.4em;" title="class in java.lang">Object</a><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-weight: normal; line-height: 1.4em;"> obj,</span><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-weight: normal; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Runnable.html" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-weight: bold; line-height: 1.4em;" title="interface in java.lang">Runnable</a><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-weight: normal; line-height: 1.4em;"> action)</span></div></td><td style="text-align: left; vertical-align: top; font-size: 13px; border: 1px solid rgb(204, 204, 204); width: 503px; padding: 8px;"><div style="margin: 3px 10px 2px 0px; font-size: 14px; padding-top: 0px;"><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;">Registers an object and a cleaning action to run when the object becomes phantom reachable.</span></div></td></tr></tbody></table><ul style="list-style-type: disc; margin: 10px 0px; padding: 0px;"><li style="list-style: none; margin-bottom: 15px; padding: 0px 0px 5px 8px; border: none; background-color: rgb(255, 255, 255);"><span style="font-size: 16px; background-color: rgb(222, 227, 233); border: 1px solid rgb(208, 217, 224); line-height: 1.4;">Methods inherited from class java.lang.</span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Object.html" style="font-size: 16px; background-color: rgb(222, 227, 233); border: 1px solid rgb(208, 217, 224); color: rgb(74, 103, 130); line-height: 1.4;" title="class in java.lang">Object</a><br/><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Object.html#clone--" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">clone</a><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">,</span><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Object.html#equals-java.lang.Object-" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">equals</a><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">,</span><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Object.html#finalize--" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">finalize</a><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">,</span><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Object.html#getClass--" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">getClass</a><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">,</span><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Object.html#hashCode--" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">hashCode</a><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">,</span><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Object.html#notify--" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">notify</a><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">,</span><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Object.html#notifyAll--" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">notifyAll</a><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">,</span><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Object.html#toString--" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">toString</a><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">,</span><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Object.html#wait--" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">wait</a><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">,</span><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Object.html#wait-long-" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">wait</a><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">,</span><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Object.html#wait-long-int-" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">wait</a></li></ul><li style="list-style: none; margin-bottom: 15px; padding: 0px 20px 5px 10px; border: 1px solid rgb(237, 237, 237); background-color: rgb(248, 248, 248);"><span style="font-size: 16px; font-style: italic; line-height: 1.4;">Method Detail</span></li><ul style="list-style-type: disc; margin: 10px 0px; padding: 0px;"><li style="list-style: none; margin-bottom: 15px; padding: 0px 0px 5px 8px; border: none; background-color: rgb(255, 255, 255);"><div><span style="font-size: 13px; background-color: rgb(222, 227, 233); border: 1px solid rgb(208, 217, 224); line-height: 1.4;">create</span></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4;">public static</span> <a href="https://docs.oracle.com/javase/9/docs/api/java/lang/ref/Cleaner.html" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4;" title="class in java.lang.ref">Cleaner</a> <span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4;">create()</span></div><br/><br/><span style="line-height: 1.4;">Returns a new </span><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">Cleaner</span><span style="line-height: 1.4;">.</span><br/><span style="line-height: 1.4;">The cleaner creates a </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Thread.html#setDaemon-boolean-" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;-en-paragraph:true;">daemon thread</a><span style="line-height: 1.4;"> to process the phantom reachable objects and to invoke cleaning actions. The </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Thread.html#getContextClassLoader--" style="color: rgb(74, 103, 130); line-height: 1.4;-en-paragraph:true;">context class loader</a><span style="line-height: 1.4;"> of the thread is set to the </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/ClassLoader.html#getSystemClassLoader--" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;-en-paragraph:true;">system class loader</a><span style="line-height: 1.4;">. The thread has no permissions, enforced only if a </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/System.html#setSecurityManager-java.lang.SecurityManager-" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;-en-paragraph:true;">SecurityManager is set</a><span style="line-height: 1.4;">.</span><br/><span style="line-height: 1.4;">The cleaner terminates when it is phantom reachable and all of the registered cleaning actions are complete.</span><br/><div><br/></div><div><br/></div><div><span style="font-weight: bold; line-height: 1.4;">Returns:</span></div><div><span style="line-height: 1.4;">a new </span><span style="font-size: 14px; margin-top: 8px; padding-top: 4px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">Cleaner</span></div><div><span style="font-weight: bold; line-height: 1.4;">Throws:</span></div><code style="font-size: 14px; padding-top: 4px; margin-top: 8px;"><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/SecurityException.html" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em; text-decoration: none;" title="class in java.lang">SecurityException</a></code><span style="line-height: 1.4;"> - if the current thread is not allowed to create or start the thread.</span></li><li style="list-style: none; margin-bottom: 15px; padding: 0px 0px 5px 8px; border: none; background-color: rgb(255, 255, 255);"><div><span style="font-size: 13px; background-color: rgb(222, 227, 233); border: 1px solid rgb(208, 217, 224); line-height: 1.4;">create</span></div><div><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4;">public static</span> <a href="https://docs.oracle.com/javase/9/docs/api/java/lang/ref/Cleaner.html" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4;" title="class in java.lang.ref">Cleaner</a> <span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4;">create(</span><a href="https://docs.oracle.com/javase/9/docs/api/java/util/concurrent/ThreadFactory.html" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4;" title="interface in java.util.concurrent">ThreadFactory</a> <span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4;">threadFactory)</span></div><br/><br/><span style="line-height: 1.4;">Returns a new </span><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">Cleaner</span><span style="line-height: 1.4;"> using a </span><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">Thread</span><span style="line-height: 1.4;"> from the </span><span style="font-size: 14px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">ThreadFactory</span><span style="line-height: 1.4;">.</span><br/><span style="line-height: 1.4;">A thread from the thread factory's </span><a href="https://docs.oracle.com/javase/9/docs/api/java/util/concurrent/ThreadFactory.html#newThread-java.lang.Runnable-" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;-en-paragraph:true;">newThread</a><span style="line-height: 1.4;"> method is set to be a </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Thread.html#setDaemon-boolean-" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;-en-paragraph:true;">daemon thread</a><span style="line-height: 1.4;"> and started to process phantom reachable objects and invoke cleaning actions. On each call the </span><a href="https://docs.oracle.com/javase/9/docs/api/java/util/concurrent/ThreadFactory.html#newThread-java.lang.Runnable-" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;-en-paragraph:true;">thread factory</a><span style="line-height: 1.4;"> must provide a Thread that is suitable for performing the cleaning actions.</span><br/><span style="line-height: 1.4;">The cleaner terminates when it is phantom reachable and all of the registered cleaning actions are complete.</span><br/><div><br/></div><div><br/></div><div><span style="font-weight: bold; line-height: 1.4;">Parameters:</span></div><div><span style="font-size: 14px; margin-top: 8px; padding-top: 4px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">threadFactory</span><span style="line-height: 1.4;"> - a </span><span style="font-size: 14px; margin-top: 8px; padding-top: 4px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">ThreadFactory</span><span style="line-height: 1.4;"> to return a new </span><span style="font-size: 14px; margin-top: 8px; padding-top: 4px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">Thread</span><span style="line-height: 1.4;"> to process cleaning actions</span></div><div><span style="font-weight: bold; line-height: 1.4;">Returns:</span></div><div><span style="line-height: 1.4;">a new </span><span style="font-size: 14px; margin-top: 8px; padding-top: 4px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">Cleaner</span></div><div><span style="font-weight: bold; line-height: 1.4;">Throws:</span></div><div><code style="font-size: 14px; padding-top: 4px; margin-top: 8px;"><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/IllegalThreadStateException.html" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em; text-decoration: none;" title="class in java.lang">IllegalThreadStateException</a></code><span style="line-height: 1.4;"> - if the thread from the thread factory was </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Thread.State.html#NEW" style="font-size: 14px; margin-top: 8px; padding-top: 4px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em; text-decoration: none;">not a new thread</a><span style="line-height: 1.4;">.</span></div><code style="font-size: 14px; padding-top: 4px; margin-top: 8px;"><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/SecurityException.html" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em; text-decoration: none;" title="class in java.lang">SecurityException</a></code><span style="line-height: 1.4;"> - if the current thread is not allowed to create or start the thread.</span></li><li style="list-style: none; margin-bottom: 15px; padding: 0px 0px 5px 8px; border: none;"><div><span style="font-size: 13px; background-color: rgb(222, 227, 233); border: 1px solid rgb(208, 217, 224); line-height: 1.4;">register</span></div><br/><br/><span style="line-height: 1.4;">public</span> <a href="https://docs.oracle.com/javase/9/docs/api/java/lang/ref/Cleaner.Cleanable.html" style="color: rgb(74, 103, 130); line-height: 1.4;" title="interface in java.lang.ref">Cleaner.Cleanable</a> <span style="line-height: 1.4;">register(</span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Object.html" style="color: rgb(74, 103, 130); line-height: 1.4;" title="class in java.lang">Object</a> <span style="line-height: 1.4;">obj,</span><br/><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/Runnable.html" style="color: rgb(74, 103, 130); line-height: 1.4;" title="interface in java.lang">Runnable</a> <span style="line-height: 1.4;">action)</span><br/><div><br/></div><div><br/></div><div><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif; line-height: 1.4;">Registers an object and a cleaning action to run when the object becomes phantom reachable. Refer to the</span><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif; line-height: 1.4;"> </span><a href="https://docs.oracle.com/javase/9/docs/api/java/lang/ref/Cleaner.html#compatible-cleaners" style="font-size: 14px; color: rgb(74, 103, 130); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif; line-height: 1.4;">API Note</a><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif; line-height: 1.4;"> </span><span style="font-size: 14px; color: rgb(71, 71, 71); font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif; line-height: 1.4;">above for cautions about the behavior of cleaning actions.</span></div><div><span style="font-weight: bold; line-height: 1.4;">Parameters:</span></div><div><span style="font-size: 14px; margin-top: 8px; padding-top: 4px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">obj</span><span style="line-height: 1.4;"> - the object to monitor</span></div><div><span style="font-size: 14px; margin-top: 8px; padding-top: 4px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">action</span><span style="line-height: 1.4;"> - a </span><span style="font-size: 14px; margin-top: 8px; padding-top: 4px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">Runnable</span><span style="line-height: 1.4;"> to invoke when the object becomes phantom reachable</span></div><div><span style="font-weight: bold; line-height: 1.4;">Returns:</span></div><span style="line-height: 1.4;">a </span><span style="font-size: 14px; margin-top: 8px; padding-top: 4px; font-family: &quot;DejaVu Sans Mono&quot;, monospace; line-height: 1.4em;">Cleanable</span><span style="line-height: 1.4;"> instance</span></li></ul></ul></div><div><br/></div></span>
</div></body></html> 