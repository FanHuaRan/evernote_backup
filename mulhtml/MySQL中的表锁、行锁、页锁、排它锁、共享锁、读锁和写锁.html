<html>
<head>
  <title>MySQL中的表锁、行锁、页锁、排它锁、共享锁、读锁和写锁</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1357"/>
<h1>MySQL中的表锁、行锁、页锁、排它锁、共享锁、读锁和写锁</h1>

<div>
<span><div><div><span style="font-size: 18pt; color: rgb(26, 144, 185); font-weight: bold;">个人理解</span></div><div><font style="font-size: 12pt;">(1)MySQL数据库服务器包含多种存储引擎：MyISAM，BDB，InnoDB等，每种存储引擎有自己的锁策略。</font></div><div><font style="font-size: 12pt;">   MyISAM:支持表锁，不支持事务，不适合于有大量查询&amp;修改并存（或者说不适合修改）的情况，特别适合只读数据库</font></div><div><font style="font-size: 12pt;">   InnoDB:支持表锁和行锁，支持事务</font></div><div><font style="font-size: 12pt;">   BDB:支持表锁和页锁，支持事务</font></div><div><font style="font-size: 12pt;">(2)共享锁在一般情况下作为读锁，排它锁在一般情况下作为写锁。但也有例外，比如读未提交隔离级别的写锁是共享锁！</font></div><div><font style="font-size: 12pt;">(3)数据库的很多锁都有独占和共享两个版本，行锁、页锁等分类方式只是针对范围进行分类，共享和互斥是针对同步策略分类</font></div><div><font style="font-size: 12pt;">(4)平时我们不直接使用事务，只是单独的sql语句时，数据库引擎都会保证sql语句的执行语句的安全性，都会加锁，比如对于MyISAM,每个读操作都会加表读锁，每个写操作都会加表写锁，InnoDB会使用隐式事务，不过此种事务粒度是单个sql,因此在上层逻辑中连续执行，并发会出现错误。</font></div><div><font style="font-size: 12pt;">(5)锁我们一般不需要直接调用，使用事务可以为我们屏蔽数据库内部锁的实现细节，所以我们编程实现时好好使用事务和事务隔离级别即可，不过对于并发更新问题，一般不会使用串行化事务去解决，一般使用悲观锁和乐观锁策略，在使用悲观锁策略时，就需要程序员手动调用锁</font></div><div><font style="font-size: 12pt;">(6)Mysql的行锁基于索引，无法使用索引时会直接使用表锁！</font></div><div><font style="font-size: 12pt;">(7)数据库服务器比我们想象的复杂得多且相当成熟，解决数据库的并发问题一般不需要花多心思去解决</font></div><div><br/></div><div><span style="font-size: 18pt;"><span style="font-size: 18pt; color: rgb(26, 144, 185); font-weight: bold;">原文</span></span></div><div><font style="font-size: 12pt;">地址：<a href="http://blog.csdn.net/mysteryhaohao/article/details/51669741">http://blog.csdn.net/mysteryhaohao/article/details/51669741</a></font></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; font-size: 16px; min-height: 26px; text-align: justify; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; min-height: 26px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">锁，在现实生活中是为我们想要隐藏于外界所使用的一种工具。在计算机中，是协调多个进程或县城并发访问某一资源的一种机制。在数据库当中，除了传统的计算资源（CPU、RAM、I/O等等）的争用之外，数据也是一种供许多用户共享访问的资源。如何保证数据并发访问的一致性、有效性，是所有数据库必须解决的一个问题，锁的冲突也是影响数据库并发访问性能的一个重要因素。从这一角度来说，锁对于数据库而言就显得尤为重要。</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; font-size: 16px; min-height: 26px; text-align: justify; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 18px; min-height: 26px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">MySQL锁</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; font-size: 16px; min-height: 26px; text-align: justify; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; min-height: 26px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">相对于其他的数据库而言，MySQL的锁机制比较简单，最显著的特点就是不同的存储引擎支持不同的锁机制。根据不同的存储引擎，MySQL中锁的特性可以大致归纳如下：</span></div><table border="2" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 215px;"></col><col style="width: 215px;"></col><col style="width: 215px;"></col><col style="width: 215px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: center;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">行锁</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: center;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">表锁</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: center;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">页锁</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">MyISAM</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: center;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">√</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">BDB</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: center;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">√</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: center;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">√</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">InnoDB</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: center;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">√</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: center;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">√</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><br/></div></td></tr></tbody></table><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; font-size: 16px; min-height: 26px; text-align: justify; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br/></div><span style="box-sizing: border-box; font-size: 18px; min-height: 26px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">开销、加锁速度、死锁、粒度、并发性能</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; font-family: &quot;Microsoft YaHei&quot;;">表锁： 开销小，加锁快；不会出现死锁；锁定力度大，发生锁冲突概率高，并发度最低</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; font-family: &quot;Microsoft YaHei&quot;;">行锁： 开销大，加锁慢；会出现死锁；锁定粒度小，发生锁冲突的概率低，并发度高</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; font-family: &quot;Microsoft YaHei&quot;;">页锁： 开销和加锁速度介于表锁和行锁之间；会出现死锁；锁定粒度介于表锁和行锁之间，并发度一般</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; font-size: 16px; min-height: 26px; text-align: justify; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; min-height: 26px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">从上述的特点课件，很难笼统的说哪种锁最好，只能根据具体应用的特点来说哪种锁更加合适。仅仅从锁的角度来说的话：</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; font-size: 16px; min-height: 26px; text-align: justify; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; min-height: 26px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">表锁更适用于以查询为主，只有少量按索引条件更新数据的应用；行锁更适用于有大量按索引条件并发更新少量不同数据，同时又有并发查询的应用。（PS：由于BDB已经被InnoDB所取代，我们只讨论MyISAM表锁和InnoDB行锁的问题）</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 18px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">MyISAM表锁</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">MyISAM存储引擎只支持表锁，这也是MySQL开始几个版本中唯一支持的锁类型。随着应用对事务完整性和并发性要求的不断提高，MySQL才开始开发基于事务的存储引擎，后来慢慢出现了支持页锁的BDB存储引擎和支持行锁的InnoDB存储引擎（实际 InnoDB是单独的一个公司，现在已经被Oracle公司收购）。但是MyISAM的表锁依然是使用最为广泛的锁类型。本节将详细介绍MyISAM表锁的使用。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">查询表级锁争用情况</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">可以通过检查table_locks_waited和table_locks_immediate状态变量来分析系统上的表锁定争夺：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql&gt; </span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">show status like 'table%';</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">+-----------------------+-------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">| Variable_name         | Value |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">+-----------------------+-------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">| Table_locks_immediate | 2979  |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">| Table_locks_waited    | 0     |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">+-----------------------+-------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">2 rows in set (0.00 sec))</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">如果Table_locks_waited的值比较高，则说明存在着较严重的表级锁争用情况。</span></div><h3 style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 22px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">MySQL表级锁的锁模式</span></h3><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">MySQL的表级锁有两种模式：表共享读锁（Table Read Lock）和表独占写锁（Table Write Lock）。锁模式的兼容性如下表所示。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">                                          MySQL中的表锁兼容性                </span></div><table border="1" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 215px;"></col><col style="width: 215px;"></col><col style="width: 215px;"></col><col style="width: 215px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">请求锁模式</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">         是否兼容</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">当前锁模式</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">None</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">读锁</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">写锁</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">读锁</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">是</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">是</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">否</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">写锁</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">是</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">否</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">否</span></div></td></tr></tbody></table><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">可见，对MyISAM表的读操作，不会阻塞其他用户对同一表的读请求，但会阻塞对同一表的写请求；对 MyISAM表的写操作，则会阻塞其他用户对同一表的读和写操作；MyISAM表的读操作与写操作之间，以及写操作之间是串行的！根据如下表所示的例子可以知道，当一个线程获得对一个表的写锁后，只有持有锁的线程可以对表进行更新操作。其他线程的读、写操作都会等待，直到锁被释放为止。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">                        MyISAM存储引擎的写阻塞读例子</span></div><table border="1" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 430px;"></col><col style="width: 430px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_1</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_2</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">获得表film_text的WRITE锁定</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; lock table film_text write;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">当前session对锁定表的查询、更新、插入操作都可以执行：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select film_id,title from film_text where film_id = 1001;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+---------+-------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| film_id | title       |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+---------+-------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 1001    | Update Test |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+---------+-------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; insert into film_text (film_id,title) values(1003,'Test');</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 1 row affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; update film_text set title = 'Test' where film_id = 1001;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 1 row affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Rows matched: 1  Changed: 1  Warnings: 0</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">其他session对锁定表的查询被阻塞，需要等待锁被释放：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select film_id,title from film_text where film_id = 1001;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">等待</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">释放锁：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; unlock tables;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">等待</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Session2获得锁，查询返回：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select film_id,title from film_text where film_id = 1001;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+---------+-------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| film_id | title |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+---------+-------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 1001    | Test  |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+---------+-------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (57.59 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><div><br style="box-sizing: border-box;"/></div></div></td></tr></tbody></table><div><br style="box-sizing: border-box;"/></div><h3 style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 22px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 18px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">如何加表锁</span></h3><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">MyISAM在执行查询语句（SELECT）前，会自动给涉及的所有表加读锁，在执行更新操作（UPDATE、DELETE、INSERT等）前，会自动给涉及的表加写锁，这个过程并不需要用户干预，因此，用户一般不需要直接用LOCK TABLE命令给MyISAM表显式加锁。在本书的示例中，显式加锁基本上都是为了方便而已，并非必须如此。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">给MyISAM表显示加锁，一般是为了在一定程度模拟事务操作，实现对某一时间点多个表的一致性读取。例如，有一个订单表orders，其中记录有各订单的总金额total，同时还有一个订单明细表order_detail，其中记录有各订单每一产品的金额小计 subtotal，假设我们需要检查这两个表的金额合计是否相符，可能就需要执行如下两条SQL：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: 0% 50% rgb(217, 217, 217);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: 0% 50% rgb(217, 217, 217); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Select sum(total) from orders;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: 0% 50% rgb(217, 217, 217);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: 0% 50% rgb(217, 217, 217); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Select sum(subtotal) from order_detail;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">这时，如果不先给两个表加锁，就可能产生错误的结果，因为第一条语句执行过程中，order_detail表可能已经发生了改变。因此，正确的方法应该是：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: 0% 50% rgb(217, 217, 217);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: 0% 50% rgb(217, 217, 217); color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Lock tables orders read local, order_detail read local;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: 0% 50% rgb(217, 217, 217);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: 0% 50% rgb(217, 217, 217); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Select sum(total) from orders;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: 0% 50% rgb(217, 217, 217);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: 0% 50% rgb(217, 217, 217); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Select sum(subtotal) from order_detail;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: 0% 50% rgb(217, 217, 217);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: 0% 50% rgb(217, 217, 217); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Unlock tables;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">要特别说明以下两点内容。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">上面的例子在LOCK TABLES时加了“local”选项，其作用就是在满足MyISAM表并发插入条件的情况下，允许其他用户在表尾并发插入记录，有关MyISAM表的并发插入问题，在后面的章节中还会进一步介绍。</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">在用LOCK TABLES给表显式加表锁时，必须同时取得所有涉及到表的锁，并且MySQL不支持锁升级。也就是说，在执行LOCK TABLES后，只能访问显式加锁的这些表，不能访问未加锁的表；同时，如果加的是读锁，那么只能执行查询操作，而不能执行更新操作。其实，在自动加锁的情况下也基本如此，MyISAM总是一次获得SQL语句所需要的全部锁。这也正是MyISAM表不会出现死锁（Deadlock Free）的原因。</span></div></div><div><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">在如下表所示的例子中，一个session使用LOCK TABLE命令给表film_text加了读锁，这个session可以查询锁定表中的记录，但更新或访问其他表都会提示错误；同时，另外一个session可以查询表中的记录，但更新就会出现锁等待。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">MyISAM存储引擎的读阻塞写例子</span></div><table border="1" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 430px;"></col><col style="width: 430px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_1</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_2</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">获得表film_text的READ锁定</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; lock table film_text read;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">当前session可以查询该表记录</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select film_id,title from film_text where film_id = 1001;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+---------+------------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| film_id | title            |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+---------+------------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 1001    | ACADEMY DINOSAUR |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+---------+------------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">其他session也可以查询该表的记录</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select film_id,title from film_text where film_id = 1001;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+---------+------------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| film_id | title            |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+---------+------------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 1001    | ACADEMY DINOSAUR |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+---------+------------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">当前session不能查询没有锁定的表</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select film_id,title from film where film_id = 1001;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">ERROR 1100 (HY000): Table 'film' was not locked with LOCK TABLES</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">其他session可以查询或者更新未锁定的表</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select film_id,title from film where film_id = 1001;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+---------+---------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| film_id | title         |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+---------+---------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 1001    | update record |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+---------+---------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; update film set title = 'Test' where film_id = 1001;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 1 row affected (0.04 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Rows matched: 1  Changed: 1  Warnings: 0</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">当前session中插入或者更新锁定的表都会提示错误：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; insert into film_text (film_id,title) values(1002,'Test');</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">ERROR 1099 (HY000): Table 'film_text' was locked with a READ lock and can't be updated</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; update film_text set title = 'Test' where film_id = 1001;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">ERROR 1099 (HY000): Table 'film_text' was locked with a READ lock and can't be updated</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">其他session更新锁定表会等待获得锁：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; update film_text set title = 'Test' where film_id = 1001;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">等待</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">释放锁</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; unlock tables;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">等待</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Session获得锁，更新操作完成：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; update film_text set title = 'Test' where film_id = 1001;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 1 row affected (1 min 0.71 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Rows matched: 1  Changed: 1  Warnings: 0</span></div></td></tr></tbody></table><div><br style="box-sizing: border-box;"/></div><div><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 14px; color: rgb(255, 0, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">注意，</span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 14px; color: rgb(255, 0, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">当使用LOCK TABLES时，不仅需要一次锁定用到的所有表，而且，同一个表在SQL语句中出现多少次，就要通过与SQL语句中相同的别名锁定多少次，否则也会出错！</span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">举例说明如下。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">（1）对actor表获得读锁：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql&gt; lock table actor read;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Query OK, 0 rows affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">（2）但是通过别名访问会提示错误：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql&gt; select a.first_name,a.last_name,b.first_name,b.last_name from actor a,actor b where a.first_name = b.first_name and a.first_name = 'Lisa' and a.last_name = 'Tom' and a.last_name &lt;&gt; b.last_name;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">ERROR 1100 (HY000): Table 'a' was not locked with LOCK TABLES</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">（3）需要对别名分别锁定：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql&gt; lock table actor as a read,actor as b read;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Query OK, 0 rows affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">（4）按照别名的查询可以正确执行：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql&gt; select a.first_name,a.last_name,b.first_name,b.last_name from actor a,actor b where a.first_name = b.first_name and a.first_name = 'Lisa' and a.last_name = 'Tom' and a.last_name &lt;&gt; b.last_name;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">+------------+-----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">| first_name | last_name | first_name | last_name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">+------------+-----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">| Lisa       | Tom       | LISA       | MONROE    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">+------------+-----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">1 row in set (0.00 sec)</span></div><div><br style="box-sizing: border-box;"/></div><h3 style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 22px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 18px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">并发插入（Concurrent Inserts）</span></h3><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">上文提到过MyISAM表的读和写是串行的，但这是就总体而言的。在一定条件下，MyISAM表也支持查询和插入操作的并发进行。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">MyISAM存储引擎有一个系统变量concurrent_insert，专门用以控制其并发插入的行为，其值分别可以为0、1或2。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">当concurrent_insert设置为0时，不允许并发插入。</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">当concurrent_insert设置为1时，如果MyISAM表中没有空洞（即表的中间没有被删除的行），MyISAM允许在一个进程读表的同时，另一个进程从表尾插入记录。这也是MySQL的默认设置。</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">当concurrent_insert设置为2时，无论MyISAM表中有没有空洞，都允许在表尾并发插入记录。</span></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">在如下表所示的例子中，session_1获得了一个表的READ LOCAL锁，该线程可以对表进行查询操作，但不能对表进行更新操作；其他的线程（session_2），虽然不能对表进行删除和更新操作，但却可以对该表进行并发插入操作，这里假设该表中间不存在空洞。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">              MyISAM存储引擎的读写（INSERT）并发例子</span></div><table border="1" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 430px;"></col><col style="width: 430px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_1</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_2</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">获得表film_text的READ LOCAL锁定</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; lock table film_text read local;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">当前session不能对锁定表进行更新或者插入操作：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; insert into film_text (film_id,title) values(1002,'Test');</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">ERROR 1099 (HY000): Table 'film_text' was locked with a READ lock and can't be updated</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; update film_text set title = 'Test' where film_id = 1001;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">ERROR 1099 (HY000): Table 'film_text' was locked with a READ lock and can't be updated</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">其他session可以进行插入操作，但是更新会等待：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; insert into film_text (film_id,title) values(1002,'Test');</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 1 row affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; update film_text set title = 'Update Test' where film_id = 1001;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">等待</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">当前session不能访问其他session插入的记录：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select film_id,title from film_text where film_id = 1002;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Empty set (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">释放锁：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; unlock tables;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">等待</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">当前session解锁后可以获得其他session插入的记录：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select film_id,title from film_text where film_id = 1002;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+---------+-------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| film_id | title |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+---------+-------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 1002    | Test  |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+---------+-------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Session2获得锁，更新操作完成：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; update film_text set title = 'Update Test' where film_id = 1001;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 1 row affected (1 min 17.75 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Rows matched: 1  Changed: 1  Warnings: 0</span></div></td></tr></tbody></table><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">可以利用MyISAM存储引擎的并发插入特性，来解决应用中对同一表查询和插入的锁争用。例如，将concurrent_insert系统变量设为2，总是允许并发插入；同时，</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">通过定期在系统空闲时段执行 OPTIMIZE TABLE语句来整理空间碎片，收回因删除记录而产生的中间空洞。</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">有关OPTIMIZE TABLE语句的详细介绍，可以参见第18章中“两个简单实用的优化方法”一节的内容。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br style="box-sizing: border-box;"/></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 18px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">MyISAM的锁调度</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">前面讲过，MyISAM存储引擎的读锁和写锁是互斥的，读写操作是串行的。那么，一个进程请求某个 MyISAM表的读锁，同时另一个进程也请求同一表的写锁，MySQL如何处理呢？答案是</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">写进程先获得锁</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">。不仅如此，即使读请求先到锁等待队列，写请求后到，写锁也会插到读锁请求之前！这是因为MySQL认为写请求一般比读请求要重要。</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">这也正是MyISAM表不太适合于有大量更新操作和查询操作应用的原因，因为，大量的更新操作会造成查询操作很难获得读锁，从而可能永远阻塞。这种情况有时可能会变得非常糟糕！幸好我们可以通过一些设置来调节MyISAM 的调度行为。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">通过指定启动参数low-priority-updates，使MyISAM引擎默认给予读请求以优先的权利。</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">通过执行命令SET LOW_PRIORITY_UPDATES=1，使该连接发出的更新请求优先级降低。</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">通过指定INSERT、UPDATE、DELETE语句的LOW_PRIORITY属性，降低该语句的优先级。</span></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">虽然上面3种方法都是要么更新优先，要么查询优先的方法，但还是可以用其来解决查询相对重要的应用（如用户登录系统）中，读锁等待严重的问题。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">另外，MySQL也提供了一种折中的办法来调节读写冲突，即给系统参数</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">max_write_lock_count</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">设置一个合适的值，当一个表的读锁达到这个值后，MySQL就暂时将写请求的优先级降低，给读进程一定获得锁的机会。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">上面已经讨论了写优先调度机制带来的问题和解决办法。</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">这里还要强调一点：一些需要长时间运行的查询操作，也会使写进程“饿死”！</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">因此，应用中应尽量避免出现长时间运行的查询操作，不要总想用一条SELECT语句来解决问题，因为这种看似巧妙的SQL语句，往往比较复杂，执行时间较长，在可能的情况下可以通过使用中间表等措施对SQL语句做一定的“分解”，使每一步查询都能在较短时间完成，从而减少锁冲突。如果复杂查询不可避免，应尽量安排在数据库空闲时段执行，比如一些定期统计可以安排在夜间执行。</span></div><div><br/></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 18px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">InnoDB锁问题</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">InnoDB与MyISAM的最大不同有两点：一是支持事务（TRANSACTION）；二是采用了行级锁。行级锁与表级锁本来就有许多不同之处，另外，事务的引入也带来了一些新问题。下面我们先介绍一点背景知识，然后详细讨论InnoDB的锁问题。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">背景知识</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">1．事务（Transaction）及其ACID属性</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">事务是由一组SQL语句组成的逻辑处理单元，事务具有以下4个属性，通常简称为事务的ACID属性。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">原子性（Atomicity）：事务是一个原子操作单元，其对数据的修改，要么全都执行，要么全都不执行。</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">一致性（Consistent）：在事务开始和完成时，数据都必须保持一致状态。这意味着所有相关的数据规则都必须应用于事务的修改，以保持数据的完整性；事务结束时，所有的内部数据结构（如B树索引或双向链表）也都必须是正确的。</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">隔离性（Isolation）：数据库系统提供一定的隔离机制，保证事务在不受外部并发操作影响的“独立”环境执行。这意味着事务处理过程中的中间状态对外部是不可见的，反之亦然。</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">持久性（Durable）：事务完成之后，它对于数据的修改是永久性的，即使出现系统故障也能够保持。</span></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">银行转帐就是事务的一个典型例子。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">2．并发事务处理带来的问题</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">相对于串行处理来说，并发事务处理能大大增加数据库资源的利用率，提高数据库系统的事务吞吐量，从而可以支持更多的用户。但并发事务处理也会带来一些问题，主要包括以下几种情况。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">更新丢失（Lost Update）：</span><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">当两个或多个事务选择同一行，然后基于最初选定的值更新该行时，由于每个事务都不知道其他事务的存在，就会发生丢失更新问题－－最后的更新覆盖了由其他事务所做的更新。例如，两个编辑人员制作了同一文档的电子副本。每个编辑人员独立地更改其副本，然后保存更改后的副本，这样就覆盖了原始文档。最后保存其更改副本的编辑人员覆盖另一个编辑人员所做的更改。如果在一个编辑人员完成并提交事务之前，另一个编辑人员不能访问同一文件，则可避免此问题。</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">脏读（Dirty Reads）：</span><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">一个事务正在对一条记录做修改，在这个事务完成并提交前，这条记录的数据就处于不一致状态；这时，另一个事务也来读取同一条记录，如果不加控制，第二个事务读取了这些“脏”数据，并据此做进一步的处理，就会产生未提交的数据依赖关系。这种现象被形象地叫做&quot;脏读&quot;。</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">不可重复读（Non-Repeatable Reads）：</span><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">一个事务在读取某些数据后的某个时间，再次读取以前读过的数据，却发现其读出的数据已经发生了改变、或某些记录已经被删除了！这种现象就叫做“不可重复读”。</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">幻读（Phantom Reads）：</span><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">一个事务按相同的查询条件重新读取以前检索过的数据，却发现其他事务插入了满足其查询条件的新数据，这种现象就称为“幻读”。</span></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">3．事务隔离级别</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">在上面讲到的并发事务处理带来的问题中</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">，“更新丢失”通常是应该完全避免的。但防止更新丢失，并不能单靠数据库事务控制器来解决，需要应用程序对要更新的数据加必要的锁来解决，因此，防止更新丢失应该是应用的责任。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">“脏读”、“不可重复读”和“幻读”，其实都是数据库读一致性问题，必须由数据库提供一定的事务隔离机制来解决。</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">数据库实现事务隔离的方式，基本上可分为以下两种。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">一种是在读取数据前，对其加锁，阻止其他事务对数据进行修改。</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">另一种是不用加任何锁，通过一定机制生成一个数据请求时间点的一致性数据快照（Snapshot)，并用这个快照来提供一定级别（语句级或事务级）的一致性读取。从用户的角度来看，好像是数据库可以提供同一数据的多个版本，因此，这种技术叫做数据</span><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">多版本并发控制</span><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">（MultiVersion Concurrency Control，简称MVCC或MCC），也经常称为多版本数据库。</span></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">数据库的事务隔离越严格，并发副作用越小，但付出的代价也就越大，因为事务隔离实质上就是使事务在一定程度上 “串行化”进行，这显然与“并发”是矛盾的。同时，不同的应用对读一致性和事务隔离程度的要求也是不同的，比如许多应用对“不可重复读”和“幻读”并不敏感，可能更关心数据并发访问的能力。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">为了解决“隔离”与“并发”的矛盾，ISO/ANSI SQL92定义了4个事务隔离级别，每个级别的隔离程度不同，允许出现的副作用也不同，应用可以根据自己的业务逻辑要求，通过选择不同的隔离级别来平衡 “隔离”与“并发”的矛盾。下表很好地概括了这4个隔离级别的特性。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">                                            4种隔离级别比较</span></div><table border="1" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 172px;"></col><col style="width: 172px;"></col><col style="width: 172px;"></col><col style="width: 172px;"></col><col style="width: 172px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">读数据一致性及允许的并发副作用</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">隔离级别</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">读数据一致性</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">脏读</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">不可重复读</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">幻读</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">未提交读（Read uncommitted）</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">最低级别，只能保证不读取物理上损坏的数据</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">是</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">是</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">是</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">已提交度（Read committed）</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">语句级</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">否</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">是</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">是</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">可重复读（Repeatable read）</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">事务级</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">否</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">否</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">是</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">可序列化（Serializable）</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">最高级别，事务级</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">否</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">否</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">否</span></div></td></tr></tbody></table><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">最后要说明的是：各具体数据库并不一定完全实现了上述4个隔离级别，例如，Oracle只提供Read committed和Serializable两个标准隔离级别，另外还提供自己定义的Read only隔离级别；SQL Server除支持上述ISO/ANSI SQL92定义的4个隔离级别外，还支持一个叫做“快照”的隔离级别，但严格来说它是一个用MVCC实现的Serializable隔离级别。MySQL 支持全部4个隔离级别，但在具体实现时，有一些特点，比如在一些隔离级别下是采用MVCC一致性读，但某些情况下又不是，这些内容在后面的章节中将会做进一步介绍。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br style="box-sizing: border-box;"/></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 18px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">获取InnoDB行锁争用情况  </span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;"> </span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;"> </span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">可以通过检查InnoDB_row_lock状态变量来分析系统上的行锁的争夺情况：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql&gt; </span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">show status like 'innodb_row_lock%';</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">+-------------------------------+-------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">| Variable_name                 | Value |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">+-------------------------------+-------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">| InnoDB_row_lock_current_waits | 0     |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">| InnoDB_row_lock_time          | 0     |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">| InnoDB_row_lock_time_avg      | 0     |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">| InnoDB_row_lock_time_max      | 0     |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">| InnoDB_row_lock_waits         | 0     |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">+-------------------------------+-------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">5 rows in set (0.01 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">如果发现锁争用比较严重，如InnoDB_row_lock_waits和InnoDB_row_lock_time_avg的值比较高</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">，还可以通过设置InnoDB Monitors来进一步观察发生锁冲突的表、数据行等，并分析锁争用的原因。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">具体方法如下：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql&gt; CREATE TABLE innodb_monitor(a INT) ENGINE=INNODB;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Query OK, 0 rows affected (0.14 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">然后就可以用下面的语句来进行查看：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql&gt; Show innodb status\G;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">*************************** 1. row ***************************</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">  Type: InnoDB</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">  Name:</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Status:</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">…</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">…</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">------------</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">TRANSACTIONS</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">------------</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Trx id counter 0 117472192</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Purge done for trx's n:o &lt; 0 117472190 undo n:o &lt; 0 0</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">History list length 17</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Total number of lock structs in row lock hash table 0</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">LIST OF TRANSACTIONS FOR EACH SESSION:</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">---TRANSACTION 0 117472185, not started, process no 11052, OS thread id 1158191456</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">MySQL thread id 200610, query id 291197 localhost root</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">---TRANSACTION 0 117472183, not started, process no 11052, OS thread id 1158723936</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">MySQL thread id 199285, query id 291199 localhost root</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Show innodb status</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">…</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">监视器可以通过发出下列语句来停止查看：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql&gt; DROP TABLE innodb_monitor;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Query OK, 0 rows affected (0.05 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">设置监视器后，在SHOW INNODB STATUS的显示内容中，会有详细的当前锁等待的信息，包括表名、锁类型、锁定记录的情况等，便于进行进一步的分析和问题的确定。打开监视器以后，默认情况下每15秒会向日志中记录监控的内容，如果长时间打开会导致.err文件变得非常的巨大，所以用户在确认问题原因之后，要记得删除监控表以关闭监视器，或者通过使用“--console”选项来启动服务器以关闭写日志文件。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br style="box-sizing: border-box;"/></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 18px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">InnoDB的行锁模式及加锁方法</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">InnoDB实现了以下两种类型的行锁。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">共享锁（S）：允许一个事务去读一行，阻止其他事务获得相同数据集的排他锁。</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">排他锁（X)：允许获得排他锁的事务更新数据，阻止其他事务取得相同数据集的共享读锁和排他写锁。另外，为了允许行锁和表锁共存，实现多粒度锁机制，InnoDB还有两种内部使用的意向锁（Intention Locks），这两种意向锁都是表锁。</span></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">意向共享锁（IS）：事务打算给数据行加行共享锁，事务在给一个数据行加共享锁前必须先取得该表的IS锁。</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">意向排他锁（IX）：事务打算给数据行加行排他锁，事务在给一个数据行加排他锁前必须先取得该表的IX锁。</span></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">上述锁模式的兼容情况具体如下表所示。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">                                         InnoDB行锁模式兼容性列表</span></div><table border="1" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 172px;"></col><col style="width: 172px;"></col><col style="width: 172px;"></col><col style="width: 172px;"></col><col style="width: 172px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">请求锁模式</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">   是否兼容</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">当前锁模式</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">X</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">IX</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">S</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">IS</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">X</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">冲突</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">冲突</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">冲突</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">冲突</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">IX</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">冲突</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">兼容</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">冲突</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">兼容</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">S</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">冲突</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">冲突</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">兼容</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">兼容</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">IS</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">冲突</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">兼容</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">兼容</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">兼容</span></div></td></tr></tbody></table><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">如果一个事务请求的锁模式与当前的锁兼容，InnoDB就将请求的锁授予该事务；反之，如果两者不兼容，该事务就要等待锁释放。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">意向锁是InnoDB自动加的，不需用户干预。对于UPDATE、DELETE和INSERT语句，InnoDB会自动给涉及数据集加排他锁（X)；对于普通SELECT语句，InnoDB不会加任何锁；事务可以通过以下语句显示给记录集加共享锁或排他锁。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">共享锁（S）：SELECT * FROM table_name WHERE ... LOCK IN SHARE MODE。</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">排他锁（X)：SELECT * FROM table_name WHERE ... FOR UPDATE。</span></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">用SELECT ... IN SHARE MODE获得共享锁，主要用在需要数据依存关系时来确认某行记录是否存在，并确保没有人对这个记录进行UPDATE或者DELETE操作。但是如果当前事务也需要对该记录进行更新操作，则很有可能造成死锁，对于锁定行记录后需要进行更新操作的应用，应该使用SELECT... FOR UPDATE方式获得排他锁。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">在如下表所示的例子中，使用了SELECT ... IN SHARE MODE加锁后再更新记录，看看会出现什么情况，其中actor表的actor_id字段为主键。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">  </span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">InnoDB存储引擎的共享锁例子</span></div><table border="1" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 430px;"></col><col style="width: 430px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_1</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_2</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit = 0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select actor_id,first_name,last_name from actor where actor_id = 178;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| actor_id | first_name | last_name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 178      | LISA       | MONROE    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit = 0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select actor_id,first_name,last_name from actor where actor_id = 178;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| actor_id | first_name | last_name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 178      | LISA       | MONROE    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">当前session对actor_id=178的记录加share mode 的共享锁：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select actor_id,first_name,last_name from actor where actor_id = 178</span><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">lock in share mode;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| actor_id | first_name | last_name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 178      | LISA       | MONROE    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.01 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">其他session仍然可以查询记录，并也可以对该记录加share mode的共享锁：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select actor_id,first_name,last_name from actor where actor_id = 178</span><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">lock in share mode;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| actor_id | first_name | last_name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 178      | LISA       | MONROE    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.01 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">当前session对锁定的记录进行更新操作，等待锁：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; update actor set last_name = 'MONROE T' where actor_id = 178;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">等待</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 22px;">其他session也对该记录进行更新操作，则会导致死锁退出：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; update actor set last_name = 'MONROE T' where actor_id = 178;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">获得锁后，可以成功更新：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; update actor set last_name = 'MONROE T' where actor_id = 178;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 1 row affected (17.67 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Rows matched: 1  Changed: 1  Warnings: 0</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr></tbody></table><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">    当使用SELECT...FOR UPDATE加锁后再更新记录，出现如下表所示的情况。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;"> </span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">InnoDB存储引擎的排他锁例子</span></div><table border="1" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 430px;"></col><col style="width: 430px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_1</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_2</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit = 0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select actor_id,first_name,last_name from actor where actor_id = 178;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| actor_id | first_name | last_name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 178      | LISA       | MONROE    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit = 0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select actor_id,first_name,last_name from actor where actor_id = 178;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| actor_id | first_name | last_name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 178      | LISA       | MONROE    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">当前session对actor_id=178的记录加for update的排它锁：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select actor_id,first_name,last_name from actor where actor_id = 178 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| actor_id | first_name | last_name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 178      | LISA       | MONROE    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">其他session可以查询该记录，但是不能对该记录加共享锁，会等待获得锁：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select actor_id,first_name,last_name from actor where actor_id = 178;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| actor_id | first_name | last_name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 178      | LISA       | MONROE    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select actor_id,first_name,last_name from actor where actor_id = 178 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">等待</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">当前session可以对锁定的记录进行更新操作，更新后释放锁：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; update actor set last_name = 'MONROE T' where actor_id = 178;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 1 row affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Rows matched: 1  Changed: 1  Warnings: 0</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; commit;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.01 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">其他session获得锁，得到其他session提交的记录：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select actor_id,first_name,last_name from actor where actor_id = 178 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| actor_id | first_name | last_name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 178      | LISA       | MONROE T  |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (9.59 sec)</span></div></td></tr></tbody></table><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br style="box-sizing: border-box;"/></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 18px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">InnoDB行锁实现方式</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(255, 102, 102); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">InnoDB行锁是通过给索引上的索引项加锁来实现的</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">，这一点MySQL与Oracle不同，后者是</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">通过在数据块中对相应数据行加锁来实现的。InnoDB这种行锁实现特点意味着：只有通过索引条件检索数据，InnoDB才使用行级锁，否则，InnoDB将使用表锁！</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">在实际应用中，要特别注意InnoDB行锁的这一特性，不然的话，可能导致大量的锁冲突，从而影响并发性能。</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">下面通过一些实际例子来加以说明。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">（1）在不通过索引条件查询的时候，InnoDB确实使用的是表锁，而不是行锁。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">在如下所示的例子中，开始tab_no_index表没有索引：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql&gt; create table tab_no_index(id int,name varchar(10)) engine=innodb;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Query OK, 0 rows affected (0.15 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql&gt; insert into tab_no_index values(1,'1'),(2,'2'),(3,'3'),(4,'4');</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Query OK, 4 rows affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Records: 4  Duplicates: 0  Warnings: 0</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">   </span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">InnoDB存储引擎的表在不使用索引时使用表锁例子</span></div><table border="1" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 430px;"></col><col style="width: 430px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_1</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_2</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit=0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from tab_no_index where id = 1 ;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| id   | name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 1    | 1    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit=0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from tab_no_index where id = 2 ;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| id   | name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 2    | 2    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from tab_no_index where id = 1 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| id   | name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 1    | 1    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from tab_no_index where id = 2 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">等待</span></div></td></tr></tbody></table><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">在如上表所示的例子中，看起来session_1只给一行加了排他锁，但session_2在请求其他行的排他锁时，却出现了锁等待！原因就是在没有索引的情况下，InnoDB只能使用表锁。当我们给其增加一个索引后，InnoDB就只锁定了符合条件的行，如下表所示。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">创建tab_with_index表，id字段有普通索引：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql&gt; create table tab_with_index(id int,name varchar(10)) engine=innodb;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Query OK, 0 rows affected (0.15 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql&gt; alter table tab_with_index add index id(id);</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Query OK, 4 rows affected (0.24 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Records: 4  Duplicates: 0  Warnings: 0</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">  </span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;"> InnoDB存储引擎的表在使用索引时使用行锁例子</span></div><table border="1" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 430px;"></col><col style="width: 430px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_1</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_2</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit=0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from tab_with_index where id = 1 ;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| id   | name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 1    | 1    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit=0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from tab_with_index where id = 2 ;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| id   | name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 2    | 2    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from tab_with_index where id = 1 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| id   | name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 1    | 1    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from tab_with_index where id = 2 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| id   | name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 2    | 2    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div></td></tr></tbody></table><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">（2）</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">由于MySQL的行锁是针对索引加的锁，不是针对记录加的锁，所以虽然是访问不同行的记录，但是如果是使用相同的索引键，是会出现锁冲突的。</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">应用设计的时候要注意这一点。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">在如下表所示的例子中，表tab_with_index的id字段有索引，name字段没有索引：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql&gt; alter table tab_with_index drop index name;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Query OK, 4 rows affected (0.22 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Records: 4  Duplicates: 0  Warnings: 0</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql&gt; insert into tab_with_index  values(1,'4');</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Query OK, 1 row affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql&gt; select * from tab_with_index where id = 1;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">| id   | name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">| 1    | 1    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">| 1    | 4    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">2 rows in set (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">   </span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">InnoDB存储引擎使用相同索引键的阻塞例子</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">       </span></div><table border="1" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 430px;"></col><col style="width: 430px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_1</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_2</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit=0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit=0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from tab_with_index where id = 1 and name = '1' for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| id   | name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 1    | 1    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">虽然session_2访问的是和session_1不同的记录，但是因为使用了相同的索引，所以需要等待锁：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from tab_with_index where id = 1 and name = '4' for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">等待</span></div></td></tr></tbody></table><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">（3）当表有多个索引的时候，不同的事务可以使用不同的索引锁定不同的行，另外，不论是使用主键索引、唯一索引或普通索引，InnoDB都会使用行锁来对数据加锁。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">在如下表所示的例子中，表tab_with_index的id字段有主键索引，name字段有普通索引：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql&gt; alter table tab_with_index add index name(name);</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Query OK, 5 rows affected (0.23 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Records: 5  Duplicates: 0  Warnings: 0</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">  </span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">InnoDB存储引擎的表使用不同索引的阻塞例子</span></div><table border="1" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 430px;"></col><col style="width: 430px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_1</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_2</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit=0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit=0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from tab_with_index where id = 1 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| id   | name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 1    | 1    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 1    | 4    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">2 rows in set (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Session_2使用name的索引访问记录，因为记录没有被索引，所以可以获得锁：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from tab_with_index where name = '2' for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| id   | name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 2    | 2    |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">由于访问的记录已经被session_1锁定，所以等待获得锁。：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from tab_with_index where name = '4' for update;</span></div></td></tr></tbody></table><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">（4）即便在条件中使用了索引字段，但是否使用索引来检索数据是由MySQL通过判断不同执行计划的代价来决定的，如果MySQL认为全表扫描效率更高，比如对一些很小的表，它就不会使用索引，这种情况下InnoDB将使用表锁，而不是行锁。</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">因此，在分析锁冲突时，别忘了检查SQL的执行计划，以确认是否真正使用了索引。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br style="box-sizing: border-box;"/></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">在下面的例子中，检索值的数据类型与索引字段不同，虽然MySQL能够进行数据类型转换，但却不会使用索引，从而导致InnoDB使用表锁。通过用explain检查两条SQL的执行</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">计划，我们可以清楚地看到了这一点。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">例子中tab_with_index表的name字段有索引，但是name字段是varchar类型的，如果where条件中不是和varchar类型进行比较，则会对name进行类型转换，而执行的全表扫描。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql&gt; alter table tab_no_index add index name(name);</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Query OK, 4 rows affected (8.06 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Records: 4  Duplicates: 0  Warnings: 0</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql&gt; explain select * from tab_with_index where name = 1 \G</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">*************************** 1. row ***************************</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">           id: 1</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">  select_type: SIMPLE</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">        table: tab_with_index</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">         type: ALL</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">possible_keys: name</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">          key: NULL</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">      key_len: NULL</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">          ref: NULL</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">         rows: 4</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">        Extra: Using where</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">1 row in set (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql&gt; explain select * from tab_with_index where name = '1' \G</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">*************************** 1. row ***************************</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">           id: 1</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">  select_type: SIMPLE</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">        table: tab_with_index</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">         type: ref</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">possible_keys: name</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">          key: name</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">      key_len: 23</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">          ref: const</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">         rows: 1</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">        Extra: Using where</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">1 row in set (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br style="box-sizing: border-box;"/></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 18px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">间隙锁（Next-Key锁）</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">当我们用范围条件而不是相等条件检索数据，并请求共享或排他锁时，InnoDB会给符合条件的已有数据记录的索引项加锁；对于键值在条件范围内但并不存在的记录，叫做“间隙（GAP)”，InnoDB也会对这个“间隙”加锁，这种锁机制就是所谓的间隙锁（Next-Key锁）。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">举例来说，假如emp表中只有101条记录，其empid的值分别是 1,2,...,100,101，下面的SQL：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">Select * from  emp where empid &gt; 100 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">是一个范围条件的检索，InnoDB不仅会对符合条件的empid值为101的记录加锁，也会对empid大于101（这些记录并不存在）的“间隙”加锁。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">InnoDB使用间隙锁的目的，一方面是为了防止幻读，以满足相关隔离级别的要求，对于上面的例子，要是不使用间隙锁，如果其他事务插入了empid大于100的任何记录，那么本事务如果再次执行上述语句，就会发生幻读；另外一方面，是为了满足其恢复和复制的需要。有关其恢复和复制对锁机制的影响，以及不同隔离级别下InnoDB使用间隙锁的情况，在后续的章节中会做进一步介绍。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">很显然，在使用范围条件检索并锁定记录时，InnoDB这种加锁机制会阻塞符合条件范围内键值的并发插入，这往往会造成严重的锁等待。因此，在实际应用开发中，尤其是并发插入比较多的应用，我们要尽量优化业务逻辑，尽量使用相等条件来访问更新数据，避免使用范围条件。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">还要特别说明的是，InnoDB除了通过范围条件加锁时使用间隙锁外，如果使用相等条件请求给一个不存在的记录加锁，InnoDB也会使用间隙锁！</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">在如下表所示的例子中，假如emp表中只有101条记录，其empid的值分别是1,2,......,100,101。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">               InnoDB存储引擎的间隙锁阻塞例子</span></div><table border="1" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 430px;"></col><col style="width: 430px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_1</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_2</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select @@tx_isolation;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+-----------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| @@tx_isolation  |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+-----------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| REPEATABLE-READ |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+-----------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit = 0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select @@tx_isolation;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+-----------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| @@tx_isolation  |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+-----------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| REPEATABLE-READ |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+-----------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit = 0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">当前session对不存在的记录加for update的锁：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from emp where empid = 102 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Empty set (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">这时，如果其他session插入empid为102的记录（注意：这条记录并不存在），也会出现锁等待：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt;insert into emp(empid,...) values(102,...);</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">阻塞等待</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Session_1 执行rollback：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; rollback;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (13.04 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">由于其他session_1回退后释放了Next-Key锁，当前session可以获得锁并成功插入记录：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt;insert into emp(empid,...) values(102,...);</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 1 row affected (13.35 sec)</span></div></td></tr></tbody></table><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br style="box-sizing: border-box;"/></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><span style="box-sizing: border-box; font-size: 18px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">恢复和复制的需要，对InnoDB锁机制的影响</span></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">MySQL通过BINLOG录执行成功的INSERT、UPDATE、DELETE等更新数据的SQL语句，并由此实现MySQL数据库的恢复和主从复制（可以参见本书“管理篇”的介绍）。MySQL的恢复机制（复制其实就是在Slave Mysql不断做基于BINLOG的恢复）有以下特点。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">l  一是MySQL的恢复是SQL语句级的，也就是重新执行BINLOG中的SQL语句。这与Oracle数据库不同，Oracle是基于数据库文件块的。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">l  二是MySQL的Binlog是按照事务提交的先后顺序记录的，恢复也是按这个顺序进行的。这点也与Oralce不同，Oracle是按照系统更新号（System Change Number，SCN）来恢复数据的，每个事务开始时，Oracle都会分配一个全局唯一的SCN，SCN的顺序与事务开始的时间顺序是一致的。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">从上面两点可知，MySQL的恢复机制要求：在一个事务未提交前，其他并发事务不能插入满足其锁定条件的任何记录，也就是不允许出现幻读，这已经超过了ISO/ANSI SQL92“可重复读”隔离级别的要求，实际上是要求事务要串行化。这也是许多情况下，InnoDB要用到间隙锁的原因，比如在用范围条件更新记录时，无论在Read Commited或是Repeatable Read隔离级别下，InnoDB都要使用间隙锁，但这并不是隔离级别要求的，有关InnoDB在不同隔离级别下加锁的差异在下一小节还会介绍。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">另外，对于“insert  into target_tab select * from source_tab where ...”和“create  table new_tab ...select ... From  source_tab where ...(CTAS)”这种SQL语句，用户并没有对source_tab做任何更新操作，但MySQL对这种SQL语句做了特别处理。先来看如下表的例子。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">                   CTAS操作给原表加锁例子</span></div><table border="1" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 430px;"></col><col style="width: 430px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_1</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_2</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit = 0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from target_tab;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Empty set (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from source_tab where name = '1';</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----+------+----+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| d1 | name | d2 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----+------+----+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  4 | 1    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  5 | 1    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  6 | 1    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  7 | 1    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  8 | 1    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----+------+----+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">5 rows in set (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit = 0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from target_tab;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Empty set (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from source_tab where name = '1';</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----+------+----+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| d1 | name | d2 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----+------+----+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  4 | 1    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  5 | 1    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  6 | 1    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  7 | 1    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  8 | 1    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----+------+----+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">5 rows in set (0.00 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; insert into target_tab select d1,name from source_tab where name = '1';</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 5 rows affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Records: 5  Duplicates: 0  Warnings: 0</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; update source_tab set name = '1' where name = '8';</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">等待</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">commit;</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">返回结果</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">commit;</span></div></td></tr></tbody></table><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">在上面的例子中，只是简单地读 source_tab表的数据，相当于执行一个普通的SELECT语句，用一致性读就可以了。ORACLE正是这么做的，它通过MVCC技术实现的多版本数据来实现一致性读，不需要给source_tab加任何锁。我们知道InnoDB也实现了多版本数据，对普通的SELECT一致性读，也不需要加任何锁；但这里InnoDB却给source_tab加了共享锁，并没有使用多版本数据一致性读技术！</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">MySQL为什么要这么做呢？其原因还是为了保证恢复和复制的正确性。因为不加锁的话，如果在上述语句执行过程中，其他事务对source_tab做了更新操作，就可能导致数据恢复的结果错误。为了演示这一点，我们再重复一下前面的例子，不同的是在session_1执行事务前，先将系统变量 innodb_locks_unsafe_for_binlog的值设置为“on”（其默认值为off），具体结果如下表所示。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">                  CTAS操作不给原表加锁带来的安全问题例子</span></div><table border="1" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 430px;"></col><col style="width: 430px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_1</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_2</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit = 0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt;set innodb_locks_unsafe_for_binlog='on'</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from target_tab;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Empty set (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from source_tab where name = '1';</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----+------+----+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| d1 | name | d2 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----+------+----+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  4 | 1    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  5 | 1    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  6 | 1    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  7 | 1    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  8 | 1    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----+------+----+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">5 rows in set (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit = 0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from target_tab;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Empty set (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from source_tab where name = '1';</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----+------+----+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| d1 | name | d2 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----+------+----+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  4 | 1    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  5 | 1    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  6 | 1    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  7 | 1    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  8 | 1    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----+------+----+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">5 rows in set (0.00 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; insert into target_tab select d1,name from source_tab where name = '1';</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 5 rows affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Records: 5  Duplicates: 0  Warnings: 0</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_1未提交，可以对session_1的select的记录进行更新操作。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; update source_tab set name = '8' where name = '1';</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 5 rows affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Rows matched: 5  Changed: 5  Warnings: 0</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from source_tab where name = '8';</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----+------+----+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| d1 | name | d2 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----+------+----+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  4 | 8    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  5 | 8    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  6 | 8    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  7 | 8    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  8 | 8    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----+------+----+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">5 rows in set (0.00 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">更新操作先提交</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; commit;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.05 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">插入操作后提交</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; commit;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.07 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">此时查看数据，target_tab中可以插入source_tab更新前的结果，这符合应用逻辑：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from source_tab where name = '8';</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----+------+----+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| d1 | name | d2 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----+------+----+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  4 | 8    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  5 | 8    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  6 | 8    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  7 | 8    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  8 | 8    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----+------+----+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">5 rows in set (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from target_tab;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| id   | name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 4    | 1.00 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 5    | 1.00 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 6    | 1.00 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 7    | 1.00 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 8    | 1.00 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">5 rows in set (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from tt1 where name = '1';</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Empty set (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from source_tab where name = '8';</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----+------+----+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| d1 | name | d2 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----+------+----+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  4 | 8    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  5 | 8    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  6 | 8    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  7 | 8    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">|  8 | 8    |  1 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----+------+----+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">5 rows in set (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from target_tab;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| id   | name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 4    | 1.00 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 5    | 1.00 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 6    | 1.00 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 7    | 1.00 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| 8    | 1.00 |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------+------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">5 rows in set (0.00 sec)</span></div></td></tr></tbody></table><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">从上可见，设置系统变量innodb_locks_unsafe_for_binlog的值为“on”后，InnoDB不再对source_tab加锁，结果也符合应用逻辑，但是如果分析BINLOG的内容：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">......</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">SET TIMESTAMP=1169175130;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">BEGIN;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;"># at 274</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">#070119 10:51:57 server id 1  end_log_pos 105   Query   thread_id=1     exec_time=0     error_code=0</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">SET TIMESTAMP=1169175117;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">update source_tab set name = '8' where name = '1';</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;"># at 379</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">#070119 10:52:10 server id 1  end_log_pos 406   Xid = 5</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">COMMIT;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;"># at 406</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">#070119 10:52:14 server id 1  end_log_pos 474   Query   thread_id=2     exec_time=0     error_code=0</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">SET TIMESTAMP=1169175134;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">BEGIN;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;"># at 474</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">#070119 10:51:29 server id 1  end_log_pos 119   Query   thread_id=2     exec_time=0     error_code=0</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">SET TIMESTAMP=1169175089;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">insert into target_tab select d1,name from source_tab where name = '1';</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;"># at 593</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">#070119 10:52:14 server id 1  end_log_pos 620   Xid = 7</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">COMMIT;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">......</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">    可以发现，在BINLOG中，更新操作的位置在INSERT...SELECT之前，如果使用这个BINLOG进行数据库恢复，恢复的结果与实际的应用逻辑不符；如果进行复制，就会导致主从数据库不一致！</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">通过上面的例子，我们就不难理解为什么MySQL在处理“Insert  into target_tab select * from source_tab where ...”和“create  table new_tab ...select ... From  source_tab where ...”时要给source_tab加锁，而不是使用对并发影响最小的多版本数据来实现一致性读。还要特别说明的是，如果上述语句的SELECT是范围条件，InnoDB还会给源表加间隙锁（Next-Lock）。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">因此，INSERT...SELECT...和 CREATE TABLE...SELECT...语句，可能会阻止对源表的并发更新，造成对源表锁的等待。如果查询比较复杂的话，会造成严重的性能问题，我们在应用中应尽量避免使用。实际上，MySQL将这种SQL叫作不确定（non-deterministic）的SQL，不推荐使用。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">如果应用中一定要用这种SQL来实现业务逻辑，又不希望对源表的并发更新产生影响，可以采取以下两种措施：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">一是采取上面示例中的做法，将innodb_locks_unsafe_for_binlog的值设置为“on”，强制MySQL使用多版本数据一致性读。但付出的代价是可能无法用binlog正确地恢复或复制数据，因此，不推荐使用这种方式。</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">二是通过使用“select * from source_tab ... Into outfile”和“load data infile ...”语句组合来间接实现，采用这种方式MySQL不会给source_tab加锁。</span></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 18px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">InnoDB在不同隔离级别下的一致性读及锁的差异</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">前面讲过，锁和多版本数据是InnoDB实现一致性读和ISO/ANSI SQL92隔离级别的手段，因此，在不同的隔离级别下，InnoDB处理SQL时采用的一致性读策略和需要的锁是不同的。同时，数据恢复和复制机制的特点，也对一些SQL的一致性读策略和锁策略有很大影响。将这些特性归纳成如下表所示的内容，以便读者查阅。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">                                          InnoDB存储引擎中不同SQL在不同隔离级别下锁比较</span></div><table border="1" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 143px;"></col><col style="width: 143px;"></col><col style="width: 143px;"></col><col style="width: 143px;"></col><col style="width: 143px;"></col><col style="width: 143px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td colspan="2" style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">隔离级别</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">        一致性读和锁</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">SQL</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Read Uncommited</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Read Commited</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Repeatable Read</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Serializable</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">SQL</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">条件</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td rowspan="2" style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">select</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">相等</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">None locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Consisten read/None lock</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Consisten read/None lock</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Share locks</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">范围</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">None locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Consisten read/None lock</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Consisten read/None lock</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Share Next-Key</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td rowspan="2" style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">update</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">相等</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Exclusive locks</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">范围</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive next-key</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive next-key</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive next-key</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive next-key</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Insert</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">N/A</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive locks</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td rowspan="2" style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">replace</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">无键冲突</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive locks</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">键冲突</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive next-key</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive next-key</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive next-key</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive next-key</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td rowspan="2" style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">delete</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">相等</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive locks</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">范围</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive next-key</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive next-key</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive next-key</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive next-key</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td rowspan="2" style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Select ... from ... Lock in share mode</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">相等</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Share locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Share locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Share locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Share locks</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">范围</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Share locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Share locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Share Next-Key</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Share Next-Key</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td rowspan="2" style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Select * from ... For update</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">相等</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive locks</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">范围</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Share locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive next-key</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">exclusive next-key</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td rowspan="2" style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Insert into ... Select ...</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">（指源表锁）</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">innodb_locks_unsafe_for_binlog=off</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Share Next-Key</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Share Next-Key</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Share Next-Key</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Share Next-Key</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">innodb_locks_unsafe_for_binlog=on</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">None locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Consisten read/None lock</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Consisten read/None lock</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Share Next-Key</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td rowspan="2" style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">create table ... Select ...</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">（指源表锁）</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">innodb_locks_unsafe_for_binlog=off</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Share Next-Key</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Share Next-Key</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Share Next-Key</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Share Next-Key</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">innodb_locks_unsafe_for_binlog=on</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">None locks</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Consisten read/None lock</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Consisten read/None lock</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Share Next-Key</span></div></td></tr></tbody></table><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">从上表可以看出：对于许多SQL，隔离级别越高，InnoDB给记录集加的锁就越严格（尤其是使用范围条件的时候），产生锁冲突的可能性也就越高，从而对并发性事务处理性能的影响也就越大。因此，我们在应用中，应该尽量使用较低的隔离级别，以减少锁争用的机率。实际上，通过优化事务逻辑，大部分应用使用Read Commited隔离级别就足够了。对于一些确实需要更高隔离级别的事务，可以通过在程序中执行SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ或SET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE动态改变隔离级别的方式满足需求。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br style="box-sizing: border-box;"/></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 18px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">什么时候使用表锁</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">对于InnoDB表，在绝大部分情况下都应该使用行级锁，因为事务和行锁往往是我们之所以选择InnoDB表的理由。但在个别特殊事务中，也可以考虑使用表级锁。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">第一种情况是：事务需要更新大部分或全部数据，表又比较大，如果使用默认的行锁，不仅这个事务执行效率低，而且可能造成其他事务长时间锁等待和锁冲突，这种情况下可以考虑使用表锁来提高该事务的执行速度。</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">第二种情况是：事务涉及多个表，比较复杂，很可能引起死锁，造成大量事务回滚。这种情况也可以考虑一次性锁定事务涉及的表，从而避免死锁、减少数据库因事务回滚带来的开销。</span></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">当然，应用中这两种事务不能太多，否则，就应该考虑使用MyISAM表了。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">在InnoDB下，使用表锁要注意以下两点。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">（1）使用LOCK TABLES虽然可以给InnoDB加表级锁，但必须说明的是，表锁不是由InnoDB存储引擎层管理的，而是由其上一层──MySQL Server负责的，仅当autocommit=0、innodb_table_locks=1（默认设置）时，InnoDB层才能知道MySQL加的表锁，MySQL Server也才能感知InnoDB加的行锁，这种情况下，InnoDB才能自动识别涉及表级锁的死锁；否则，InnoDB将无法自动检测并处理这种死锁。有关死锁，下一小节还会继续讨论。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">（2）在用 LOCK TABLES对InnoDB表加锁时要注意，要将AUTOCOMMIT设为0，否则MySQL不会给表加锁；事务结束前，不要用UNLOCK TABLES释放表锁，因为UNLOCK TABLES会隐含地提交事务；COMMIT或ROLLBACK并不能释放用LOCK TABLES加的表级锁，必须用UNLOCK TABLES释放表锁。</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">正确的方式见如下语句：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">例如，如果需要写表t1并从表t读，可以按如下做：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">SET AUTOCOMMIT=0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">LOCK TABLES t1 WRITE, t2 READ, ...;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">[do something with tables t1 and t2 here];</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">COMMIT;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">UNLOCK TABLES;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br style="box-sizing: border-box;"/></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 18px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">关于死锁</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">上文讲过，MyISAM表锁是deadlock free的，这是因为MyISAM总是一次获得所需的全部锁，要么全部满足，要么等待，因此不会出现死锁。但在InnoDB中，除单个SQL组成的事务外，锁是逐步获得的，这就决定了在InnoDB中发生死锁是可能的。如下所示的就是一个发生死锁的例子。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;"> </span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">InnoDB存储引擎中的死锁例子</span></div><table border="1" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 430px;"></col><col style="width: 430px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_1</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_2</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit = 0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from table_1 where where id=1 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">...</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">做一些其他处理...</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit = 0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from table_2 where id=1 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">...</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">select * from table_2 where id =1 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">因session_2已取得排他锁，等待</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">做一些其他处理...</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select * from table_1 where where id=1 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">死锁</span></div></td></tr></tbody></table><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">在上面的例子中，两个事务都需要获得对方持有的排他锁才能继续完成事务，这种循环锁等待就是典型的死锁。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(255, 102, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">发生死锁后，InnoDB一般都能自动检测到，并使一个事务释放锁并回退，另一个事务获得锁，继续完成事务。但在涉及外部锁，或涉及表锁的情况下，InnoDB并不能完全自动检测到死锁，这需要通过设置锁等待超时参数 innodb_lock_wait_timeout来解决。需要说明的是，这个参数并不是只用来解决死锁问题，在并发访问比较高的情况下，如果大量事务因无法立即获得所需的锁而挂起，会占用大量计算机资源，造成严重性能问题，甚至拖跨数据库。我们通过设置合适的锁等待超时阈值，可以避免这种情况发生。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">通常来说，死锁都是应用设计的问题，通过调整业务流程、数据库对象设计、事务大小，以及访问数据库的SQL语句，绝大部分死锁都可以避免。下面就通过实例来介绍几种避免死锁的常用方法。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">（1）在应用中，如果不同的程序会并发存取多个表，应尽量约定以相同的顺序来访问表，这样可以大大降低产生死锁的机会。在下面的例子中，由于两个session访问两个表的顺序不同，发生死锁的机会就非常高！但如果以相同的顺序来访问，死锁就可以避免。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">     </span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;"> </span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;"> InnoDB存储引擎中表顺序造成的死锁例子</span></div><table border="1" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 430px;"></col><col style="width: 430px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_1</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_2</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit=0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit=0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select first_name,last_name from actor where actor_id = 1 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| first_name | last_name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| PENELOPE   | GUINESS   |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; insert into country (country_id,country) values(110,'Test');</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 1 row affected (0.00 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt;  insert into country (country_id,country) values(110,'Test');</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">等待</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select first_name,last_name from actor where actor_id = 1 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| first_name | last_name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| PENELOPE   | GUINESS   |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt;  insert into country (country_id,country) values(110,'Test');</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr></tbody></table><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">（2）在程序以批量方式处理数据的时候，如果事先对数据排序，保证每个线程按固定的顺序来处理记录，也可以大大降低出现死锁的可能。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">       InnoDB存储引擎中表数据操作顺序不一致造成的死锁例子</span></div><table border="1" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 430px;"></col><col style="width: 430px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_1</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_2</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit=0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit=0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select first_name,last_name from actor where actor_id = 1 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| first_name | last_name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| PENELOPE   | GUINESS   |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select first_name,last_name from actor where actor_id = 3 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| first_name | last_name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| ED         | CHASE     |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select first_name,last_name from actor where actor_id = 3 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">等待</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select first_name,last_name from actor where actor_id = 1 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select first_name,last_name from actor where actor_id = 3 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| first_name | last_name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| ED         | CHASE     |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (4.71 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr></tbody></table><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">（3）在事务中，如果要更新记录，应该直接申请足够级别的锁，即排他锁，而不应先申请共享锁，更新时再申请排他锁，因为当用户申请排他锁时，其他事务可能又已经获得了相同记录的共享锁，从而造成锁冲突，甚至死锁。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">       （4）前面讲过，在REPEATABLE-READ隔离级别下，如果两个线程同时对相同条件记录用SELECT...FOR UPDATE加排他锁，在没有符合该条件记录情况下，两个线程都会加锁成功。程序发现记录尚不存在，就试图插入一条新记录，如果两个线程都这么做，就会出现死锁。这种情况下，将隔离级别改成READ COMMITTED，就可避免问题，如下所示。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">  </span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">InnoDB存储引擎中隔离级别引起的死锁例子1</span></div><table border="1" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 430px;"></col><col style="width: 430px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_1</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_2</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select @@tx_isolation;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+-----------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| @@tx_isolation  |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+-----------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| REPEATABLE-READ |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+-----------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit = 0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select @@tx_isolation;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+-----------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| @@tx_isolation  |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+-----------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| REPEATABLE-READ |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+-----------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit = 0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.00 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">当前session对不存在的记录加for update的锁：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select actor_id,first_name,last_name from actor where actor_id = 201 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Empty set (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">其他session也可以对不存在的记录加for update的锁：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select actor_id,first_name,last_name from actor where actor_id = 201 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Empty set (0.00 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">因为其他session也对该记录加了锁，所以当前的插入会等待：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; insert into actor (actor_id , first_name , last_name) values(201,'Lisa','Tom');</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">等待</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">因为其他session已经对记录进行了更新，这时候再插入记录就会提示死锁并退出：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; insert into actor (actor_id, first_name , last_name) values(201,'Lisa','Tom');</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">由于其他session已经退出，当前session可以获得锁并成功插入记录：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; insert into actor (actor_id , first_name , last_name) values(201,'Lisa','Tom');</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 1 row affected (13.35 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr></tbody></table><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">（5）</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">当隔离级别为READ COMMITTED时，如果两个线程都先执行SELECT...FOR UPDATE，判断是否存在符合条件的记录，如果没有，就插入记录。此时，只有一个线程能插入成功，另一个线程会出现锁等待，当第1个线程提交后，第2个线程会因主键重出错，但虽然这个线程出错了，却会获得一个排他锁！这时如果有第3个线程又来申请排他锁，也会出现死锁。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">对于这种情况，可以直接做插入操作，然后再捕获主键重异常，或者在遇到主键重错误时，总是执行ROLLBACK释放获得的排他锁，如下所示。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">   </span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">InnoDB存储引擎中隔离级别引起的死锁例子2</span></div><table border="1" style="box-sizing: border-box; border-collapse: collapse; width: 860px; text-align: left; margin-bottom: 24px; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><colgroup><col style="width: 287px;"></col><col style="width: 287px;"></col><col style="width: 287px;"></col></colgroup><tbody style="box-sizing: border-box; border: 0px;"><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_1</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_2</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">session_3</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select @@tx_isolation;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| @@tx_isolation |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| READ-COMMITTED |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit=0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.01 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select @@tx_isolation;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| @@tx_isolation |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| READ-COMMITTED |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit=0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.01 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select @@tx_isolation;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| @@tx_isolation |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| READ-COMMITTED |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+----------------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (0.00 sec)</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; set autocommit=0;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.01 sec)</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Session_1获得for update的共享锁：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select actor_id, first_name,last_name from actor where actor_id = 201 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Empty set (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">由于记录不存在，session_2也可以获得for update的共享锁：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select actor_id, first_name,last_name from actor where actor_id = 201 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Empty set (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Session_1可以成功插入记录：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; insert into actor (actor_id,first_name,last_name) values(201,'Lisa','Tom');</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 1 row affected (0.00 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Session_2插入申请等待获得锁：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; insert into actor (actor_id,first_name,last_name) values(201,'Lisa','Tom');</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">等待</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Session_1成功提交：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; commit;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Query OK, 0 rows affected (0.04 sec)</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Session_2获得锁，发现插入记录主键重，这个时候抛出了异常，但是并没有释放共享锁：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; insert into actor (actor_id,first_name,last_name) values(201,'Lisa','Tom');</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">ERROR 1062 (23000): Duplicate entry '201' for key 'PRIMARY'</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Session_3申请获得共享锁，因为session_2已经锁定该记录，所以session_3需要等待：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select actor_id, first_name,last_name from actor where actor_id = 201 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">等待</span></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">这个时候，如果session_2直接对记录进行更新操作，则会抛出死锁的异常：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; update actor set last_name='Lan' where actor_id = 201;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction</span></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td></tr><tr style="box-sizing: border-box; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247);"><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div><br style="box-sizing: border-box;"/></div></td><td style="box-sizing: border-box; border: 1px solid rgb(221, 221, 221); font-size: 14px; padding: 8px; text-align: left;" valign="top"><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">Session_2释放锁后，session_3获得锁：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">mysql&gt; select first_name, last_name from actor where actor_id = 201 for update;</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| first_name | last_name |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">| Lisa       | Tom       |</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">+------------+-----------+</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px;">1 row in set (31.12 sec)</span></div></td></tr></tbody></table><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">尽管通过上面介绍的设计和SQL优化等措施，可以大大减少死锁，但死锁很难完全避免。因此，在程序设计中总是捕获并处理死锁异常是一个很好的编程习惯。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">如果出现死锁，可以用SHOW INNODB STATUS命令来确定最后一个死锁产生的原因。返回结果中包括死锁相关事务的详细信息，如引发死锁的SQL语句，事务已经获得的锁，正在等待什么锁，以及被回滚的事务等。据此可以分析死锁产生的原因和改进措施。下面是一段SHOW INNODB STATUS输出的样例：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql&gt; show innodb status \G</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">…….</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">------------------------</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">LATEST DETECTED DEADLOCK</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">------------------------</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">070710 14:05:16</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">*** (1) TRANSACTION:</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">TRANSACTION 0 117470078, ACTIVE 117 sec, process no 1468, OS thread id 1197328736 inserting</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql tables in use 1, locked 1</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">LOCK WAIT 5 lock struct(s), heap size 1216</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">MySQL thread id 7521657, query id 673468054 localhost root update</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">insert into country (country_id,country) values(110,'Test')</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">………</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">*** (2) TRANSACTION:</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">TRANSACTION 0 117470079, ACTIVE 39 sec, process no 1468, OS thread id 1164048736 starting index read, thread declared inside InnoDB 500</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">mysql tables in use 1, locked 1</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">4 lock struct(s), heap size 1216, undo log entries 1</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">MySQL thread id 7521664, query id 673468058 localhost root statistics</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">select first_name,last_name from actor where actor_id = 1 for update</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">*** (2) HOLDS THE LOCK(S):</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">………</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">*** (2) WAITING FOR THIS LOCK TO BE GRANTED:</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">………</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">*** WE ROLL BACK TRANSACTION (1)</span></div><div><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(69, 69, 69); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">……</span></div></div><div><br/></div></span>
</div></body></html> 