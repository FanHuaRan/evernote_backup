<html>
<head>
  <title>Exchanger的用法和原理</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1613"/>
<h1>Exchanger的用法和原理</h1>

<div>
<span><div><b><font style="color: rgb(20, 113, 145); font-size: 18pt;">Exchanger的用法</font></b></div><div>字如其名，Exchanger用于在两个线程当中安全的交换对象</div><div style="clear: both; margin: 0px 20px; padding: 5px 0px 0px; color: rgb(53, 56, 51); font-family: &quot;DejaVu Sans&quot;, Arial, Helvetica, sans-serif; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="margin: 5px 0px 0px;">java.util.concurrent</div><h2 style="font-size: 18px; color: rgb(44, 69, 87); margin: 10px 0px;" title="Class Exchanger"><span style="font-size: 18px; color: rgb(44, 69, 87);" title="Class Exchanger">Class Exchanger&lt;V&gt;</span></h2></div><div><div><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html" style="color: rgb(74, 103, 130);" title="class in java.lang">java.lang.Object</a>java.util.concurrent.Exchanger&lt;V&gt;</div><ul style="list-style-type: disc; margin: 10px 0px; padding: 0px;"><li style="list-style: none; margin-bottom: 15px; line-height: 1.4;"><span style="font-weight: bold;">Type Parameters:</span><br/><code style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; padding-top: 4px; margin-top: 8px; line-height: 1.4em;">V</code><span> </span>- The type of objects that may be exchanged<br/><br/><div>public class <span style="font-weight: bold;">Exchanger&lt;V&gt;</span></div><div>extends <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html" style="color: rgb(74, 103, 130);" title="class in java.lang">Object</a></div><br/><div>A synchronization point at which threads can pair and swap elements within pairs. Each thread presents some object on entry to the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Exchanger.html#exchange-V-" style="color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">exchange</a> method, matches with a partner thread, and receives its partner's object on return. An Exchanger may be viewed as a bidirectional form of a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/SynchronousQueue.html" style="color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;" title="class in java.util.concurrent">SynchronousQueue</a>. Exchangers may be useful in applications such as genetic algorithms and pipeline designs.</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold;-en-paragraph:true;">Sample Usage:</span><span style="-en-paragraph:true;"> </span><span style="-en-paragraph:true;">Here are the highlights of a class that uses an</span><span style="-en-paragraph:true;"> </span><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;-en-paragraph:true;">Exchanger</span><span style="-en-paragraph:true;"> </span><span style="-en-paragraph:true;">to swap buffers between threads so that the thread filling the buffer gets a freshly emptied one when it needs it, handing off the filled one to the thread emptying the buffer.</span></div><div style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; margin-top: 0px;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">class FillAndEmpty {</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">Exchanger&lt;DataBuffer&gt; exchanger = new Exchanger&lt;DataBuffer&gt;();</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">DataBuffer initialEmptyBuffer = ... a made-up type</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">DataBuffer initialFullBuffer = ...</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">class FillingLoop implements Runnable {</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">public void run() {</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">DataBuffer currentBuffer = initialEmptyBuffer;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">try {</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">while (currentBuffer != null) {</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">addToBuffer(currentBuffer);</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">if (currentBuffer.isFull())</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">currentBuffer = exchanger.exchange(currentBuffer);</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">}</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">} catch (InterruptedException ex) { ... handle ... }</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">}</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">}</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">class EmptyingLoop implements Runnable {</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">public void run() {</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">DataBuffer currentBuffer = initialFullBuffer;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">try {</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">while (currentBuffer != null) {</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">takeFromBuffer(currentBuffer);</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">if (currentBuffer.isEmpty())</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">currentBuffer = exchanger.exchange(currentBuffer);</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">}</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">} catch (InterruptedException ex) { ... handle ...}</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">}</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">}</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">void start() {</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">new Thread(new FillingLoop()).start();</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">new Thread(new EmptyingLoop()).start();</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">}</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">}</span></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">Memory consistency effects: For each pair of threads that successfully exchange objects via an</span><span style="-en-paragraph:true;"> </span><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;-en-paragraph:true;">Exchanger</span><span style="-en-paragraph:true;">, actions prior to the</span><span style="-en-paragraph:true;"> </span><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;-en-paragraph:true;">exchange()</span><span style="-en-paragraph:true;"> </span><span style="-en-paragraph:true;">in each thread</span><span style="-en-paragraph:true;"> </span><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/package-summary.html#MemoryVisibility" style="color: rgb(74, 103, 130); font-style: italic;-en-paragraph:true;">happen-before</a><span style="-en-paragraph:true;"> </span><span style="-en-paragraph:true;">those subsequent to a return from the corresponding</span><span style="-en-paragraph:true;"> </span><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;-en-paragraph:true;">exchange()</span><span style="-en-paragraph:true;"> </span><span style="-en-paragraph:true;">in the other thread.</span></div><br/><span style="font-weight: bold;">Since:</span><br/>
1.5</li></ul><ul style="list-style-type: disc; margin: 10px 0px; padding: 0px;"><li style="list-style: none; margin-bottom: 15px; line-height: 1.4; padding: 0px 20px 5px 10px; border: 1px solid rgb(237, 237, 237); background-color: rgb(248, 248, 248);"><span style="font-size: 16px; font-style: italic;">Constructor Summary</span></li><table border="0" cellpadding="3" cellspacing="0" style="width: 1509px; border-left: 1px solid rgb(238, 238, 238); border-right: 1px solid rgb(238, 238, 238); border-bottom: 1px solid rgb(238, 238, 238); padding: 0px;" summary="Constructor Summary table, listing constructors, and an explanation"><colgroup><col style="width: 1499px;"></col></colgroup><tbody><tr><td style="vertical-align: top; padding: 8px 3px 3px 7px; background: rgb(222, 227, 233); text-align: left; font-size: 13px;"><div>Constructor and Description</div></td></tr><tr style="background-color: rgb(255, 255, 255);"><td style="text-align: left; padding: 8px 0px 3px 10px; vertical-align: top; font-size: 13px;"><div><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Exchanger.html#Exchanger--" style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em; font-weight: bold; color: rgb(74, 103, 130);">Exchanger</a><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">()</span></div><div style="margin: 3px 10px 2px 0px; color: rgb(71, 71, 71); font-size: 14px; font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;"><span style="color: rgb(71, 71, 71); font-size: 14px; font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;">Creates a new Exchanger.</span></div></td></tr></tbody></table><li style="list-style: none; margin-bottom: 15px; line-height: 1.4; padding: 0px 20px 5px 10px; border: 1px solid rgb(237, 237, 237); background-color: rgb(248, 248, 248);"><span style="font-size: 16px; font-style: italic;">Method Summary</span></li><table border="0" cellpadding="3" cellspacing="0" style="width: 1509px; border-left: 1px solid rgb(238, 238, 238); border-right: 1px solid rgb(238, 238, 238); border-bottom: 1px solid rgb(238, 238, 238); padding: 0px;" summary="Method Summary table, listing methods, and an explanation"><colgroup><col style="width: 367px;"></col><col style="width: 130px;"></col></colgroup><tbody><tr><td style="vertical-align: top; padding: 8px 3px 3px 7px; background: rgb(222, 227, 233); text-align: left; white-space: nowrap; font-size: 13px;"><div>Modifier and Type</div></td><td style="vertical-align: top; padding: 8px 3px 3px 7px; background: rgb(222, 227, 233); text-align: left; font-size: 13px;"><div>Method and Description</div></td></tr><tr style="background-color: rgb(255, 255, 255);"><td style="text-align: left; padding: 8px 0px 3px 10px; vertical-align: top; white-space: nowrap; font-size: 13px;"><div><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Exchanger.html" style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em; color: rgb(74, 103, 130); font-weight: bold;" title="type parameter in Exchanger">V</a></div></td><td style="text-align: left; padding: 8px 0px 3px 10px; vertical-align: top; font-size: 13px;"><div><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Exchanger.html#exchange-V-" style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em; font-weight: bold; color: rgb(74, 103, 130);">exchange</a><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">(</span><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Exchanger.html" style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em; color: rgb(74, 103, 130); font-weight: bold;" title="type parameter in Exchanger">V</a><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;"> x)</span></div><div style="margin: 3px 10px 2px 0px; color: rgb(71, 71, 71); font-size: 14px; font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif; padding-top: 0px;"><span style="color: rgb(71, 71, 71); font-size: 14px; font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;">Waits for another thread to arrive at this exchange point (unless the current thread is</span><span style="color: rgb(71, 71, 71); font-size: 14px; font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;"> </span><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html#interrupt--" style="color: rgb(74, 103, 130); font-size: 14px; font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif; font-weight: bold;">interrupted</a><span style="color: rgb(71, 71, 71); font-size: 14px; font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;">), and then transfers the given object to it, receiving its object in return.</span></div></td></tr><tr style="background-color: rgb(238, 238, 239);"><td style="text-align: left; padding: 8px 0px 3px 10px; vertical-align: top; white-space: nowrap; font-size: 13px;"><div><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Exchanger.html" style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em; color: rgb(74, 103, 130); font-weight: bold;" title="type parameter in Exchanger">V</a></div></td><td style="text-align: left; padding: 8px 0px 3px 10px; vertical-align: top; font-size: 13px;"><div><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Exchanger.html#exchange-V-long-java.util.concurrent.TimeUnit-" style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em; font-weight: bold; color: rgb(74, 103, 130);">exchange</a><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">(</span><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Exchanger.html" style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em; color: rgb(74, 103, 130); font-weight: bold;" title="type parameter in Exchanger">V</a><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;"> x, long timeout,</span><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/TimeUnit.html" style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em; color: rgb(74, 103, 130); font-weight: bold;" title="enum in java.util.concurrent">TimeUnit</a><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;"> unit)</span></div><div style="margin: 3px 10px 2px 0px; color: rgb(71, 71, 71); font-size: 14px; font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif; padding-top: 0px;"><span style="color: rgb(71, 71, 71); font-size: 14px; font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;">Waits for another thread to arrive at this exchange point (unless the current thread is</span><span style="color: rgb(71, 71, 71); font-size: 14px; font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;"> </span><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html#interrupt--" style="color: rgb(74, 103, 130); font-size: 14px; font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif; font-weight: bold;">interrupted</a><span style="color: rgb(71, 71, 71); font-size: 14px; font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;"> </span><span style="color: rgb(71, 71, 71); font-size: 14px; font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;">or the specified waiting time elapses), and then transfers the given object to it, receiving its object in return.</span></div></td></tr></tbody></table><ul style="list-style-type: disc; margin: 10px 0px; padding: 0px;"><li style="list-style: none; margin-bottom: 15px; line-height: 1.4; padding: 0px 0px 5px 8px; border: none; background-color: rgb(255, 255, 255);"><span style="font-size: 16px; background-color: rgb(222, 227, 233); border: 1px solid rgb(208, 217, 224);">Methods inherited from class java.lang.</span><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html" style="font-size: 16px; background-color: rgb(222, 227, 233); border: 1px solid rgb(208, 217, 224); color: rgb(74, 103, 130);" title="class in java.lang">Object</a><br/><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#clone--" style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em; color: rgb(74, 103, 130);">clone</a><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">,</span><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#equals-java.lang.Object-" style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em; color: rgb(74, 103, 130);">equals</a><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">,</span><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#finalize--" style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em; color: rgb(74, 103, 130);">finalize</a><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">,</span><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#getClass--" style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em; color: rgb(74, 103, 130);">getClass</a><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">,</span><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#hashCode--" style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em; color: rgb(74, 103, 130);">hashCode</a><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">,</span><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#notify--" style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em; color: rgb(74, 103, 130);">notify</a><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">,</span><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#notifyAll--" style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em; color: rgb(74, 103, 130);">notifyAll</a><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">,</span><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#toString--" style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em; color: rgb(74, 103, 130);">toString</a><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">,</span><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#wait--" style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em; color: rgb(74, 103, 130);">wait</a><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">,</span><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#wait-long-" style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em; color: rgb(74, 103, 130);">wait</a><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;">,</span><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;"> </span><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#wait-long-int-" style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em; color: rgb(74, 103, 130);">wait</a></li></ul></ul><ul style="list-style-type: disc; margin: 10px 0px; padding: 0px;"><li style="list-style: none; margin-bottom: 15px; line-height: 1.4; padding: 0px 20px 5px 10px; border: 1px solid rgb(237, 237, 237); background-color: rgb(248, 248, 248);"><span style="font-size: 16px; font-style: italic;">Constructor Detail</span></li><ul style="list-style-type: disc; margin: 10px 0px; padding: 0px;"><li style="list-style: none; margin-bottom: 15px; line-height: 1.4; padding: 0px 0px 5px 8px; border: none; background-color: rgb(255, 255, 255);"><span style="font-size: 13px; background-color: rgb(222, 227, 233); border: 1px solid rgb(208, 217, 224);">Exchanger</span><br/><span style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px;">public Exchanger()</span><br/><span style="color: rgb(71, 71, 71); font-size: 14px; font-family: &quot;DejaVu Serif&quot;, Georgia, &quot;Times New Roman&quot;, Times, serif;">Creates a new Exchanger.</span></li></ul><li style="list-style: none; margin-bottom: 15px; line-height: 1.4; padding: 0px 20px 5px 10px; border: 1px solid rgb(237, 237, 237); background-color: rgb(248, 248, 248);"><span style="font-size: 16px; font-style: italic;">Method Detail</span></li><ul style="list-style-type: disc; margin: 10px 0px; padding: 0px;"><li style="list-style: none; margin-bottom: 15px; line-height: 1.4; padding: 0px 0px 5px 8px; border: none; background-color: rgb(255, 255, 255);"><span style="font-size: 13px; background-color: rgb(222, 227, 233); border: 1px solid rgb(208, 217, 224);">exchange</span><br/><div>public <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Exchanger.html" style="color: rgb(74, 103, 130);" title="type parameter in Exchanger">V</a> exchange(<a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Exchanger.html" style="color: rgb(74, 103, 130);" title="type parameter in Exchanger">V</a> x)</div><div>throws <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/InterruptedException.html" style="color: rgb(74, 103, 130);" title="class in java.lang">InterruptedException</a></div><br/><div>Waits for another thread to arrive at this exchange point (unless the current thread is <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html#interrupt--" style="color: rgb(74, 103, 130);">interrupted</a>), and then transfers the given object to it, receiving its object in return.</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">If another thread is already waiting at the exchange point then it is resumed for thread scheduling purposes and receives the object passed in by the current thread. The current thread returns immediately, receiving the object passed to the exchange by that other thread.</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">If no other thread is already waiting at the exchange then the current thread is disabled for thread scheduling purposes and lies dormant until one of two things happens:</span></div><ul style="list-style-type: disc;"><li>Some other thread enters the exchange; or</li><li>Some other thread <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html#interrupt--" style="color: rgb(74, 103, 130);">interrupts</a> the current thread.</li></ul><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">If the current thread:</span></div><ul style="list-style-type: disc;"><li>has its interrupted status set on entry to this method; or</li><li>is <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html#interrupt--" style="color: rgb(74, 103, 130);">interrupted</a> while waiting for the exchange,</li></ul><div>then <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/InterruptedException.html" style="color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;" title="class in java.lang">InterruptedException</a> is thrown and the current thread's interrupted status is cleared.</div><br/><span style="font-weight: bold;">Parameters:</span><br/><code style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; padding-top: 4px; margin-top: 8px; line-height: 1.4em;">x</code><span> </span>- the object to exchange<br/><span style="font-weight: bold;">Returns:</span><br/>
the object provided by the other thread<br/><span style="font-weight: bold;">Throws:</span><br/><code style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; padding-top: 4px; margin-top: 8px; line-height: 1.4em;"><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/InterruptedException.html" style="text-decoration: none; color: rgb(74, 103, 130);" title="class in java.lang">InterruptedException</a></code><span> </span>- if the current thread was interrupted while waiting</li><li style="list-style: none; margin-bottom: 15px; line-height: 1.4; padding: 0px 0px 5px 8px; border: none;"><span style="font-size: 13px; background-color: rgb(222, 227, 233); border: 1px solid rgb(208, 217, 224);">exchange</span><br/><div>public <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Exchanger.html" style="color: rgb(74, 103, 130);" title="type parameter in Exchanger">V</a> exchange(<a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Exchanger.html" style="color: rgb(74, 103, 130);" title="type parameter in Exchanger">V</a> x,</div><div>long timeout,</div><div><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/TimeUnit.html" style="color: rgb(74, 103, 130);" title="enum in java.util.concurrent">TimeUnit</a> unit)</div><div>throws <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/InterruptedException.html" style="color: rgb(74, 103, 130);" title="class in java.lang">InterruptedException</a>,</div><div><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/TimeoutException.html" style="color: rgb(74, 103, 130);" title="class in java.util.concurrent">TimeoutException</a></div><br/><div>Waits for another thread to arrive at this exchange point (unless the current thread is <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html#interrupt--" style="color: rgb(74, 103, 130);">interrupted</a> or the specified waiting time elapses), and then transfers the given object to it, receiving its object in return.</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">If another thread is already waiting at the exchange point then it is resumed for thread scheduling purposes and receives the object passed in by the current thread. The current thread returns immediately, receiving the object passed to the exchange by that other thread.</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">If no other thread is already waiting at the exchange then the current thread is disabled for thread scheduling purposes and lies dormant until one of three things happens:</span></div><ul style="list-style-type: disc;"><li>Some other thread enters the exchange; or</li><li>Some other thread <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html#interrupt--" style="color: rgb(74, 103, 130);">interrupts</a> the current thread; or</li><li>The specified waiting time elapses.</li></ul><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">If the current thread:</span></div><ul style="list-style-type: disc;"><li>has its interrupted status set on entry to this method; or</li><li>is <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html#interrupt--" style="color: rgb(74, 103, 130);">interrupted</a> while waiting for the exchange,</li></ul><div>then <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/InterruptedException.html" style="color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;" title="class in java.lang">InterruptedException</a> is thrown and the current thread's interrupted status is cleared.</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">If the specified waiting time elapses then</span><span style="-en-paragraph:true;"> </span><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/TimeoutException.html" style="color: rgb(74, 103, 130); font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; line-height: 1.4em;-en-paragraph:true;" title="class in java.util.concurrent">TimeoutException</a><span style="-en-paragraph:true;"> </span><span style="-en-paragraph:true;">is thrown. If the time is less than or equal to zero, the method will not wait at all.</span></div><br/><span style="font-weight: bold;">Parameters:</span><br/><code style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; padding-top: 4px; margin-top: 8px; line-height: 1.4em;">x</code><span> </span>- the object to exchange<br/><code style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; padding-top: 4px; margin-top: 8px; line-height: 1.4em;">timeout</code><span> </span>- the maximum time to wait<br/><code style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; padding-top: 4px; margin-top: 8px; line-height: 1.4em;">unit</code><span> </span>- the time unit of the<span> </span><code style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; padding-top: 4px; margin-top: 8px; line-height: 1.4em;">timeout</code><span> </span>argument<br/><span style="font-weight: bold;">Returns:</span><br/>
the object provided by the other thread<br/><span style="font-weight: bold;">Throws:</span><br/><code style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; padding-top: 4px; margin-top: 8px; line-height: 1.4em;"><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/InterruptedException.html" style="text-decoration: none; color: rgb(74, 103, 130);" title="class in java.lang">InterruptedException</a></code><span> </span>- if the current thread was interrupted while waiting<br/><code style="font-family: &quot;DejaVu Sans Mono&quot;, monospace; font-size: 14px; padding-top: 4px; margin-top: 8px; line-height: 1.4em;"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/TimeoutException.html" style="text-decoration: none; color: rgb(74, 103, 130);" title="class in java.util.concurrent">TimeoutException</a></code><span> </span>- if the specified waiting time elapses before another thread enters the exchange</li></ul></ul></div><div><b><font color="#147191" style="font-size: 18pt;">Exchanger源码解析</font></b></div><div>--------</div><div>源码如下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * A synchronization point at which threads can pair and swap elements</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * within pairs.  Each thread presents some object on entry to the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link #exchange exchange}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">method, matches with a partner thread,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * and receives its partner's object on return.  An Exchanger may be</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * viewed as a bidirectional form of a</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link SynchronousQueue}</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * Exchangers may be useful in applications such as genetic algorithms</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * and pipeline designs.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;&lt;b&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Sample Usage:</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/b&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * Here are the highlights of a class that uses an {@code Exchanger}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * to swap buffers between threads so that the thread filling the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * buffer gets a freshly emptied one when it needs it, handing off the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * filled one to the thread emptying the buffer.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;pre&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">{@code</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * class FillAndEmpty {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *   Exchanger&lt;DataBuffer&gt; exchanger = new Exchanger&lt;DataBuffer&gt;();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *   DataBuffer initialEmptyBuffer = ... a made-up type</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *   DataBuffer initialFullBuffer = ...</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *   class FillingLoop implements Runnable {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *     public void run() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *       DataBuffer currentBuffer = initialEmptyBuffer;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *       try {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *         while (currentBuffer != null) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *           addToBuffer(currentBuffer);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *           if (currentBuffer.isFull())</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *             currentBuffer = exchanger.exchange(currentBuffer);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *         }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *       } catch (InterruptedException ex) { ... handle ... }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *     }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *   }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *   class EmptyingLoop implements Runnable {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *     public void run() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *       DataBuffer currentBuffer = initialFullBuffer;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *       try {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *         while (currentBuffer != null) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *           takeFromBuffer(currentBuffer);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *           if (currentBuffer.isEmpty())</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *             currentBuffer = exchanger.exchange(currentBuffer);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *         }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *       } catch (InterruptedException ex) { ... handle ...}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *     }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *   }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *   void start() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *     new Thread(new FillingLoop()).start();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *     new Thread(new EmptyingLoop()).start();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *   }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * }}</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/pre&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Memory consistency effects: For each pair of threads that</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * successfully exchange objects via an {@code Exchanger}, actions</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * prior to the {@code exchange()} in each thread</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * &lt;a href=&quot;package-summary.html#MemoryVisibility&quot;&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;i&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">happen</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">before</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/i&gt;&lt;/a&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * those subsequent to a return from the corresponding {@code exchange()}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * in the other thread.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@since</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">1.5</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@author</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Doug Lea and Bill Scherer and Michael Scott</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;V&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">The type of objects that may be exchanged</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">class</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Exchanger&lt;V&gt; {</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">/*</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * Overview: The core algorithm is, for an exchange &quot;slot&quot;,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * and a participant (caller) with an item:</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * for (;;) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *   if (slot is empty) {                       // offer</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *     place item in a Node;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *     if (can CAS slot from empty to node) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *       wait for release;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *       return matching item in node;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *     }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *   }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *   else if (can CAS slot from node to empty) { // release</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *     get the item in node;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *     set matching item in node;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *     release waiting thread;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *   }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *   // else retry on CAS failure</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * This is among the simplest forms of a &quot;dual data structure&quot; --</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * see Scott and Scherer's DISC 04 paper and</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * <a href="http://www.cs.rochester.edu/research/synchronization/pseudocode/duals.html">http://www.cs.rochester.edu/research/synchronization/pseudocode/duals.html</a></span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * This works great in principle. But in practice, like many</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * algorithms centered on atomic updates to a single location, it</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * scales horribly when there are more than a few participants</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * using the same Exchanger. So the implementation instead uses a</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * form of elimination arena, that spreads out this contention by</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * arranging that some threads typically use different slots,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * while still ensuring that eventually, any two parties will be</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * able to exchange items. That is, we cannot completely partition</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * across threads, but instead give threads arena indices that</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * will on average grow under contention and shrink under lack of</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * contention. We approach this by defining the Nodes that we need</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * anyway as ThreadLocals, and include in them per-thread index</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * and related bookkeeping state. (We can safely reuse per-thread</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * nodes rather than creating them fresh each time because slots</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * alternate between pointing to a node vs null, so cannot</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * encounter ABA problems. However, we do need some care in</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * resetting them between uses.)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * Implementing an effective arena requires allocating a bunch of</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * space, so we only do so upon detecting contention (except on</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * uniprocessors, where they wouldn't help, so aren't used).</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * Otherwise, exchanges use the single-slot slotExchange method.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * On contention, not only must the slots be in different</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * locations, but the locations must not encounter memory</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * contention due to being on the same cache line (or more</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * generally, the same coherence unit).  Because, as of this</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * writing, there is no way to determine cacheline size, we define</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * a value that is enough for common platforms.  Additionally,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * extra care elsewhere is taken to avoid other false/unintended</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * sharing and to enhance locality, including adding padding (via</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * sun.misc.Contended) to Nodes, embedding &quot;bound&quot; as an Exchanger</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * field, and reworking some park/unpark mechanics compared to</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * LockSupport versions.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * The arena starts out with only one used slot. We expand the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * effective arena size by tracking collisions; i.e., failed CASes</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * while trying to exchange. By nature of the above algorithm, the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * only kinds of collision that reliably indicate contention are</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * when two attempted releases collide -- one of two attempted</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * offers can legitimately fail to CAS without indicating</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * contention by more than one other thread. (Note: it is possible</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * but not worthwhile to more precisely detect contention by</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * reading slot values after CAS failures.)  When a thread has</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * collided at each slot within the current arena bound, it tries</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * to expand the arena size by one. We track collisions within</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * bounds by using a version (sequence) number on the &quot;bound&quot;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * field, and conservatively reset collision counts when a</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * participant notices that bound has been updated (in either</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * direction).</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * The effective arena size is reduced (when there is more than</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * one slot) by giving up on waiting after a while and trying to</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * decrement the arena size on expiration. The value of &quot;a while&quot;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * is an empirical matter.  We implement by piggybacking on the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * use of spin-&gt;yield-&gt;block that is essential for reasonable</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * waiting performance anyway -- in a busy exchanger, offers are</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * usually almost immediately released, in which case context</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * switching on multiprocessors is extremely slow/wasteful.  Arena</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * waits just omit the blocking part, and instead cancel. The spin</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * count is empirically chosen to be a value that avoids blocking</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * 99% of the time under maximum sustained exchange rates on a</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * range of test machines. Spins and yields entail some limited</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * randomness (using a cheap xorshift) to avoid regular patterns</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * that can induce unproductive grow/shrink cycles. (Using a</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * pseudorandom also helps regularize spin cycle duration by</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * making branches unpredictable.)  Also, during an offer, a</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * waiter can &quot;know&quot; that it will be released when its slot has</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * changed, but cannot yet proceed until match is set.  In the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * mean time it cannot cancel the offer, so instead spins/yields.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * Note: It is possible to avoid this secondary check by changing</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * the linearization point to be a CAS of the match field (as done</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * in one case in the Scott &amp; Scherer DISC paper), which also</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * increases asynchrony a bit, at the expense of poorer collision</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * detection and inability to always reuse per-thread nodes. So</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * the current scheme is typically a better tradeoff.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * On collisions, indices traverse the arena cyclically in reverse</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * order, restarting at the maximum index (which will tend to be</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * sparsest) when bounds change. (On expirations, indices instead</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * are halved until reaching 0.) It is possible (and has been</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * tried) to use randomized, prime-value-stepped, or double-hash</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * style traversal instead of simple cyclic traversal to reduce</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * bunching.  But empirically, whatever benefits these may have</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * don't overcome their added overhead: We are managing operations</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * that occur very quickly unless there is sustained contention,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * so simpler/faster control policies work better than more</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * accurate but slower ones.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * Because we use expiration for arena size control, we cannot</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * throw TimeoutExceptions in the timed version of the public</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * exchange method until the arena size has shrunken to zero (or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * the arena isn't enabled). This may delay response to timeout</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * but is still within spec.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * Essentially all of the implementation is in methods</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * slotExchange and arenaExchange. These have similar overall</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * structure, but differ in too many details to combine. The</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * slotExchange method uses the single Exchanger field &quot;slot&quot;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * rather than arena array elements. However, it still needs</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * minimal collision detection to trigger arena construction.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * (The messiest part is making sure interrupt status and</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * InterruptedExceptions come out right during transitions when</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * both methods may be called. This is done by using null return</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * as a sentinel to recheck interrupt status.)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * As is too common in this sort of code, methods are monolithic</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * because most of the logic relies on reads of fields that are</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * maintained as local variables so can't be nicely factored --</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * mainly, here, bulky spin-&gt;yield-&gt;block/cancel code), and</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * heavily dependent on intrinsics (Unsafe) to use inlined</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * embedded CAS and related memory access operations (that tend</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * not to be as readily inlined by dynamic compilers when they are</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * hidden behind other methods that would more nicely name and</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * encapsulate the intended effects). This includes the use of</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * putOrderedX to clear fields of the per-thread Nodes between</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * uses. Note that field Node.item is not declared as volatile</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * even though it is read by releasing threads, because they only</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * do so after CAS operations that must precede access, and all</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * uses by the owning thread are otherwise acceptably ordered by</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * other operations. (Because the actual points of atomicity are</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * slot CASes, it would also be legal for the write to Node.match</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * in a release to be weaker than a full volatile write. However,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * this is not done because it could allow further postponement of</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * the write, delaying progress.)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * The byte distance (as a shift value) between any two used slots</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * in the arena.  1 &lt;&lt; ASHIFT should be at least cacheline size.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">ASHIFT</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= 7;</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * The maximum supported arena index. The maximum allocatable</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * arena size is MMASK + 1. Must be a power of two minus one, less</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * than (1&lt;&lt;(31-ASHIFT)). The cap of 255 (0xff) more than suffices</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * for the expected scaling limits of the main algorithms.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">MMASK</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= 0xff;</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Unit for sequence/version bits of bound field. Each successful</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * change to the bound also adds SEQ.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">SEQ</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">MMASK</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">+ 1;</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/** The number of CPUs, for sizing and spin control */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">NCPU</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= Runtime.</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; font-style: italic; color: rgb(51, 51, 51);">getRuntime</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">().availableProcessors();</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * The maximum slot index of the arena: The number of slots that</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * can in principle hold all threads without contention, or at</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * most the maximum indexable value.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">FULL</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">NCPU</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&gt;= (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">MMASK</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;&lt; 1)) ?</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">MMASK</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">:</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">NCPU</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&gt;&gt;&gt; 1;</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * The bound for spins while waiting for a match. The actual</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * number of iterations will on average be about twice this value</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * due to randomization. Note: Spinning is disabled when NCPU==1.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">SPINS</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= 1 &lt;&lt; 10;</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Value representing null arguments/returns from public</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * methods. Needed because the API originally didn't disallow null</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * arguments, which it should have.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Object</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">NULL_ITEM</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Object();</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Sentinel value returned by internal exchange methods upon</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * timeout, to avoid need for separate timed versions of these</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * methods.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Object</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">TIMED_OUT</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Object();</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Nodes hold partially exchanged data, plus other per</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">thread</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * bookkeeping. Padded via</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@sun.misc.Contended</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">to reduce memory</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * contention.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(100, 100, 100); font-size: 14pt;">@</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">sun.misc.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(100, 100, 100); font-size: 14pt;">Contended</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">class</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Node {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">index</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;             </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// Arena index</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">bound</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;             </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// Last recorded value of Exchanger.bound</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">collides</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;          </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// Number of CAS failures at current bound</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">hash</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;              </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// Pseudo-random for spins</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        Object</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// This thread's current item</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">volatile</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Object</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">match</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">; </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// Item provided by releasing thread</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">volatile</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Thread</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">parked</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// Set to this thread when parked, else null</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/** The corresponding thread local class */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">class</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Participant</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">extends</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ThreadLocal&lt;Node&gt; {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Node initialValue() {</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Node(); }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Per</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">thread state</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Participant</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">participant</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Elimination array; null until enabled (within slotExchange).</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Element accesses use emulation of volatile gets and CAS.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">volatile</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Node[]</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">arena</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Slot used until contention detected.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">volatile</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Node</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">slot</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * The index of the largest valid arena position, OR'ed with SEQ</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * number in high bits, incremented on each update.  The initial</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * update from 0 to SEQ is used to ensure that the arena array is</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * constructed only once.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">volatile</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">bound</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Exchange function when arenas enabled. See above for explanation.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">item the (non</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">null) item to exchange</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">timed true if the wait is timed</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">ns if timed, the maximum wait time, else 0L</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">the other thread's item; or null if interrupted; or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * TIMED_OUT if timed and timed out</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Object arenaExchange(Object</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">boolean</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">timed</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">long</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ns</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        Node[]</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">arena</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        Node</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">participant</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.get();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">for</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">index</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;;) {                     </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// access slot at i</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">b</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">m</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">long</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">j</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;                      </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// j is raw array offset</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            Node</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= (Node)</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.getObjectVolatile(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">j</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;&lt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">ASHIFT</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) +</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">ABASE</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&amp;&amp;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.compareAndSwapObject(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">j</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                Object</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;                    </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// release</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">match</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                Thread</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">w</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">parked</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">w</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.unpark(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">w</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">else</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;= (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">m</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">b</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">bound</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) &amp;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">MMASK</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) &amp;&amp;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;                        </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// offer</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.compareAndSwapObject(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">j</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">long</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">end</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">timed</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&amp;&amp;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">m</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">== 0) ? System.</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; font-style: italic; color: rgb(51, 51, 51);">nanoTime</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">() +</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ns</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">: 0L;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                    Thread</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">t</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= Thread.</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; font-style: italic; color: rgb(51, 51, 51);">currentThread</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">();</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// wait</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">for</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">hash</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">spins</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">SPINS</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;;) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                        Object</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">match</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.putOrderedObject(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">MATCH</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;            </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// clear for next use</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">hash</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">else</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">spins</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&gt; 0) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">^=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;&lt; 1;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">^=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&gt;&gt;&gt; 3;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">^=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;&lt; 10;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// xorshift</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">== 0)               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// initialize hash</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">SPINS</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">| (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">t</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.getId();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">else</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt; 0 &amp;&amp;         </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// approx 50% true</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                                     (--</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">spins</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&amp; ((</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">SPINS</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&gt;&gt;&gt; 1) - 1)) == 0)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                                Thread.</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; font-style: italic; color: rgb(51, 51, 51);">yield</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">();       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// two yields per wait</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">else</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.getObjectVolatile(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">j</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) !=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">spins</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">SPINS</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;      </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// releaser hasn't set match yet</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">else</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(!</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">t</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.isInterrupted() &amp;&amp;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">m</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">== 0 &amp;&amp;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                                 (!</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">timed</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">||</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                                  (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ns</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">end</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">- System.</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; font-style: italic; color: rgb(51, 51, 51);">nanoTime</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">()) &gt; 0L)) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.putObject(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">t</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">BLOCKER</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// emulate LockSupport</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">parked</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">t</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;             </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// minimize window</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.getObjectVolatile(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">j</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) ==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.park(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">false</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ns</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">parked</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.putObject(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">t</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">BLOCKER</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">else</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.getObjectVolatile(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">j</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) ==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&amp;&amp;</span></div><div style="min-height: 11pt;"><span style="min-height: 11pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                                </span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 11pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.compareAndSwapObject(</span><span style="min-height: 11pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span><span style="min-height: 11pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">j</span><span style="min-height: 11pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 11pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 11pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 11pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">m</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!= 0)               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// try to shrink</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.compareAndSwapInt(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">BOUND</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">b</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">b</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">+</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">SEQ</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">- 1);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">hash</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">index</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&gt;&gt;&gt;= 1;       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// descend</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(Thread.</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; font-style: italic; color: rgb(51, 51, 51);">interrupted</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">())</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">timed</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&amp;&amp;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">m</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">== 0 &amp;&amp;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ns</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;= 0L)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">TIMED_OUT</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">break</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;                    </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// expired; restart</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                    }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">else</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;                    </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// clear offer</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">else</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">bound</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">b</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// stale; reset</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">bound</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">b</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">collides</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= 0;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">m</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">||</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">m</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">== 0) ?</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">m</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">:</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">m</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">- 1;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">else</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">((</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">collides</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) &lt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">m</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">||</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">m</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">FULL</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">||</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                         !</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.compareAndSwapInt(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">BOUND</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">b</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">b</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">+</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">SEQ</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">+ 1)) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">collides</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">+ 1;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">== 0) ?</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">m</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">:</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">- 1;         </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// cyclically traverse</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">else</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">m</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">+ 1;                        </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// grow</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">index</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Exchange function used until arenas enabled. See above for explanation.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">item the item to exchange</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">timed true if the wait is timed</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">ns if timed, the maximum wait time, else 0L</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">the other thread's item; or null if either the arena</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * was enabled or the thread was interrupted before completion; or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * TIMED_OUT if timed and timed out</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Object slotExchange(Object</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">boolean</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">timed</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">long</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ns</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        Node</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">participant</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.get();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        Thread</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">t</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= Thread.</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; font-style: italic; color: rgb(51, 51, 51);">currentThread</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">t</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.isInterrupted())</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// preserve interrupt status so caller can recheck</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">for</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(Node</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;;) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">((</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">slot</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) !=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.compareAndSwapObject(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">SLOT</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                    Object</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">match</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                    Thread</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">w</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">parked</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">w</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.unpark(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">w</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// create arena on contention, but continue until slot null</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">NCPU</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&gt; 1 &amp;&amp;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">bound</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">== 0 &amp;&amp;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.compareAndSwapInt(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">BOUND</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">, 0,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">SEQ</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">))</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">arena</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Node[(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">FULL</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">+ 2) &lt;&lt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">ASHIFT</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">];</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">else</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">arena</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// caller must reroute to arenaExchange</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">else</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.compareAndSwapObject(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">SLOT</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">))</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">break</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// await release</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">hash</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">long</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">end</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">timed</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">? System.</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; font-style: italic; color: rgb(51, 51, 51);">nanoTime</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">() +</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ns</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">: 0L;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">spins</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">NCPU</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&gt; 1) ?</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">SPINS</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">: 1;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        Object</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">while</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">((</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">match</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) ==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">spins</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&gt; 0) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">^=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;&lt; 1;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">^=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&gt;&gt;&gt; 3;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">^=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;&lt; 10;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">== 0)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">SPINS</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">| (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">t</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.getId();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">else</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt; 0 &amp;&amp; (--</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">spins</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&amp; ((</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">SPINS</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&gt;&gt;&gt; 1) - 1)) == 0)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                    Thread.</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; font-style: italic; color: rgb(51, 51, 51);">yield</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">else</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">slot</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">spins</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">SPINS</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">else</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(!</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">t</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.isInterrupted() &amp;&amp;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">arena</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&amp;&amp;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                     (!</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">timed</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">|| (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ns</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">end</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">- System.</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; font-style: italic; color: rgb(51, 51, 51);">nanoTime</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">()) &gt; 0L)) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.putObject(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">t</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">BLOCKER</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">parked</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">t</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">slot</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.park(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">false</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ns</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">parked</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.putObject(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">t</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">BLOCKER</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">else</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.compareAndSwapObject(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">SLOT</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">timed</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&amp;&amp;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ns</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;= 0L &amp;&amp; !</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">t</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.isInterrupted() ?</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">TIMED_OUT</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">:</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">break</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.putOrderedObject(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">MATCH</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">hash</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Creates a new Exchanger.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Exchanger() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">participant</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Participant();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Waits for another thread to arrive at this exchange point (unless</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * the current thread is</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@linkplain Thread#interrupt interrupted}</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">),</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * and then transfers the given object to it, receiving its object</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * in return.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">If another thread is already waiting at the exchange point then</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * it is resumed for thread scheduling purposes and receives the object</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * passed in by the current thread.  The current thread returns immediately,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * receiving the object passed to the exchange by that other thread.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">If no other thread is already waiting at the exchange then the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * current thread is disabled for thread scheduling purposes and lies</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * dormant until one of two things happens:</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;ul&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Some other thread enters the exchange; or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Some other thread</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@linkplain Thread#interrupt interrupts}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * the current thread.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/ul&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">If the current thread:</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;ul&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">has its interrupted status set on entry to this method; or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">is</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@linkplain Thread#interrupt interrupted}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">while waiting</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * for the exchange,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/ul&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * then</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link InterruptedException}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">is thrown and the current thread's</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * interrupted status is cleared.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">x the object to exchange</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">the object provided by the other thread</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">InterruptedException if the current thread was</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         interrupted while waiting</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(100, 100, 100); font-size: 14pt;">@SuppressWarnings</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(42, 0, 255); font-size: 14pt;">&quot;unchecked&quot;</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">V exchange(V</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">x</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throws</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">InterruptedException {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        Object</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        Object</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">item</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">x</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) ?</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">NULL_ITEM</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">:</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">x</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// translate null args</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">((</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">arena</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">||</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">             (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= slotExchange(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">false</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">, 0L)) ==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) &amp;&amp;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            ((Thread.</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; font-style: italic; color: rgb(51, 51, 51);">interrupted</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">() ||</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// disambiguates null return</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">              (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= arenaExchange(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">false</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">, 0L)) ==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)))</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">InterruptedException();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">NULL_ITEM</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) ?</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">: (V)</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Waits for another thread to arrive at this exchange point (unless</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * the current thread is</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@linkplain Thread#interrupt interrupted}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * the specified waiting time elapses), and then transfers the given</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * object to it, receiving its object in return.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">If another thread is already waiting at the exchange point then</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * it is resumed for thread scheduling purposes and receives the object</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * passed in by the current thread.  The current thread returns immediately,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * receiving the object passed to the exchange by that other thread.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">If no other thread is already waiting at the exchange then the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * current thread is disabled for thread scheduling purposes and lies</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * dormant until one of three things happens:</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;ul&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Some other thread enters the exchange; or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Some other thread</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@linkplain Thread#interrupt interrupts}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * the current thread; or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">The specified waiting time elapses.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/ul&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">If the current thread:</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;ul&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">has its interrupted status set on entry to this method; or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">is</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@linkplain Thread#interrupt interrupted}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">while waiting</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * for the exchange,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/ul&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * then</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link InterruptedException}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">is thrown and the current thread's</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * interrupted status is cleared.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">If the specified waiting time elapses then</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">     * TimeoutException}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">is thrown.  If the time is less than or equal</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * to zero, the method will not wait at all.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">x the object to exchange</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">timeout the maximum time to wait</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">unit the time unit of the {@code timeout} argument</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">the object provided by the other thread</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">InterruptedException if the current thread was</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         interrupted while waiting</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">TimeoutException if the specified waiting time elapses</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         before another thread enters the exchange</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(100, 100, 100); font-size: 14pt;">@SuppressWarnings</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(42, 0, 255); font-size: 14pt;">&quot;unchecked&quot;</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">V exchange(V</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">x</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">long</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">timeout</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">, TimeUnit</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">unit</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throws</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">InterruptedException, TimeoutException {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        Object</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        Object</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">item</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">x</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) ?</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">NULL_ITEM</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">:</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">x</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">long</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ns</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">unit</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.toNanos(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">timeout</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">((</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">arena</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">||</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">             (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= slotExchange(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">true</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ns</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)) ==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) &amp;&amp;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            ((Thread.</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; font-style: italic; color: rgb(51, 51, 51);">interrupted</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">() ||</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">              (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= arenaExchange(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">true</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ns</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)) ==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)))</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">InterruptedException();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">TIMED_OUT</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">TimeoutException();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">NULL_ITEM</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) ?</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">: (V)</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">v</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// Unsafe mechanics</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">sun.misc.Unsafe</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">long</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">BOUND</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">long</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">SLOT</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">long</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">MATCH</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">long</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">BLOCKER</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">ABASE</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">s</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= sun.misc.Unsafe.</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; font-style: italic; color: rgb(51, 51, 51);">getUnsafe</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            Class&lt;?&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ek</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= Exchanger.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">class</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            Class&lt;?&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">nk</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= Node.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">class</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            Class&lt;?&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ak</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= Node[].</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">class</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            Class&lt;?&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">tk</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= Thread.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">class</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">BOUND</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.objectFieldOffset</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ek</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.getDeclaredField(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(42, 0, 255); font-size: 14pt;">&quot;bound&quot;</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">));</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">SLOT</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.objectFieldOffset</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ek</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.getDeclaredField(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(42, 0, 255); font-size: 14pt;">&quot;slot&quot;</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">));</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">MATCH</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.objectFieldOffset</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">nk</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.getDeclaredField(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(42, 0, 255); font-size: 14pt;">&quot;match&quot;</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">));</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">BLOCKER</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.objectFieldOffset</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">tk</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51); text-decoration: underline;">getDeclaredField</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(42, 0, 255); font-size: 14pt;">&quot;parkBlocker&quot;</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">));</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">s</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.arrayIndexScale(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ak</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// ABASE absorbs padding in front of element 0</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">ABASE</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">U</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.arrayBaseOffset(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ak</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) + (1 &lt;&lt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">ASHIFT</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">catch</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(Exception</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Error(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">((</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">s</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&amp; (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">s</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">-1)) != 0 ||</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">s</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&gt; (1 &lt;&lt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">ASHIFT</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">))</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Error(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(42, 0, 255); font-size: 14pt;">&quot;Unsupported array scale&quot;</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div></span>
</div></body></html> 