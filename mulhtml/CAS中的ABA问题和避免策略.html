<html>
<head>
  <title>CAS中的ABA问题和避免策略</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="957"/>
<h1>CAS中的ABA问题和避免策略</h1>

<div>
<span><div><b><font style="font-size: 18pt; color: rgb(26, 144, 185);">个人总结</font></b></div><div><font style="font-size: 12pt;">1.ABA问题的来源不在于CAS硬件原语，CAS硬件原语是正确的，的确就具有原子性！而是来源于节点的循环利用。</font></div><div><font style="font-size: 12pt;">2.ABA问题的解决的三种策略：</font></div><div><font style="font-size: 12pt;">  （1）在算法中不让节点循环利用</font></div><div><font style="font-size: 12pt;">  （2）<span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">AtomicStampedReference,带版本号的CAS</span></font></div><div><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"><font style="font-size: 12pt;">   ( 3）<span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">AtomicMarkableReference,带布尔标识的CAS</span></font></span></div><div><br/></div><div><b><font style="color: rgb(26, 144, 185); font-size: 18pt;">原文</font></b></div><div><b>地址：<a href="http://blog.csdn.net/li954644351/article/details/50511879">http://blog.csdn.net/li954644351/article/details/50511879</a></b></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">在《Java并发实战》一书的第15章中有一个用原子变量实现的并发栈，代码如下：</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="margin: 0px 0px 24px; padding: 1px 0px 0px; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-size: 12px; background-color: rgb(231, 229, 220); width: 851.391px; text-align: left; outline: 0px; color: rgb(69, 69, 69); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="margin: 0px; padding: 0px 0px 0px 45px; box-sizing: border-box; outline: 0px;"><div style="margin: 0px; padding: 3px 8px 10px 10px; box-sizing: border-box; outline: 0px; font-variant: normal; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; background-color: rgb(248, 248, 248); border-left: 3px solid rgb(108, 226, 108); border-right: 1px solid rgb(231, 229, 220);"><div><span style="font-weight: bold; box-sizing: border-box; outline: 0px;">[java]</span> <a href="http://blog.csdn.net/li954644351/article/details/50511879#" style="color: rgb(103, 149, 181); outline: 0px; box-sizing: border-box; background-image: url(&quot;../images/ico_plain.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px;" title="view plain">view plain</a><span style="box-sizing: border-box; outline: 0px;"> </span><a href="http://blog.csdn.net/li954644351/article/details/50511879#" style="box-sizing: border-box; outline: 0px; color: rgb(103, 149, 181); background-image: url(&quot;../images/ico_copy.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px;" title="copy">copy</a></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; outline: 0px; position: absolute; left: 336px; top: 323px; width: 16px; height: 16px; z-index: 99;"></div></div></div><ol start="1" style="margin: 0px 0px 24px; padding: 0px; box-sizing: border-box; list-style: decimal; outline: 0px; border-top: none; border-right: 1px solid rgb(231, 229, 220); border-bottom: none; border-left: none; background-color: rgb(255, 255, 255); color: rgb(92, 92, 92);"><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">class</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> Node {  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">final</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> String item;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> Node next;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">      </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> Node(String item){  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">this</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">.item = item;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    }  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">}  </span></li></ol></div><div><br style="box-sizing: border-box; outline: 0px; color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 16px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/></div><div style="margin: 0px 0px 24px; padding: 1px 0px 0px; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-size: 12px; background-color: rgb(231, 229, 220); width: 851.391px; text-align: left; outline: 0px; color: rgb(69, 69, 69); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="margin: 0px; padding: 0px 0px 0px 45px; box-sizing: border-box; outline: 0px;"><div style="margin: 0px; padding: 3px 8px 10px 10px; box-sizing: border-box; outline: 0px; font-variant: normal; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; background-color: rgb(248, 248, 248); border-left: 3px solid rgb(108, 226, 108); border-right: 1px solid rgb(231, 229, 220);"><div><span style="font-weight: bold; box-sizing: border-box; outline: 0px;">[java]</span> <a href="http://blog.csdn.net/li954644351/article/details/50511879#" style="color: rgb(103, 149, 181); outline: 0px; box-sizing: border-box; background-image: url(&quot;../images/ico_plain.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px;" title="view plain">view plain</a><span style="box-sizing: border-box; outline: 0px;"> </span><a href="http://blog.csdn.net/li954644351/article/details/50511879#" style="box-sizing: border-box; outline: 0px; color: rgb(103, 149, 181); background-image: url(&quot;../images/ico_copy.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px;" title="copy">copy</a></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; outline: 0px; position: absolute; left: 336px; top: 558px; width: 16px; height: 16px; z-index: 99;"></div></div></div><ol start="1" style="margin: 0px 0px 24px; padding: 0px; box-sizing: border-box; list-style: decimal; outline: 0px; border-top: none; border-right: 1px solid rgb(231, 229, 220); border-bottom: none; border-left: none; background-color: rgb(255, 255, 255); color: rgb(92, 92, 92);"><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">class</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> ConcurrentStack {  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">      </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    AtomicReference&lt;Node&gt; top = </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">new</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> AtomicReference&lt;Node&gt;();  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">      </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">void</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> push(String item){  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        Node newTop = </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">new</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> Node(item);  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        Node oldTop;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">do</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">{  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            oldTop = top.get();  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            newTop.next = oldTop;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        }</span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">while</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">(!<a href="http://top.compareandset(oldtop/">top.compareAndSet(oldTop</a>, newTop));  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    }  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">      </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> String pop(){  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        Node newTop;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        Node oldTop;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">do</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">{  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            oldTop = top.get();  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">if</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">(oldTop == </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">null</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">){  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">                </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">return</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">null</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            }  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            newTop = oldTop.next;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        }</span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">while</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">(!<a href="http://top.compareandset(oldtop/">top.compareAndSet(oldTop</a>, newTop));  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">return</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> oldTop.item;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    }  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">      </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">}  </span></li></ol></div><div><br style="box-sizing: border-box; outline: 0px; color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 16px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/></div><div><span style="color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 16px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">这个例子并不会引发ABA问题，至于为什么不会，后面再讲解，下面先讲一下ABA问题</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box; outline: 0px;"/></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-weight: bold;">什么是ABA？</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box; outline: 0px;"/></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    引用原书的话：如果在算法中的节点可以被循环使用，那么在使用“比较并交换”指令就可能出现这种问题，在CAS操作中将判断“V的值是否仍然为A？”，并且如果是的话就继续执行更新操作，在某些算法中，如果V的值首先由A变为B，再由B变为A，那么CAS将会操作成功</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box; outline: 0px;"/></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><span style="font-weight: bold; box-sizing: border-box; outline: 0px;">ABA的例子</span></div></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box; outline: 0px;"/></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    有时候，ABA造成的后果很严重，下面将并发栈的例子修改一下，看看ABA会造成什么问题：</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box; outline: 0px;"/></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="margin: 0px 0px 24px; padding: 1px 0px 0px; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-size: 12px; background-color: rgb(231, 229, 220); width: 851.391px; text-align: left; outline: 0px; color: rgb(69, 69, 69); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="margin: 0px; padding: 0px 0px 0px 45px; box-sizing: border-box; outline: 0px;"><div style="margin: 0px; padding: 3px 8px 10px 10px; box-sizing: border-box; outline: 0px; font-variant: normal; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; background-color: rgb(248, 248, 248); border-left: 3px solid rgb(108, 226, 108); border-right: 1px solid rgb(231, 229, 220);"><div><span style="font-weight: bold; box-sizing: border-box; outline: 0px;">[java]</span> <a href="http://blog.csdn.net/li954644351/article/details/50511879#" style="color: rgb(103, 149, 181); outline: 0px; box-sizing: border-box; background-image: url(&quot;../images/ico_plain.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px;" title="view plain">view plain</a><span style="box-sizing: border-box; outline: 0px;"> </span><a href="http://blog.csdn.net/li954644351/article/details/50511879#" style="box-sizing: border-box; outline: 0px; color: rgb(103, 149, 181); background-image: url(&quot;../images/ico_copy.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px;" title="copy">copy</a></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; outline: 0px; position: absolute; left: 336px; top: 1657px; width: 16px; height: 16px; z-index: 99;"></div></div></div><ol start="1" style="margin: 0px 0px 24px; padding: 0px; box-sizing: border-box; list-style: decimal; outline: 0px; border-top: none; border-right: 1px solid rgb(231, 229, 220); border-bottom: none; border-left: none; background-color: rgb(255, 255, 255); color: rgb(92, 92, 92);"><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">class</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> Node {  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">final</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> String item;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> Node next;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">      </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> Node(String item){  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">this</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">.item = item;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    }  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">}  </span></li></ol></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="margin: 0px 0px 24px; padding: 1px 0px 0px; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-size: 12px; background-color: rgb(231, 229, 220); width: 851.391px; text-align: left; outline: 0px; color: rgb(69, 69, 69); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="margin: 0px; padding: 0px 0px 0px 45px; box-sizing: border-box; outline: 0px;"><div style="margin: 0px; padding: 3px 8px 10px 10px; box-sizing: border-box; outline: 0px; font-variant: normal; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; background-color: rgb(248, 248, 248); border-left: 3px solid rgb(108, 226, 108); border-right: 1px solid rgb(231, 229, 220);"><div><span style="font-weight: bold; box-sizing: border-box; outline: 0px;">[java]</span> <a href="http://blog.csdn.net/li954644351/article/details/50511879#" style="color: rgb(103, 149, 181); outline: 0px; box-sizing: border-box; background-image: url(&quot;../images/ico_plain.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px;" title="view plain">view plain</a><span style="box-sizing: border-box; outline: 0px;"> </span><a href="http://blog.csdn.net/li954644351/article/details/50511879#" style="box-sizing: border-box; outline: 0px; color: rgb(103, 149, 181); background-image: url(&quot;../images/ico_copy.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px;" title="copy">copy</a></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; outline: 0px; position: absolute; left: 336px; top: 1936px; width: 16px; height: 16px; z-index: 99;"></div></div></div><ol start="1" style="margin: 0px 0px 24px; padding: 0px; box-sizing: border-box; list-style: decimal; outline: 0px; border-top: none; border-right: 1px solid rgb(231, 229, 220); border-bottom: none; border-left: none; background-color: rgb(255, 255, 255); color: rgb(92, 92, 92);"><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">class</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> ConcurrentStack {  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">      </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    AtomicReference&lt;Node&gt; top = </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">new</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> AtomicReference&lt;Node&gt;();  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">      </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">void</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> push(Node node){  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        Node oldTop;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">do</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">{  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            oldTop = top.get();  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            node.next = oldTop;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        }</span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">while</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">(!<a href="http://top.compareandset(oldtop/">top.compareAndSet(oldTop</a>, node));  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    }  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">      </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> Node pop(</span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">int</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> time){  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        Node newTop;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        Node oldTop;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">do</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">{  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            oldTop = top.get();  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">if</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">(oldTop == </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">null</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">){  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">                </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">return</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">null</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            }  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            newTop = oldTop.next;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">              </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            TimeUnit.SECONDS.sleep(time);  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">              </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        }</span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">while</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">(!<a href="http://top.compareandset(oldtop/">top.compareAndSet(oldTop</a>, newTop));  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">return</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> oldTop;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    }  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">}  </span></li></ol></div><div><br style="box-sizing: border-box; outline: 0px; color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 16px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/></div><div><span style="color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 16px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">注意这里的变化，Node基本没有变化</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box; outline: 0px;"/></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">重点关注ConcurrentStack的变化</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">1、push方法：原来是使用内容构造Node，现在直接传入Node，这样就符合了“在算法中的节点可以被循环使用”这个要求</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">2、pop方法的sleep，这是模拟线程的执行情况，以便观察结果</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box; outline: 0px;"/></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">我们先往stack中压入两个Node：</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="margin: 0px 0px 24px; padding: 1px 0px 0px; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-size: 12px; background-color: rgb(231, 229, 220); width: 851.391px; text-align: left; outline: 0px; color: rgb(69, 69, 69); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="margin: 0px; padding: 0px 0px 0px 45px; box-sizing: border-box; outline: 0px;"><div style="margin: 0px; padding: 3px 8px 10px 10px; box-sizing: border-box; outline: 0px; font-variant: normal; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; background-color: rgb(248, 248, 248); border-left: 3px solid rgb(108, 226, 108); border-right: 1px solid rgb(231, 229, 220);"><div><span style="font-weight: bold; box-sizing: border-box; outline: 0px;">[java]</span> <a href="http://blog.csdn.net/li954644351/article/details/50511879#" style="color: rgb(103, 149, 181); outline: 0px; box-sizing: border-box; background-image: url(&quot;../images/ico_plain.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px;" title="view plain">view plain</a><span style="box-sizing: border-box; outline: 0px;"> </span><a href="http://blog.csdn.net/li954644351/article/details/50511879#" style="box-sizing: border-box; outline: 0px; color: rgb(103, 149, 181); background-image: url(&quot;../images/ico_copy.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px;" title="copy">copy</a></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; outline: 0px; position: absolute; left: 336px; top: 2901px; width: 16px; height: 16px; z-index: 99;"></div></div></div><ol start="1" style="margin: 0px 0px 24px; padding: 0px; box-sizing: border-box; list-style: decimal; outline: 0px; border-top: none; border-right: 1px solid rgb(231, 229, 220); border-bottom: none; border-left: none; background-color: rgb(255, 255, 255); color: rgb(92, 92, 92);"><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">ConcurrentStack stack = </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">new</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> ConcurrentStack();  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">stack.push(</span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">new</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> Node(</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 255);">&quot;A&quot;</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">));  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">stack.push(</span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">new</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> Node(</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 255);">&quot;B&quot;</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">));  </span></li></ol></div><div><br style="box-sizing: border-box; outline: 0px; color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 16px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/></div><div><span style="color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 16px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">然后创建两个线程来执行出入栈的操作</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box; outline: 0px;"/></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div>线程A先执行出栈：让NodeA出栈</div></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="margin: 0px 0px 24px; padding: 1px 0px 0px; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-size: 12px; background-color: rgb(231, 229, 220); width: 851.391px; text-align: left; outline: 0px; color: rgb(69, 69, 69); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="margin: 0px; padding: 0px 0px 0px 45px; box-sizing: border-box; outline: 0px;"><div style="margin: 0px; padding: 3px 8px 10px 10px; box-sizing: border-box; outline: 0px; font-variant: normal; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; background-color: rgb(248, 248, 248); border-left: 3px solid rgb(108, 226, 108); border-right: 1px solid rgb(231, 229, 220);"><div><span style="font-weight: bold; box-sizing: border-box; outline: 0px;">[java]</span> <a href="http://blog.csdn.net/li954644351/article/details/50511879#" style="color: rgb(103, 149, 181); outline: 0px; box-sizing: border-box; background-image: url(&quot;../images/ico_plain.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px;" title="view plain">view plain</a><span style="box-sizing: border-box; outline: 0px;"> </span><a href="http://blog.csdn.net/li954644351/article/details/50511879#" style="box-sizing: border-box; outline: 0px; color: rgb(103, 149, 181); background-image: url(&quot;../images/ico_copy.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px;" title="copy">copy</a></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; outline: 0px; position: absolute; left: 336px; top: 3222px; width: 16px; height: 16px; z-index: 99;"></div></div></div><ol start="1" style="margin: 0px 0px 24px; padding: 0px; box-sizing: border-box; list-style: decimal; outline: 0px; border-top: none; border-right: 1px solid rgb(231, 229, 220); border-bottom: none; border-left: none; background-color: rgb(255, 255, 255); color: rgb(92, 92, 92);"><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">stack.pop(</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(192, 0, 0);">3</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">);  </span></li></ol></div><div><br style="box-sizing: border-box; outline: 0px; color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 16px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/></div><div><span style="color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 16px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">因为某些原因，线程A执行出栈比较久，用了3s</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box; outline: 0px;"/></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div>线程B执行出栈之后再入栈：先然NodeA和NodeB出栈，然后让NodeD，NodeC，NodeA入栈（NodeA在栈顶）</div></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="margin: 0px 0px 24px; padding: 1px 0px 0px; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-size: 12px; background-color: rgb(231, 229, 220); width: 851.391px; text-align: left; outline: 0px; color: rgb(69, 69, 69); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="margin: 0px; padding: 0px 0px 0px 45px; box-sizing: border-box; outline: 0px;"><div style="margin: 0px; padding: 3px 8px 10px 10px; box-sizing: border-box; outline: 0px; font-variant: normal; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; background-color: rgb(248, 248, 248); border-left: 3px solid rgb(108, 226, 108); border-right: 1px solid rgb(231, 229, 220);"><div><span style="font-weight: bold; box-sizing: border-box; outline: 0px;">[java]</span> <a href="http://blog.csdn.net/li954644351/article/details/50511879#" style="color: rgb(103, 149, 181); outline: 0px; box-sizing: border-box; background-image: url(&quot;../images/ico_plain.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px;" title="view plain">view plain</a><span style="box-sizing: border-box; outline: 0px;"> </span><a href="http://blog.csdn.net/li954644351/article/details/50511879#" style="box-sizing: border-box; outline: 0px; color: rgb(103, 149, 181); background-image: url(&quot;../images/ico_copy.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px;" title="copy">copy</a></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; outline: 0px; position: absolute; left: 336px; top: 3507px; width: 16px; height: 16px; z-index: 99;"></div></div></div><ol start="1" style="margin: 0px 0px 24px; padding: 0px; box-sizing: border-box; list-style: decimal; outline: 0px; border-top: none; border-right: 1px solid rgb(231, 229, 220); border-bottom: none; border-left: none; background-color: rgb(255, 255, 255); color: rgb(92, 92, 92);"><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">Node A = stack.pop(</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(192, 0, 0);">0</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">);  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">stack.pop(</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(192, 0, 0);">0</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">);  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">stack.push(</span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">new</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> Node(</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 255);">&quot;D&quot;</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">));  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">stack.push(</span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">new</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> Node(</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 255);">&quot;C&quot;</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">));  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">stack.push(A);  </span></li></ol></div><div><br style="box-sizing: border-box; outline: 0px; color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 16px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/></div><div><span style="color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 16px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">注意：线程B实现了节点的循环利用，它先将栈里面的内容全部出栈，然后入栈，最后栈顶的内容是之前出栈的Node</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br style="box-sizing: border-box; outline: 0px;"/></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">线程B执行完这些动作之后，线程A才执行CAS，此时CAS是可以执行成功的</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box; outline: 0px;"/></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">按照原来的想法，线程A和B执行之后，stack的内容应该是：C和D，C在栈顶，但这里的执行结果却是Stack中什么都没有，这就是ABA问题</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font style="color: rgb(227, 0, 0);"><b>（实际上Stack里面还有一个B，这是作者的一个错误）</b></font></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-weight: bold;">如何避免ABA问题</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box; outline: 0px;"/></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    Java中提供了AtomicStampedReference和AtomicMarkableReference来解决ABA问题</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box; outline: 0px;"/></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div>    AtomicStampedReference可以原子更新两个值：引用和版本号，通过版本号来区别节点的循环使用，下面看AtomicStampedReference的例子：</div></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box; outline: 0px;"/></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="margin: 0px 0px 24px; padding: 1px 0px 0px; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-size: 12px; background-color: rgb(231, 229, 220); width: 851.391px; text-align: left; outline: 0px; color: rgb(69, 69, 69); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="margin: 0px; padding: 0px 0px 0px 45px; box-sizing: border-box; outline: 0px;"><div style="margin: 0px; padding: 3px 8px 10px 10px; box-sizing: border-box; outline: 0px; font-variant: normal; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; background-color: rgb(248, 248, 248); border-left: 3px solid rgb(108, 226, 108); border-right: 1px solid rgb(231, 229, 220);"><div><span style="font-weight: bold; box-sizing: border-box; outline: 0px;">[java]</span> <a href="http://blog.csdn.net/li954644351/article/details/50511879#" style="color: rgb(103, 149, 181); outline: 0px; box-sizing: border-box; background-image: url(&quot;../images/ico_plain.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px;" title="view plain">view plain</a><span style="box-sizing: border-box; outline: 0px;"> </span><a href="http://blog.csdn.net/li954644351/article/details/50511879#" style="box-sizing: border-box; outline: 0px; color: rgb(103, 149, 181); background-image: url(&quot;../images/ico_copy.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px;" title="copy">copy</a></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; outline: 0px; position: absolute; left: 336px; top: 4294px; width: 16px; height: 16px; z-index: 99;"></div></div></div><ol start="1" style="margin: 0px 0px 24px; padding: 0px; box-sizing: border-box; list-style: decimal; outline: 0px; border-top: none; border-right: 1px solid rgb(231, 229, 220); border-bottom: none; border-left: none; background-color: rgb(255, 255, 255); color: rgb(92, 92, 92);"><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">class</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> ConcurrentStack {  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">      </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    AtomicStampedReference&lt;Node&gt; top = </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">new</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> AtomicStampedReference&lt;Node&gt;(</span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">null</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">,</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(192, 0, 0);">0</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">);  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">      </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">void</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> push(Node node){  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        Node oldTop;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">int</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> v;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">          </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">do</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">{  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            v=top.getStamp();  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            oldTop = top.getReference();  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            node.next = oldTop;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        }</span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">while</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">(!<a href="http://top.compareandset(oldtop/">top.compareAndSet(oldTop</a>, node,v,v+</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(192, 0, 0);">1</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">));  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 130, 0);">//      }while(!<a href="http://top.compareandset(oldtop/">top.compareAndSet(oldTop</a>, node,top.getStamp(),top.getStamp()+1));</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    }  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">      </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> Node pop(</span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">int</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> time){  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        Node newTop;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        Node oldTop;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">int</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> v;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">do</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">{  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            v=top.getStamp();  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            oldTop = top.getReference();  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">              </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">              </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">if</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">(oldTop == </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">null</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">){  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">                </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">return</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">null</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            }  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            newTop = oldTop.next;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">try</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> {  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">                TimeUnit.SECONDS.sleep(time);  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            } </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">catch</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> (InterruptedException e) {  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">                e.printStackTrace();  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            }  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        }</span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">while</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">(!<a href="http://top.compareandset(oldtop/">top.compareAndSet(oldTop</a>, newTop,v,v+</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(192, 0, 0);">1</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">));  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 130, 0);">//      }while(!<a href="http://top.compareandset(oldtop/">top.compareAndSet(oldTop</a>, newTop,top.getStamp(),top.getStamp()));</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">return</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> oldTop;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    }  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">      </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">void</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> get(){  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        Node node = top.getReference();  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">while</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">(node!=</span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">null</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">){  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            System.out.println(node.getItem());  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">            node = node.getNode();  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        }  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    }  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">      </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">}  </span></li></ol></div><div><br style="box-sizing: border-box; outline: 0px; color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 16px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">注意：不能使用注释中的方式，否则就和单纯使用原子变量没有区别了</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box; outline: 0px;"/></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">AtomicMarkableReference可以原子更新一个布尔类型的标记位和引用类型，看下面的例子：</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box; outline: 0px;"/></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; outline: 0px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="margin: 0px 0px 24px; padding: 1px 0px 0px; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-size: 12px; background-color: rgb(231, 229, 220); width: 851.391px; text-align: left; outline: 0px; color: rgb(69, 69, 69); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="margin: 0px; padding: 0px 0px 0px 45px; box-sizing: border-box; outline: 0px;"><div style="margin: 0px; padding: 3px 8px 10px 10px; box-sizing: border-box; outline: 0px; font-variant: normal; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; background-color: rgb(248, 248, 248); border-left: 3px solid rgb(108, 226, 108); border-right: 1px solid rgb(231, 229, 220);"><div><span style="font-weight: bold; box-sizing: border-box; outline: 0px;">[java]</span> <a href="http://blog.csdn.net/li954644351/article/details/50511879#" style="color: rgb(103, 149, 181); outline: 0px; box-sizing: border-box; background-image: url(&quot;../images/ico_plain.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px;" title="view plain">view plain</a><span style="box-sizing: border-box; outline: 0px;"> </span><a href="http://blog.csdn.net/li954644351/article/details/50511879#" style="box-sizing: border-box; outline: 0px; color: rgb(103, 149, 181); background-image: url(&quot;../images/ico_copy.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px;" title="copy">copy</a></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; outline: 0px; position: absolute; left: 336px; top: 5443px; width: 16px; height: 16px; z-index: 99;"></div></div></div><ol start="1" style="margin: 0px 0px 24px; padding: 0px; box-sizing: border-box; list-style: decimal; outline: 0px; border-top: none; border-right: 1px solid rgb(231, 229, 220); border-bottom: none; border-left: none; background-color: rgb(255, 255, 255); color: rgb(92, 92, 92);"><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">AtomicMarkableReference&lt;Node&gt; top = </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">new</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> AtomicMarkableReference&lt;Node&gt;(</span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">null</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">,</span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">true</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">);  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">void</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> push(Node node){  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    Node oldTop;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">boolean</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);"> v;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">      </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    </span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">do</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">{  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        v=top.isMarked();  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        oldTop = top.getReference();  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">        node.next = oldTop;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">    }</span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">while</span><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">(!<a href="http://top.compareandset(oldtop/">top.compareAndSet(oldTop</a>, node,v,!v));  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; outline: 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; outline: 0px; border: none; color: rgb(0, 0, 0);">}  </span></li></ol></div><div><br/></div></span>
</div></body></html> 