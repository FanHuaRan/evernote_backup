<html>
<head>
  <title>依靠封锁策略实现事务隔离级别的原理</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1359"/>
<h1>依靠封锁策略实现事务隔离级别的原理</h1>

<div>
<span><div><span style="font-size: 18pt; color: rgb(26, 144, 185); font-weight: bold;">个人理解</span></div><div><span style="font-size: 12pt;">1.事务实现有多种策略，最简单的就是依靠锁实现</span></div><div><span style="font-size: 12pt;">2.四种隔离级别只在读数据和更新数据时的加锁策略上存在不同。</span></div><div><span style="font-size: 12pt;">3.读未提交策略：对读取到的数据不加锁，对更新数据加行级共享锁，直到事务结束才释放。</span></div><div><span style="font-size: 12pt;">   读已提交策略：对读取到的数据加行级共享锁，读完即释放；对更新数据加行级排它锁，直到事务结束才释放。</span></div><div><span style="font-size: 12pt;">   可重复读策略：对读取到的数据加行级共享锁，直到事务结束才释放；对更新数据加行级排它锁，直到事务结束才释放。</span></div><div><span style="font-size: 12pt;">   串行化策略：对读取到的数据加表级共享锁，直到事务结束；对更新数据加表级排它锁，直到事务结束才释放。</span></div><div><br/></div><div><span style="font-size: 18pt; color: rgb(26, 144, 185); font-weight: bold;">原文</span></div><div><span style="font-weight: bold;">地址：</span><a href="http://www.cnblogs.com/wajika/p/6680200.html" style="font-weight: bold;">http://www.cnblogs.com/wajika/p/6680200.html</a></div><div style="margin-bottom: 20px; word-break: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="margin: 10px auto; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">我这4种隔离级别的相应原理总结如下：</span></div><hr/><h3 style="font-size: 18px; border-bottom: 1px solid rgb(170, 170, 170); margin: 10px; padding-left: 10px;"><span style="font-size: 18px; border-bottom: 1px solid rgb(170, 170, 170); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">READ_UNCOMMITED 的原理:</span></h3><ul style="margin-left: 30px; padding-left: 0px;"><li style="list-style-type: disc;"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">事务对当前被读取的数据不加锁；</span></li><li style="list-style-type: disc;"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">事务在更新某数据的瞬间（就是发生更新的瞬间），必须先对其加 </span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">行级共享锁</span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">，直到事务结束才释放。</span></li></ul><div style="margin: 10px auto; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">表现：</span></div><ul style="margin-left: 30px; padding-left: 0px;"><li style="list-style-type: disc;"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal;">事务1读取某行记录时，事务2也能对这行记录进行读取、更新；当事务2对该记录进行更新时，事务1再次读取该记录，能读到事务2对该记录的修改版本，即使该修改尚未被提交。</span></li><li style="list-style-type: disc;"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal;">事务1更新某行记录时，事务2不能对这行记录做更新，直到事务1结束。</span></li></ul><hr/><h3 style="font-size: 18px; border-bottom: 1px solid rgb(170, 170, 170); margin: 10px; padding-left: 10px;"><span style="font-size: 18px; border-bottom: 1px solid rgb(170, 170, 170); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">READ_COMMITED 的原理:</span></h3><ul style="margin-left: 30px; padding-left: 0px;"><li style="list-style-type: disc;"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">事务对当前被读取的数据加 </span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">行级共享锁（当读到时才加锁）</span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">，一旦读完该行，立即释放该行级共享锁；</span></li><li style="list-style-type: disc;"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">事务在更新某数据的瞬间（就是发生更新的瞬间），必须先对其加 </span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">行级排他锁</span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">，直到事务结束才释放。</span></li></ul><div style="margin: 10px auto; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">表现：</span></div><ul style="margin-left: 30px; padding-left: 0px;"><li style="list-style-type: disc;"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal;">事务1读取某行记录时，事务2也能对这行记录进行读取、更新；当事务2对该记录进行更新时，事务1再次读取该记录，读到的只能是事务2对其更新前的版本，要不就是事务2提交后的版本。</span></li><li style="list-style-type: disc;"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal;">事务1更新某行记录时，事务2不能对这行记录做更新，直到事务1结束。</span></li></ul><hr/><h3 style="font-size: 18px; border-bottom: 1px solid rgb(170, 170, 170); margin: 10px; padding-left: 10px;"><span style="font-size: 18px; border-bottom: 1px solid rgb(170, 170, 170); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">REPEATABLE READ 的原理:</span></h3><ul style="margin-left: 30px; padding-left: 0px;"><li style="list-style-type: disc;"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">事务在读取某数据的瞬间（就是开始读取的瞬间），必须先对其加 </span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">行级共享锁</span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">，直到事务结束才释放；</span></li><li style="list-style-type: disc;"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">事务在更新某数据的瞬间（就是发生更新的瞬间），必须先对其加 </span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">行级排他锁</span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">，直到事务结束才释放。</span></li></ul><div style="margin: 10px auto; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">表现：</span></div><ul style="margin-left: 30px; padding-left: 0px;"><li style="list-style-type: disc;"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal;">事务1读取某行记录时，事务2也能对这行记录进行读取、更新；当事务2对该记录进行更新时，事务1再次读取该记录，读到的仍然是第一次读取的那个版本。</span></li><li style="list-style-type: disc;"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal;">事务1更新某行记录时，事务2不能对这行记录做更新，直到事务1结束。</span></li></ul><hr/><h3 style="font-size: 18px; border-bottom: 1px solid rgb(170, 170, 170); margin: 10px; padding-left: 10px;"><span style="font-size: 18px; border-bottom: 1px solid rgb(170, 170, 170); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">SERIALIZABLE 的原理:</span></h3><ul style="margin-left: 30px; padding-left: 0px;"><li style="list-style-type: disc;"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">事务在读取数据时，必须先对其加 </span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">表级共享锁</span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"> ，直到事务结束才释放；</span></li><li style="list-style-type: disc;"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">事务在更新数据时，必须先对其加 </span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">表级排他锁</span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"> ，直到事务结束才释放。</span></li></ul><div style="margin: 10px auto; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">表现：</span></div><ul style="margin-left: 30px; padding-left: 0px;"><li style="list-style-type: disc;"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal;">事务1正在读取A表中的记录时，则事务2也能读取A表，但不能对A表做更新、新增、删除，直到事务1结束。</span></li><li style="list-style-type: disc;"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal;">事务1正在更新A表中的记录时，则事务2不能读取A表的任意记录，更不可能对A表做更新、新增、删除，直到事务1结束。</span></li></ul></div><div style="clear: both; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="margin-bottom: 10px;">分类: <a href="http://www.cnblogs.com/wajika/category/929056.html" style="color: rgb(29, 88, 209);">mysql</a></div><div><br/></div></span>
</div></body></html> 