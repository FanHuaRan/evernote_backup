<html>
<head>
  <title>ReentrantLock的用法和源码解析</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1617"/>
<h1>ReentrantLock的用法和源码解析</h1>

<div>
<span><div><div><span style="color: rgb(20, 113, 145); font-size: 18pt; font-weight: bold;">ReentrantLock用法</span><br/></div><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">注明：Condition.signal/signalAll的作用等同于Object.notify/notifyAll，Conditon.await等同于Object.wait,所以下面的论述全部依靠object.wait和notify来完成了，因为实在懒得写了</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">1.sleep是线程类（Thread）的方法，导致此线程暂停执行指定时间，给执行机会给其他线程，但是监控状态依然保持，到时后会自动恢复。调用sleep不会释放对象锁。wait是Object类的方法，对此对象调用wait方法导致本线程放弃对象锁，进入等待此对象的等待锁定池，只有针对此对象发出notify方法（或notifyAll，被interrupt或者等待超时后本线程才能才进入对象锁定池准备获得对象锁进入运行状态。</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">2.Thread.sleep与Object.wait的差别</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">  (1)sleep属于Thread的方法和wait属于Object的方法</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">  (2)sleep方法没有释放锁，而wait方法释放了锁，使得其他线程可以使用同步控制块或者同步方法。</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">  (3)wait，notify和notifyAll只能在同步控制方法或者同步控制块里面使用，而sleep可以在任何地方使用(使用范围)</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </span> <span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">synchronized(x){</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">　　 x.notify()</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">　　//或者wait()</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">　　 }</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">  (4)sleep必须捕获异常，而wait，notify和notifyAll不需要捕获异常,这儿说的并不是检查性异常(sleep和wait都会抛出检查型异常InterruptedException)，这儿只是编码习惯和一般规定</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">3.关于sleep和wait的一些更深的理解</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">  (1)sleep和wait一定是由于外部对该线程调用了interrupt方法才抛出的InterruptedException </span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> （2)对于wait而言，如果要向上抛出InterruptedException(不管是不是在同步区之内)或者是要直接在catch当中处理，都必须要等待其它线程释放了锁资源，该线程获取到锁资源才能处理</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">  (3)所以在wait当中，对于InterruptedException异常的抛出和捕获(catch)异常都属于临界区，必须要获取到锁资源才能进行这两个操作</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">  相当于interrupt方法免除了notify/notifyAll这一个步骤，不过含有抛出InterruptedException的副作用</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">  (4)wait(int timeout)是有限等待，在等待时间之内收到了notify/notifyall.或者当等待超过了timeout的时间，该线程会自动的开始尝试获取锁资源，在这段时间如果被interrupt参考上面两条</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">  (5)总之对于锁所保护的临界区而言，里面所产生的任何代码和抛出异常的操作都必须要在该线程获取到锁资源后才能进行，无论是独占还是共享锁（Concurrent包）</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">  看看下面的代码可以理解：</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </span> <span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">public class Main2 {</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">private static final Object locker=new Object();</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">public static  void  main(String[]args) {</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">ThreadA a=new ThreadA();</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">ThreadB b=new ThreadB();</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">a.start();</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">b.start();</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">b.interrupt();</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">}</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">static final class  ThreadA extends Thread{</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">@Override</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">public void run() {</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">synchronized (locker) {</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">for(int i=0;i&lt;20;i++){</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">System.out.println(false);</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">try {</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Thread.sleep(2000);</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">} catch (InterruptedException e) {</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">e.printStackTrace();</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">}</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">}</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">}</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">}</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">}</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">static final class  ThreadB extends Thread{</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">@Override</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">public void run() {</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">synchronized (locker) {</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">try {</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">locker.wait();</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">} catch (InterruptedException e) {</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">e.printStackTrace();</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">}</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">for(int i=0;i&lt;20;i++){</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">System.out.println(true);</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">try {</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Thread.sleep(2000);</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">} catch (InterruptedException e) {</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">e.printStackTrace();</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">}</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">}</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">}</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">}</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">}</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">ReentrantLock获取锁定的三种方式：</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    a) lock(), 如果获取了锁立即返回，如果别的线程持有锁，当前线程则一直处于休眠状态，直到获取锁</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    b) tryLock(), 如果获取了锁立即返回true，如果别的线程正持有锁，立即返回false；</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    c) tryLock(long timeout,TimeUnit unit)，   如果获取了锁定立即返回true，如果别的线程正持有锁，会等待参数给定的时间，在等待的过程中，如果获取了锁定，就返回true，如果等待超时，返回false；</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">     </span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-weight: bold;">d) lockInterruptibly:如果获取了锁定立即返回，如果没有获取锁定，当前线程处于休眠状态，直到或者锁定，或者当前线程被别的线程中断</span></h1><h1 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></h1><h1><span style="font-family: SimSun; font-size: 18px; font-weight: bold; color: rgb(31, 73, 125);">原文</span></h1><h1><span style="font-family: SimSun; font-size: 18px;">地址：</span><a href="http://blog.csdn.net/vernonzheng/article/details/8288251" style="font-family: SimSun; font-size: 18px; color: rgb(38, 112, 154);">http://blog.csdn.net/vernonzheng/article/details/8288251</a></h1><h1><span style="font-family: SimSun; font-size: 18px;">一、ReentrantLock 类</span></h1><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br/></div></div><h2 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">1.1 什么是reentrantlock</span></h2><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br/></div></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">java.util.concurrent.lock 中的 Lock 框架是锁定的一个抽象，它允许把锁定的实现作为 Java 类，而不是作为语言的特性来实现。这就为 Lock 的多种实现留下了空间，各种实现可能有不同的调度算法、性能特性或者锁定语义。 ReentrantLock 类实现了 Lock ，它拥有与 synchronized 相同的并发性和内存语义，但是添加了类似锁投票、定时锁等候和可中断锁等候的一些特性。此外，它还提供了在激烈争用情况下更佳的性能。（换句话说，当许多线程都想访问共享资源时，JVM 可以花更少的时候来调度线程，把更多时间用在执行线程上。）</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br/></div></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-weight: bold;">reentrant 锁意味着什么呢？</span><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">简单来说，它有一个与锁相关的获取计数器，如果拥有锁的某个线程再次得到锁，那么获取计数器就加1，然后锁需要被释放两次才能获得真正释放。这模仿了 synchronized 的语义；如果线程进入由线程已经拥有的监控器保护的 synchronized 块，就允许线程继续进行，当线程退出第二个（或者后续） synchronized 块的时候，不释放锁，只有线程退出它进入的监控器保护的第一个 synchronized 块时，才释放锁。</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br/></div></div><h2 style="margin: 0px; padding: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">1.2 </span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">ReentrantLock与</span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">synchronized的比较</span></h2><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br/></div></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="margin: 0px; padding: 0px;"><span style="font-family: SimSun; font-weight: bold;">相同：</span><span style="font-family: SimSun;">ReentrantLock提供了synchronized类似的功能和内存语义。</span></div><div style="margin: 0px; padding: 0px;"><span style="font-family: SimSun; font-weight: bold;">不同：</span></div><div style="margin: 0px; padding: 0px;"><span style="font-family: SimSun;">（1）ReentrantLock功能性方面更全面，比如时间锁等候，可中断锁等候，锁投票等，因此更有扩展性。在多个条件变量和高度竞争锁的地方，用ReentrantLock更合适，ReentrantLock还提供了Condition，对线程的等待和唤醒等操作更加灵活，一个ReentrantLock可以有多个Condition实例，所以更有扩展性。</span></div><div style="margin: 0px; padding: 0px;"><span style="font-family: SimSun;">（2）ReentrantLock 的性能比synchronized会好点。</span></div><div style="margin: 0px; padding: 0px;"><span style="font-family: SimSun;">（3）ReentrantLock提供了可轮询的锁请求，他可以尝试的去取得锁，如果取得成功则继续处理，取得不成功，可以等下次运行的时候处理，所以不容易产生死锁，而synchronized则一旦进入锁请求要么成功，要么一直阻塞，所以更容易产生死锁。</span></div><div style="margin: 0px; padding: 0px;"><div><br/></div></div><h2 style="margin: 0px; padding: 0px; font-size: 14px;"><span style="font-size: 14px; font-family: SimSun;">1.3 </span><span style="font-size: 14px; font-family: SimSun;">ReentrantLock扩展的功能</span></h2><div style="margin: 0px; padding: 0px;"><div><br/></div></div><div style="margin: 0px; padding: 0px;"></div><h3 style="margin: 0px; padding: 0px; font-size: 14px;"><span style="font-size: 14px; font-family: SimSun;">1.3.1 实现可轮询的锁请求 </span></h3><div style="margin: 0px; padding: 0px;"><div><br/></div></div><div><span style="font-family: SimSun;">在内部锁中，死锁是致命的——唯一的恢复方法是重新启动程序，唯一的预防方法是在构建程序时不要出错。而可轮询的锁获取模式具有更完善的错误恢复机制，可以规避死锁的发生。 </span></div><div><span style="font-family: SimSun;">如果你不能获得所有需要的锁，那么使用可轮询的获取方式使你能够重新拿到控制权，它会释放你已经获得的这些锁，然后再重新尝试。可轮询的锁获取模式，由tryLock()方法实现。此方法仅在调用时锁为空闲状态才获取该锁。如果锁可用，则获取锁，并立即返回值true。如果锁不可用，则此方法将立即返回值false。此方法的典型使用语句如下： </span></div><div style="margin: 18px 0px !important; padding: 1px 0px 0px; font-size: 12px; width: 936.531px; overflow-y: hidden; position: relative;"><div style="margin: 0px; padding: 0px 0px 0px 45px;"><div style="margin: 0px; padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left: 3px solid rgb(108, 226, 108);"><div><span style="font-weight: bold;">[java]</span> <a href="http://blog.csdn.net/vernonzheng/article/details/8288251#" style="color: rgb(160, 160, 160); background-image: url(&quot;background-position; background-repeat: no-repeat; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px&quot;);" title="view plain">view plain</a> <a href="http://blog.csdn.net/vernonzheng/article/details/8288251#" style="color: rgb(160, 160, 160); background-image: url(&quot;background-position; background-repeat: no-repeat; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px&quot;);" title="copy">copy</a></div><div style="margin: 0px; padding: 0px; position: absolute; left: 444px; top: 1182px; width: 18px; height: 18px; z-index: 99;"></div></div></div><ol start="1" style="margin: 0px 0px 1px 45px !important; padding: 0px; border: none; color: rgb(92, 92, 92);"><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">Lock lock = ...;   </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">if</span><span style="border: none; color: black;"> (lock.tryLock()) {   </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">try</span><span style="border: none; color: black;"> {   </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: rgb(0, 130, 0);">// manipulate protected state </span><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">} </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">finally</span><span style="border: none; color: black;"> {   </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">lock.unlock();   </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">}   </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">} </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">else</span><span style="border: none; color: black;"> {   </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: rgb(0, 130, 0);">// perform alternative actions </span><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">}   </span></li></ol></div><div><br/></div><h3 style="margin: 0px; padding: 0px; font-size: 14px;"><span style="font-size: 14px; font-family: SimSun;">1.3.2 实现可定时的锁请求 </span></h3><div style="margin: 0px; padding: 0px;"><div><br/></div></div><div><span style="font-family: SimSun;">当使用内部锁时，一旦开始请求，锁就不能停止了，所以内部锁给实现具有时限的活动带来了风险。为了解决这一问题，可以使用定时锁。当具有时限的活 </span></div><div><span style="font-family: SimSun;">动调用了阻塞方法，定时锁能够在时间预算内设定相应的超时。如果活动在期待的时间内没能获得结果，定时锁能使程序提前返回。可定时的锁获取模式，由tryLock(long, TimeUnit)方法实现。 </span></div></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br/></div><h3 style="margin: 0px; padding: 0px; font-size: 14px;"><span style="font-size: 14px; font-family: SimSun;">1.3.3 实现可中断的锁获取请求 </span></h3><div style="margin: 0px; padding: 0px;"><div><br/></div></div><div><span style="font-family: SimSun;">可中断的锁获取操作允许在可取消的活动中使用。lockInterruptibly()方法能够使你获得锁的时候响应中断。</span></div><div style="margin: 0px; padding: 0px;"></div><div style="margin: 0px; padding: 0px;"><div><br/></div></div><h2 style="margin: 0px; padding: 0px; font-size: 14px;"><span style="font-size: 14px; font-family: SimSun;">1.4 ReentrantLock不好与需要注意的地方</span></h2><div style="margin: 0px; padding: 0px;"><div><br/></div></div><div style="margin: 0px; padding: 0px;"><span style="font-family: SimSun;">（1） lock 必须在 finally 块中释放。否则，如果受保护的代码将抛出异常，锁就有可能永远得不到释放！这一点区别看起来可能没什么，但是实际上，它极为重要。忘记在 finally 块中释放锁，可能会在程序中留下一个定时炸弹，当有一天炸弹爆炸时，您要花费很大力气才有找到源头在哪。而使用同步，JVM 将确保锁会获得自动释放</span></div><div style="margin: 0px; padding: 0px;"><span style="font-family: SimSun;">（2） 当 JVM 用 synchronized 管理锁定请求和释放时，JVM 在生成线程转储时能够包括锁定信息。这些对调试非常有价值，因为它们能标识死锁或者其他异常行为的来源。 Lock 类只是普通的类，JVM 不知道具体哪个线程拥有 Lock 对象。</span></div><div style="margin: 0px; padding: 0px;"><div><br/></div></div><h1 style="margin: 0px; padding: 0px; font-size: 14px;"><span style="font-size: 18px; font-family: SimSun; text-indent: 20px;">二、</span><span style="font-size: 18px; font-family: SimSun; text-indent: 20px;">条件变量</span><span style="font-size: 18px; font-family: SimSun; text-indent: 20px; font-weight: bold;">Condition</span></h1><div style="margin: 0px; padding: 0px;"><div><br/></div></div></div><div><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"><span style="text-indent: 20px; font-family: SimSun;">条件变量很大一个程度上是为了解决Object.wait/notify/notifyAll难以使用的问题。</span></div><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"><span style="text-indent: 20px; font-family: SimSun; font-weight: bold;">条件</span><span style="text-indent: 20px; font-family: SimSun;">（也称为</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">条件队列</span><span style="text-indent: 20px; font-family: SimSun;"> 或</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">条件变量</span><span style="text-indent: 20px; font-family: SimSun;">）为线程提供了一个含义，以便在某个状态条件现在可能为 true 的另一个线程通知它之前，一直挂起该线程（即让其“等待”）。因为访问此共享状态信息发生在不同的线程中，所以它必须受保护，因此要将某种形式的锁与该条件相关联。等待提供一个条件的主要属性是：</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">以原子方式</span><span style="text-indent: 20px; font-family: SimSun;"> 释放相关的锁，并挂起当前线程，就像 </span><span style="text-indent: 20px; font-family: SimSun;">Object.wait</span><span style="text-indent: 20px; font-family: SimSun;"> 做的那样。</span></div><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"><span style="text-indent: 20px; font-family: SimSun;">上述API说明表明条件变量需要与锁绑定，而且多个Condition需要绑定到同一锁上。前面的</span><span style="text-indent: 20px; font-family: SimSun; font-weight: bold;">Lock</span><span style="text-indent: 20px; font-family: SimSun;">中提到，获取一个条件变量的方法是</span><span style="text-indent: 20px; font-family: SimSun; font-weight: bold;">Lock.newCondition()</span><span style="text-indent: 20px; font-family: SimSun;">。</span></div><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"></div><div style="margin: 18px 0px !important; padding: 1px 0px 0px; font-size: 12px; width: 936.531px; overflow-y: hidden; position: relative;"><div style="margin: 0px; padding: 0px 0px 0px 45px;"><div style="margin: 0px; padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left: 3px solid rgb(108, 226, 108);"><div><span style="font-weight: bold;">[java]</span> <a href="http://blog.csdn.net/vernonzheng/article/details/8288251#" style="color: rgb(160, 160, 160); background-image: url(&quot;background-position; background-repeat: no-repeat; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px&quot;);" title="view plain">view plain</a> <a href="http://blog.csdn.net/vernonzheng/article/details/8288251#" style="color: rgb(160, 160, 160); background-image: url(&quot;background-position; background-repeat: no-repeat; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px&quot;);" title="copy">copy</a></div><div style="margin: 0px; padding: 0px; position: absolute; left: 444px; top: 2050px; width: 18px; height: 18px; z-index: 99;"></div></div></div><ol start="1" style="margin: 0px 0px 1px 45px !important; padding: 0px; border: none; color: rgb(92, 92, 92);"><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">void</span><span style="border: none; color: black;"> await() </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">throws</span><span style="border: none; color: black;"> InterruptedException;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">void</span><span style="border: none; color: black;"> awaitUninterruptibly();  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">long</span><span style="border: none; color: black;"> awaitNanos(</span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">long</span><span style="border: none; color: black;"> nanosTimeout) </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">throws</span><span style="border: none; color: black;"> InterruptedException;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">boolean</span><span style="border: none; color: black;"> await(</span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">long</span><span style="border: none; color: black;"> time, TimeUnit unit) </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">throws</span><span style="border: none; color: black;"> InterruptedException;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">boolean</span><span style="border: none; color: black;"> awaitUntil(Date deadline) </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">throws</span><span style="border: none; color: black;"> InterruptedException;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">void</span><span style="border: none; color: black;"> signal();  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">void</span><span style="border: none; color: black;"> signalAll();  </span></li></ol></div><div><br/></div><div><br/></div><div style="margin: 0px; padding: 0px;"></div><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"><span style="text-indent: 20px; font-family: SimSun;">以上是</span><span style="text-indent: 20px; font-family: SimSun; font-weight: bold;">Condition</span><span style="text-indent: 20px; font-family: SimSun;">接口定义的方法，</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">await*</span><span style="text-indent: 20px; font-family: SimSun;">对应于</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">Object.wait</span><span style="text-indent: 20px; font-family: SimSun;">，</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">signal</span><span style="text-indent: 20px; font-family: SimSun;">对应于</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">Object.notify</span><span style="text-indent: 20px; font-family: SimSun;">，</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">signalAll</span><span style="text-indent: 20px; font-family: SimSun;">对应于</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">Object.notifyAll</span><span style="text-indent: 20px; font-family: SimSun;">。特别说明的是</span><span style="text-indent: 20px; font-family: SimSun; font-weight: bold;">Condition</span><span style="text-indent: 20px; font-family: SimSun;">的接口改变名称就是为了避免与Object中的</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">wait/notify/notifyAll</span><span style="text-indent: 20px; font-family: SimSun;">的语义和使用上混淆，因为Condition同样有</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">wait/notify/notifyAll</span><span style="text-indent: 20px; font-family: SimSun;">方法。</span></div><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"><span style="text-indent: 20px; font-family: SimSun;">每一个</span><span style="text-indent: 20px; font-family: SimSun; font-weight: bold;">Lock</span><span style="text-indent: 20px; font-family: SimSun;">可以有任意数据的</span><span style="text-indent: 20px; font-family: SimSun; font-weight: bold;">Condition</span><span style="text-indent: 20px; font-family: SimSun;">对象，</span><span style="text-indent: 20px; font-family: SimSun; font-weight: bold;">Condition</span><span style="text-indent: 20px; font-family: SimSun;">是与</span><span style="text-indent: 20px; font-family: SimSun; font-weight: bold;">Lock</span><span style="text-indent: 20px; font-family: SimSun;">绑定的，所以就有</span><span style="text-indent: 20px; font-family: SimSun; font-weight: bold;">Lock</span><span style="text-indent: 20px; font-family: SimSun;">的公平性特性：如果是公平锁，线程为按照FIFO的顺序从</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">Condition.await</span><span style="text-indent: 20px; font-family: SimSun;">中释放，如果是非公平锁，那么后续的锁竞争就不保证FIFO顺序了。</span></div><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"><span style="text-indent: 20px; font-family: SimSun;">一个使用Condition实现</span><span style="text-indent: 20px; font-family: SimSun; font-weight: bold;">生产者消费者</span><span style="text-indent: 20px; font-family: SimSun;">的模型例子如下。</span></div><blockquote style="margin: 0px; padding: 0px; font-style: italic;"><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"></div><div style="margin: 18px 0px !important; padding: 1px 0px 0px; font-size: 12px; width: 857.328px; overflow-y: hidden; position: relative;"><div style="margin: 0px; padding: 0px 0px 0px 45px;"><div style="margin: 0px; padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left: 3px solid rgb(108, 226, 108);"><div><span style="font-weight: bold;">[java]</span> <a href="http://blog.csdn.net/vernonzheng/article/details/8288251#" style="color: rgb(160, 160, 160); background-image: url(&quot;background-position; background-repeat: no-repeat; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px&quot;);" title="view plain">view plain</a> <a href="http://blog.csdn.net/vernonzheng/article/details/8288251#" style="color: rgb(160, 160, 160); background-image: url(&quot;background-position; background-repeat: no-repeat; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px&quot;);" title="copy">copy</a></div><div style="margin: 0px; padding: 0px; position: absolute; left: 484px; top: 2530px; width: 18px; height: 18px; z-index: 99;"></div></div></div><ol start="1" style="margin: 0px 0px 1px 45px !important; padding: 0px; border: none; color: rgb(92, 92, 92);"><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">import</span><span style="border: none; color: black;"> java.util.concurrent.locks.Condition;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">import</span><span style="border: none; color: black;"> java.util.concurrent.locks.Lock;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">import</span><span style="border: none; color: black;"> java.util.concurrent.locks.ReentrantLock;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">public</span><span style="border: none; color: black;"> </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">class</span><span style="border: none; color: black;"> ProductQueue&lt;T&gt; {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">private</span><span style="border: none; color: black;"> </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">final</span><span style="border: none; color: black;"> T[] items;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">private</span><span style="border: none; color: black;"> </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">final</span><span style="border: none; color: black;"> Lock lock = </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">new</span><span style="border: none; color: black;"> ReentrantLock();  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">private</span><span style="border: none; color: black;"> Condition notFull = lock.newCondition();  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">private</span><span style="border: none; color: black;"> Condition notEmpty = lock.newCondition();  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 130, 0);">//</span><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">private</span><span style="border: none; color: black;"> </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">int</span><span style="border: none; color: black;"> head, tail, count;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">public</span><span style="border: none; color: black;"> ProductQueue(</span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">int</span><span style="border: none; color: black;"> maxSize) {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">        items = (T[]) </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">new</span><span style="border: none; color: black;"> Object[maxSize];  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">    }  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">public</span><span style="border: none; color: black;"> ProductQueue() {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">        </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">this</span><span style="border: none; color: black;">(</span><span style="border: none; color: rgb(192, 0, 0);">10</span><span style="border: none; color: black;">);  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">    }  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">public</span><span style="border: none; color: black;"> </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">void</span><span style="border: none; color: black;"> put(T t) </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">throws</span><span style="border: none; color: black;"> InterruptedException {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">        lock.lock();  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">        </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">try</span><span style="border: none; color: black;"> {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">            </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">while</span><span style="border: none; color: black;"> (count == getCapacity()) {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">                notFull.await();  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">            }  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">            items[tail] = t;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">            </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">if</span><span style="border: none; color: black;"> (++tail == getCapacity()) {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">                tail = </span><span style="border: none; color: rgb(192, 0, 0);">0</span><span style="border: none; color: black;">;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">            }  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">            ++count;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">            notEmpty.signalAll();  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">        } </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">finally</span><span style="border: none; color: black;"> {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">            lock.unlock();  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">        }  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">    }  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">public</span><span style="border: none; color: black;"> T take() </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">throws</span><span style="border: none; color: black;"> InterruptedException {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">        lock.lock();  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">        </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">try</span><span style="border: none; color: black;"> {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">            </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">while</span><span style="border: none; color: black;"> (count == </span><span style="border: none; color: rgb(192, 0, 0);">0</span><span style="border: none; color: black;">) {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">                notEmpty.await();  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">            }  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">            T ret = items[head];  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">            items[head] = </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">null</span><span style="border: none; color: black;">;</span><span style="border: none; color: rgb(0, 130, 0);">//GC</span><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">            </span><span style="border: none; color: rgb(0, 130, 0);">//</span><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">            </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">if</span><span style="border: none; color: black;"> (++head == getCapacity()) {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">                head = </span><span style="border: none; color: rgb(192, 0, 0);">0</span><span style="border: none; color: black;">;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">            }  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">            --count;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">            notFull.signalAll();  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">            </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">return</span><span style="border: none; color: black;"> ret;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">        } </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">finally</span><span style="border: none; color: black;"> {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">            lock.unlock();  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">        }  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">    }  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">public</span><span style="border: none; color: black;"> </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">int</span><span style="border: none; color: black;"> getCapacity() {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">        </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">return</span><span style="border: none; color: black;"> items.length;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">    }  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">public</span><span style="border: none; color: black;"> </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">int</span><span style="border: none; color: black;"> size() {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">        lock.lock();  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">        </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">try</span><span style="border: none; color: black;"> {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">            </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">return</span><span style="border: none; color: black;"> count;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">        } </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">finally</span><span style="border: none; color: black;"> {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">            lock.unlock();  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">        }  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">    }  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">}  </span></li></ol></div><div><br/></div><div><br/></div><div style="margin: 0px; padding: 0px;"></div></blockquote><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"><span style="text-indent: 20px; font-family: SimSun;">在这个例子中消费</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">take()</span><span style="text-indent: 20px; font-family: SimSun;">需要 队列不为空，如果为空就挂起（</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">await()</span><span style="text-indent: 20px; font-family: SimSun;">），直到收到</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">notEmpty</span><span style="text-indent: 20px; font-family: SimSun;">的信号；生产</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">put()</span><span style="text-indent: 20px; font-family: SimSun;">需要队列不满，如果满了就挂起（</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">await()</span><span style="text-indent: 20px; font-family: SimSun;">），直到收到</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">notFull</span><span style="text-indent: 20px; font-family: SimSun;">的信号。</span></div><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"><span style="text-indent: 20px; font-family: SimSun;">可能有人会问题，如果一个线程</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">lock()</span><span style="text-indent: 20px; font-family: SimSun;">对象后被挂起还没有</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">unlock</span><span style="text-indent: 20px; font-family: SimSun;">，那么另外一个线程就拿不到锁了（</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">lock()</span><span style="text-indent: 20px; font-family: SimSun;">操作会挂起），那么就无法通知(</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">notify</span><span style="text-indent: 20px; font-family: SimSun;">)前一个线程，这样岂不是“死锁”了？</span></div><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"><span style="text-indent: 20px; font-family: SimSun;"> </span></div><h2 style="margin: 0px; padding: 0px; font-size: 14px;"><span style="font-size: 14px; font-weight: bold; font-family: SimSun;">2.1 await* 操作</span></h2><div style="margin: 0px; padding: 0px;"><div><br/></div></div><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"><span style="text-indent: 20px; font-family: SimSun;">上一节中说过多次</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">ReentrantLock</span><span style="text-indent: 20px; font-family: SimSun;">是独占锁，一个线程拿到锁后如果不释放，那么另外一个线程肯定是拿不到锁，所以在</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">lock.lock()</span><span style="text-indent: 20px; font-family: SimSun;">和</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">lock.unlock()</span><span style="text-indent: 20px; font-family: SimSun;">之间可能有一次释放锁的操作（同样也必然还有一次获取锁的操作）。我们再回头看代码，不管</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">take()</span><span style="text-indent: 20px; font-family: SimSun;">还是</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">put()</span><span style="text-indent: 20px; font-family: SimSun;">，在进入</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">lock.lock()</span><span style="text-indent: 20px; font-family: SimSun;">后唯一可能释放锁的操作就是</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">await()</span><span style="text-indent: 20px; font-family: SimSun;">了。也就是说</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">await()</span><span style="text-indent: 20px; font-family: SimSun;">操作实际上就是释放锁，然后挂起线程，一旦条件满足就被唤醒，再次获取锁！</span></div><blockquote style="margin: 0px; padding: 0px; font-style: italic;"><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"></div><div style="margin: 18px 0px !important; padding: 1px 0px 0px; font-size: 12px; width: 857.328px; overflow-y: hidden; position: relative;"><div style="margin: 0px; padding: 0px 0px 0px 45px;"><div style="margin: 0px; padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left: 3px solid rgb(108, 226, 108);"><div><span style="font-weight: bold;">[java]</span> <a href="http://blog.csdn.net/vernonzheng/article/details/8288251#" style="color: rgb(160, 160, 160); background-image: url(&quot;background-position; background-repeat: no-repeat; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px&quot;);" title="view plain">view plain</a> <a href="http://blog.csdn.net/vernonzheng/article/details/8288251#" style="color: rgb(160, 160, 160); background-image: url(&quot;background-position; background-repeat: no-repeat; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px&quot;);" title="copy">copy</a></div><div style="margin: 0px; padding: 0px; position: absolute; left: 484px; top: 4265px; width: 18px; height: 18px; z-index: 99;"></div></div></div><ol start="1" style="margin: 0px 0px 1px 45px !important; padding: 0px; border: none; color: rgb(92, 92, 92);"><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">public</span><span style="border: none; color: black;"> </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">final</span><span style="border: none; color: black;"> </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">void</span><span style="border: none; color: black;"> await() </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">throws</span><span style="border: none; color: black;"> InterruptedException {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">if</span><span style="border: none; color: black;"> (Thread.interrupted())  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">        </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">throw</span><span style="border: none; color: black;"> </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">new</span><span style="border: none; color: black;"> InterruptedException();  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">    Node node = addConditionWaiter();  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">int</span><span style="border: none; color: black;"> savedState = fullyRelease(node);  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">int</span><span style="border: none; color: black;"> interruptMode = </span><span style="border: none; color: rgb(192, 0, 0);">0</span><span style="border: none; color: black;">;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">while</span><span style="border: none; color: black;"> (!isOnSyncQueue(node)) {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">        LockSupport.park(</span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">this</span><span style="border: none; color: black;">);  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">        </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">if</span><span style="border: none; color: black;"> ((interruptMode = checkInterruptWhileWaiting(node)) != </span><span style="border: none; color: rgb(192, 0, 0);">0</span><span style="border: none; color: black;">)  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">            </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">break</span><span style="border: none; color: black;">;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">    }  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">if</span><span style="border: none; color: black;"> (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE)  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">        interruptMode = REINTERRUPT;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">if</span><span style="border: none; color: black;"> (node.nextWaiter != </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">null</span><span style="border: none; color: black;">)  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">        unlinkCancelledWaiters();  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">if</span><span style="border: none; color: black;"> (interruptMode != </span><span style="border: none; color: rgb(192, 0, 0);">0</span><span style="border: none; color: black;">)  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">        reportInterruptAfterWait(interruptMode);  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">}  </span></li></ol></div><div><br/></div><div><br/></div><div style="margin: 0px; padding: 0px;"></div></blockquote><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"><span style="text-indent: 20px; font-family: SimSun;">上面是</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">await()</span><span style="text-indent: 20px; font-family: SimSun;">的代码片段。上一节中说过,AQS在获取锁的时候需要有一个</span><a href="http://blog.csdn.net/a511596982/article/details/8275624" style="text-indent: 20px; font-family: SimSun; font-weight: bold; color: rgb(202, 0, 0);">CHL</a><span style="text-indent: 20px; font-family: SimSun;">的FIFO队列，所以对于一个</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">Condition.await()</span><span style="text-indent: 20px; font-family: SimSun;">而言，如果释放了锁，要想再一次获取锁那么就需要进入队列，等待被通知获取锁。完整的await()操作是安装如下步骤进行的：</span></div><ol style="margin: 1em 0px; padding: 0px;"><li style="margin: 0px 0px 0px 40px; padding: 0px; list-style: decimal;"><span style="font-family: SimSun;">将当前线程加入</span><span style="font-family: SimSun; font-style: italic;">Condition</span><span style="font-family: SimSun;">锁队列。特别说明的是，这里不同于</span><a href="http://blog.csdn.net/a511596982/article/details/8275624" style="font-family: SimSun; font-weight: bold; color: rgb(202, 0, 0);">AQS</a><span style="font-family: SimSun;">的队列，这里进入的是</span><span style="font-family: SimSun; font-style: italic;">Condition</span><span style="font-family: SimSun;">的FIFO队列。后面会具体谈到此结构。进行2。</span></li><li style="margin: 0px 0px 0px 40px; padding: 0px; list-style: decimal;"><span style="font-family: SimSun;">释放锁。这里可以看到将锁释放了，否则别的线程就无法拿到锁而发生死锁。进行3。</span></li><li style="margin: 0px 0px 0px 40px; padding: 0px; list-style: decimal;"><span style="font-family: SimSun;">自旋(while)挂起，直到被唤醒或者超时或者CACELLED等。进行4。</span></li><li style="margin: 0px 0px 0px 40px; padding: 0px; list-style: decimal;"><span style="font-family: SimSun;">获取锁(</span><span style="font-family: SimSun; font-style: italic;">acquireQueued</span><span style="font-family: SimSun;">)。并将自己从</span><span style="font-family: SimSun; font-style: italic;">Condition</span><span style="font-family: SimSun;">的FIFO队列中释放，表明自己不再需要锁（我已经拿到锁了）。</span></li></ol><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"><span style="text-indent: 20px; font-family: SimSun;">这里再回头介绍</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">Condition</span><span style="text-indent: 20px; font-family: SimSun;">的</span><a href="http://lib.csdn.net/base/datastructure" style="text-indent: 20px; font-family: SimSun; color: rgb(223, 52, 52); font-weight: bold;" title="算法与数据结构知识库">数据结构</a><span style="text-indent: 20px; font-family: SimSun;">。我们知道一个</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">Condition</span><span style="text-indent: 20px; font-family: SimSun;">可以在多个地方被</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">await*()</span><span style="text-indent: 20px; font-family: SimSun;">，那么就需要一个FIFO的结构将这些</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">Condition</span><span style="text-indent: 20px; font-family: SimSun;">串联起来，然后根据需要唤醒一个或者多个（通常是所有）。所以在</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">Condition</span><span style="text-indent: 20px; font-family: SimSun;">内部就需要一个FIFO的队列。</span></div><blockquote style="margin: 0px; padding: 0px; font-style: italic;"><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"></div><div style="margin: 18px 0px !important; padding: 1px 0px 0px; font-size: 12px; width: 857.328px; overflow-y: hidden; position: relative;"><div style="margin: 0px; padding: 0px 0px 0px 45px;"><div style="margin: 0px; padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left: 3px solid rgb(108, 226, 108);"><div><span style="font-weight: bold;">[java]</span> <a href="http://blog.csdn.net/vernonzheng/article/details/8288251#" style="color: rgb(160, 160, 160); background-image: url(&quot;background-position; background-repeat: no-repeat; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px&quot;);" title="view plain">view plain</a> <a href="http://blog.csdn.net/vernonzheng/article/details/8288251#" style="color: rgb(160, 160, 160); background-image: url(&quot;background-position; background-repeat: no-repeat; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px&quot;);" title="copy">copy</a></div><div style="margin: 0px; padding: 0px; position: absolute; left: 484px; top: 4916px; width: 18px; height: 18px; z-index: 99;"></div></div></div><ol start="1" style="margin: 0px 0px 1px 45px !important; padding: 0px; border: none; color: rgb(92, 92, 92);"><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">private</span><span style="border: none; color: black;"> </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">transient</span><span style="border: none; color: black;"> Node firstWaiter;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">private</span><span style="border: none; color: black;"> </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">transient</span><span style="border: none; color: black;"> Node lastWaiter;  </span></li></ol></div><div><br/></div><div style="margin: 0px; padding: 0px;"></div></blockquote><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"><span style="text-indent: 20px; font-family: SimSun;">上面的两个节点就是描述一个FIFO的队列。我们再结合前面提到的节点（Node）数据结构。我们就发现</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">Node.nextWaiter</span><span style="text-indent: 20px; font-family: SimSun;">就派上用场了！</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">nextWaiter</span><span style="text-indent: 20px; font-family: SimSun;">就是将一系列的</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">Condition.await*</span><span style="text-indent: 20px; font-family: SimSun;">串联起来组成一个FIFO的队列。</span></div><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"><span style="text-indent: 20px; font-family: SimSun;"> </span></div><h2 style="margin: 0px; padding: 0px; font-size: 14px;"><span style="font-size: 14px; font-weight: bold; font-family: SimSun;">2.2 signal/signalAll 操作</span></h2><div style="margin: 0px; padding: 0px;"><div><br/></div></div><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">await*()</span><span style="text-indent: 20px; font-family: SimSun;">清楚了，现在再来看</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">signal/signalAll</span><span style="text-indent: 20px; font-family: SimSun;">就容易多了。按照</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">signal/signalAll</span><span style="text-indent: 20px; font-family: SimSun;">的需求，就是要将</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">Condition.await*()</span><span style="text-indent: 20px; font-family: SimSun;">中FIFO队列中第一个</span><span style="text-indent: 20px; font-family: SimSun; font-weight: bold;">Node</span><span style="text-indent: 20px; font-family: SimSun;">唤醒（或者全部</span><span style="text-indent: 20px; font-family: SimSun; font-weight: bold;">Node</span><span style="text-indent: 20px; font-family: SimSun;">）唤醒。尽管所有</span><span style="text-indent: 20px; font-family: SimSun; font-weight: bold;">Node</span><span style="text-indent: 20px; font-family: SimSun;">可能都被唤醒，但是要知道的是仍然只有一个线程能够拿到锁，其它没有拿到锁的线程仍然需要自旋等待，就上上面提到的第4步(acquireQueued)。</span></div><blockquote style="margin: 0px; padding: 0px; font-style: italic;"><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"></div><div style="margin: 18px 0px !important; padding: 1px 0px 0px; font-size: 12px; width: 857.328px; overflow-y: hidden; position: relative;"><div style="margin: 0px; padding: 0px 0px 0px 45px;"><div style="margin: 0px; padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left: 3px solid rgb(108, 226, 108);"><div><span style="font-weight: bold;">[java]</span> <a href="http://blog.csdn.net/vernonzheng/article/details/8288251#" style="color: rgb(160, 160, 160); background-image: url(&quot;background-position; background-repeat: no-repeat; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px&quot;);" title="view plain">view plain</a> <a href="http://blog.csdn.net/vernonzheng/article/details/8288251#" style="color: rgb(160, 160, 160); background-image: url(&quot;background-position; background-repeat: no-repeat; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px&quot;);" title="copy">copy</a></div><div style="margin: 0px; padding: 0px; position: absolute; left: 484px; top: 5251px; width: 18px; height: 18px; z-index: 99;"></div></div></div><ol start="1" style="margin: 0px 0px 1px 45px !important; padding: 0px; border: none; color: rgb(92, 92, 92);"><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">private</span><span style="border: none; color: black;"> </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">void</span><span style="border: none; color: black;"> doSignal(Node first) {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">do</span><span style="border: none; color: black;"> {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">        </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">if</span><span style="border: none; color: black;"> ( (firstWaiter = first.nextWaiter) == </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">null</span><span style="border: none; color: black;">)  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">            lastWaiter = </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">null</span><span style="border: none; color: black;">;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">        first.nextWaiter = </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">null</span><span style="border: none; color: black;">;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">    } </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">while</span><span style="border: none; color: black;"> (!transferForSignal(first) &amp;&amp;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">             (first = firstWaiter) != </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">null</span><span style="border: none; color: black;">);  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">}  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">private</span><span style="border: none; color: black;"> </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">void</span><span style="border: none; color: black;"> doSignalAll(Node first) {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">    lastWaiter = firstWaiter  = </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">null</span><span style="border: none; color: black;">;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">do</span><span style="border: none; color: black;"> {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">        Node next = first.nextWaiter;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">        first.nextWaiter = </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">null</span><span style="border: none; color: black;">;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">        transferForSignal(first);  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">        first = next;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">    } </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">while</span><span style="border: none; color: black;"> (first != </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">null</span><span style="border: none; color: black;">);  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">}  </span></li></ol></div><div><br/></div><div><br/></div><div style="margin: 0px; padding: 0px;"></div></blockquote><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"><span style="text-indent: 20px; font-family: SimSun;">上面的代码很容易看出来，</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">signal</span><span style="text-indent: 20px; font-family: SimSun;">就是唤醒</span><span style="text-indent: 20px; font-family: SimSun; font-weight: bold;">Condition</span><span style="text-indent: 20px; font-family: SimSun;">队列中的第一个非CANCELLED节点线程，而signalAll就是唤醒所有非CANCELLED节点线程。当然了遇到CANCELLED线程就需要将其从FIFO队列中剔除。</span></div><blockquote style="margin: 0px; padding: 0px; font-style: italic;"><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"></div><div style="margin: 18px 0px !important; padding: 1px 0px 0px; font-size: 12px; width: 857.328px; overflow-y: hidden; position: relative;"><div style="margin: 0px; padding: 0px 0px 0px 45px;"><div style="margin: 0px; padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left: 3px solid rgb(108, 226, 108);"><div><span style="font-weight: bold;">[java]</span> <a href="http://blog.csdn.net/vernonzheng/article/details/8288251#" style="color: rgb(160, 160, 160); background-image: url(&quot;background-position; background-repeat: no-repeat; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px&quot;);" title="view plain">view plain</a> <a href="http://blog.csdn.net/vernonzheng/article/details/8288251#" style="color: rgb(160, 160, 160); background-image: url(&quot;background-position; background-repeat: no-repeat; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px&quot;);" title="copy">copy</a></div><div style="margin: 0px; padding: 0px; position: absolute; left: 484px; top: 5736px; width: 18px; height: 18px; z-index: 99;"></div></div></div><ol start="1" style="margin: 0px 0px 1px 45px !important; padding: 0px; border: none; color: rgb(92, 92, 92);"><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">final</span><span style="border: none; color: black;"> </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">boolean</span><span style="border: none; color: black;"> transferForSignal(Node node) {  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">if</span><span style="border: none; color: black;"> (!compareAndSetWaitStatus(node, Node.CONDITION, </span><span style="border: none; color: rgb(192, 0, 0);">0</span><span style="border: none; color: black;">))  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">        </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">return</span><span style="border: none; color: black;"> </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">false</span><span style="border: none; color: black;">;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">    Node p = enq(node);  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">int</span><span style="border: none; color: black;"> c = p.waitStatus;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">if</span><span style="border: none; color: black;"> (c &gt; </span><span style="border: none; color: rgb(192, 0, 0);">0</span><span style="border: none; color: black;"> || !compareAndSetWaitStatus(p, c, Node.SIGNAL))  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">        LockSupport.unpark(node.thread);  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; color: inherit;"><span style="border: none; color: black;">    </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">return</span><span style="border: none; color: black;"> </span><span style="border: none; color: rgb(0, 102, 153); font-weight: bold;">true</span><span style="border: none; color: black;">;  </span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; list-style-type: decimal-leading-zero; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial;"><span style="border: none; color: black;">}  </span></li></ol></div><div><br/></div><div><br/></div><div style="margin: 0px; padding: 0px;"></div></blockquote><div style="margin: 10px 0px; padding: 0px; text-indent: 20px;"><span style="text-indent: 20px; font-family: SimSun;">上面就是唤醒一个</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">await*()</span><span style="text-indent: 20px; font-family: SimSun;">线程的过程，根据前面的小节介绍的，如果要</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">unpark</span><span style="text-indent: 20px; font-family: SimSun;">线程，并使线程拿到锁，那么就需要线程节点进入</span><span style="text-indent: 20px; font-family: SimSun; font-weight: bold;">AQS</span><span style="text-indent: 20px; font-family: SimSun;">的队列。所以可以看到在</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">LockSupport.unpark</span><span style="text-indent: 20px; font-family: SimSun;">之前调用了</span><span style="text-indent: 20px; font-family: SimSun; font-style: italic;">enq(node)</span><span style="text-indent: 20px; font-family: SimSun;">操作，将当前节点加入到</span><span style="text-indent: 20px; font-family: SimSun; font-weight: bold;">AQS</span><span style="text-indent: 20px; font-family: SimSun;">队列。</span></div></div><div><br/></div><div><br/></div><div><br/></div><div><b><font style="font-size: 18pt; color: rgb(20, 113, 145);">ReentrantLock源码解析</font></b></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(31, 73, 125); font-family: SimSun; font-size: 18px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-weight: bold;">ReentrantLock</span><span style="color: rgb(31, 73, 125); font-family: SimSun; font-size: 18px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-weight: bold;">原理</span><span style="color: rgb(31, 73, 125); font-family: SimSun; font-size: 18px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-weight: bold;">个人理解</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">ReentrantLock内部含有一个AbstractQueuedSynchronizer的同步器实现sync,包括公平和不公平两个模式如下：</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    //抽象队列同步器</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    abstract static class Sync extends AbstractQueuedSynchronizer {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        private static final long serialVersionUID = -5179523762034025860L;</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        //抽象锁操作 留给子类实现</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        abstract void lock();</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        //尝试不公平获取资源 就是不管队列是否为空，都会先尝试获取资源，获取成功后设置独占线程</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        final boolean nonfairTryAcquire(int acquires) {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            final Thread current = Thread.currentThread();</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            int c = getState();</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            if (c == 0) {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                if (compareAndSetState(0, acquires)) {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                    setExclusiveOwnerThread(current);</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                    return true;</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            else if (current == getExclusiveOwnerThread()) {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                int nextc = c + acquires;</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                if (nextc &lt; 0) // overflow</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                    throw new Error(&quot;Maximum lock count exceeded&quot;);</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                setState(nextc);</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                return true;</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            return false;</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        //尝试释放资源</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        protected final boolean tryRelease(int releases) {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            int c = getState() - releases;</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            if (Thread.currentThread() != getExclusiveOwnerThread())</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                throw new IllegalMonitorStateException();</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            boolean free = false;</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            if (c == 0) {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                free = true;</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                setExclusiveOwnerThread(null);</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            setState(c);</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            return free;</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        //当前线程是否独占资源</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        protected final boolean isHeldExclusively() {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            return getExclusiveOwnerThread() == Thread.currentThread();</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        //实例化个新的Condition</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        final ConditionObject newCondition() {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            return new ConditionObject();</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        //获取当前占有资源的线程</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        final Thread getOwner() {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            return getState() == 0 ? null : getExclusiveOwnerThread();</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        //获取当前线程占有的资源数量</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        final int getHoldCount() {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            return isHeldExclusively() ? getState() : 0;</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        //判断资源是否等于0 如果不等于0 资源就被锁住 否则资源时空闲的</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        final boolean isLocked() {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            return getState() != 0;</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br/></div></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    //不公平抽象队列同步器</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    static final class NonfairSync extends Sync {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        private static final long serialVersionUID = 7316153563782823691L;</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        //锁 先尝试直接获取资源，否则调用acquire获取资源</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        final void lock() {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            if (compareAndSetState(0, 1))</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                setExclusiveOwnerThread(Thread.currentThread());</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            else</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                acquire(1);</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        //使用父类不公平的方式尝试获取资源</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        protected final boolean tryAcquire(int acquires) {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            return nonfairTryAcquire(acquires);</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br/></div></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    //公平抽象队列同步器</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    static final class FairSync extends Sync {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        private static final long serialVersionUID = -3000897897090466540L;</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        //锁。直接调用acquire获取资源</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        final void lock() {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            acquire(1);</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br/></div></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        //尝试获取资源，会照顾队列前的元素 获取到资源后设置独占线程</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        protected final boolean tryAcquire(int acquires) {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            final Thread current = Thread.currentThread();</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            int c = getState();</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            if (c == 0) {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                if (!hasQueuedPredecessors() &amp;&amp;</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                    compareAndSetState(0, acquires)) {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                    setExclusiveOwnerThread(current);</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                    return true;</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            else if (current == getExclusiveOwnerThread()) {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                int nextc = c + acquires;</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                if (nextc &lt; 0)</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                    throw new Error(&quot;Maximum lock count exceeded&quot;);</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                setState(nextc);</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">                return true;</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">            return false;</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br/></div></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">ReentrantLock外部接口</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    //获取锁</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    public void lock() {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        sync.lock();</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    //释放锁</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">      public void unlock() {</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">        sync.release(1);</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">    }</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br/></div></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">over</span></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br/></div></div><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: punctuation, 微软雅黑, Tohoma; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0); font-family: SimSun; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">参考：</span></div><div><span style="color: rgb(0, 0, 0); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: SimSun; font-size: 12px;">《深入浅出 Java Concurrency》—锁机制(一)Lock与ReentrantLock</span></div><div><a href="http://blog.csdn.net/fg2006/article/details/6397894" style="color: rgb(38, 112, 154); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: SimSun; font-size: 12px;">http://blog.csdn.net/fg2006/article/details/6397894</a></div><div><span style="color: rgb(0, 0, 0); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: SimSun; font-size: 12px;">Java多线程基础总结七：ReentrantLock(2)</span></div><div><a href="http://www.bianceng.cn/Programming/Java/201206/34155_2.htm" style="color: rgb(38, 112, 154); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: SimSun; font-size: 12px;">http://www.bianceng.cn/Programming/Java/201206/34155_2.htm</a></div><div><span style="color: rgb(0, 0, 0); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: SimSun; font-size: 12px;">再谈重入锁--ReentrantLock</span></div><div><a href="http://tenyears.iteye.com/blog/48750" style="color: rgb(38, 112, 154); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: SimSun; font-size: 12px;">http://tenyears.iteye.com/blog/48750</a></div><div><span style="color: rgb(0, 0, 0); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: SimSun; font-size: 12px;">深入浅出 Java Concurrency (9): 锁机制 part 4</span></div><div><a href="http://www.blogjava.net/xylz/archive/2010/07/08/325540.html" style="color: rgb(38, 112, 154); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: SimSun; font-size: 12px;">http://www.blogjava.net/xylz/archive/2010/07/08/325540.html</a></div></div></span>
</div></body></html> 