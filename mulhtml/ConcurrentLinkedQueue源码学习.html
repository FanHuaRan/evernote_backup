<html>
<head>
  <title>ConcurrentLinkedQueue源码学习</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1240"/>
<h1>ConcurrentLinkedQueue源码学习</h1>

<div>
<span><div><div><font style="font-size: 18pt; color: rgb(26, 144, 185);"><b>个人理解</b></font></div><div>略</div><div><br/></div><div><b><font color="#1A90B9" style="font-size: 18pt;">java8源码</font></b></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * An optionally</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">bounded</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@linkplain BlockingQueue blocking queue}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">based on</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * linked nodes.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * This queue orders elements FIFO (first</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">in</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">first</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">out).</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * The</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;em&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">head</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/em&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">of the queue is that element that has been on the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * queue the longest time.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * The</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;em&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">tail</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/em&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">of the queue is that element that has been on the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * queue the shortest time. New elements</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * are inserted at the tail of the queue, and the queue retrieval</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * operations obtain elements at the head of the queue.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * Linked queues typically have higher throughput than array</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">based queues but</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * less predictable performance in most concurrent applications.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">The optional capacity bound constructor argument serves as a</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * way to prevent excessive queue expansion. The capacity, if unspecified,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * is equal to</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link Integer#MAX_VALUE}</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">.  Linked nodes are</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * dynamically created upon each insertion unless this would bring the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * queue above capacity.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">This class and its iterator implement all of the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;em&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">optional</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/em&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">methods of the</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link Collection}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">and</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;"> * Iterator}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">interfaces.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">This class is a member of the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * &lt;a href=&quot;{@docRoot}/../technotes/guides/collections/index.html&quot;&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * Java Collections Framework</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/a&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@since</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">1.5</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@author</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Doug Lea</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">the type of elements held in this collection</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">class</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; background: #d4d4d4; color: rgb(51, 51, 51);">LinkedBlockingQueue</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">extends</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">AbstractQueue&lt;E&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">implements</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">BlockingQueue&lt;E&gt;, java.io.Serializable {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">long</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">serialVersionUID</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= -6903933977591709194L;</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">/*</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * A variant of the &quot;two lock queue&quot; algorithm.  The putLock gates</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * entry to put (and offer), and has an associated condition for</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * waiting puts.  Similarly for the takeLock.  The &quot;count&quot; field</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * that they both rely on is maintained as an atomic to avoid</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * needing to get both locks in most cases. Also, to minimize need</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * for puts to get takeLock and vice-versa, cascading notifies are</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * used. When a put notices that it has enabled at least one take,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * it signals taker. That taker in turn signals others if more</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * items have been entered since the signal. And symmetrically for</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * takes signalling puts. Operations such as remove(Object) and</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * iterators acquire both locks.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * Visibility between writers and readers is provided as follows:</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * Whenever an element is enqueued, the putLock is acquired and</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * count updated.  A subsequent reader guarantees visibility to the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * enqueued Node by either acquiring the putLock (via fullyLock)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * or by acquiring the takeLock, and then reading n = count.get();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * this gives visibility to the first n items.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * To implement weakly consistent iterators, it appears we need to</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * keep all Nodes GC-reachable from a predecessor dequeued Node.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * That would cause two problems:</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * - allow a rogue Iterator to cause unbounded memory retention</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * - cause cross-generational linking of old Nodes to new Nodes if</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *   a Node was tenured while live, which generational GCs have a</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     *   hard time dealing with, causing repeated major collections.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * However, only non-deleted Nodes need to be reachable from</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * dequeued Nodes, and reachability does not necessarily have to</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * be of the kind understood by the GC.  We use the trick of</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * linking a Node that has just been dequeued to itself.  Such a</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     * self-link implicitly means to advance to head.next.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Linked list node class</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">class</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Node&lt;E&gt; {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        E</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">         * One of:</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">         *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">the real successor Node</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">         *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">this Node, meaning the successor is head.next</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">         *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">null, meaning there is no successor (this is the last node)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">         */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        Node(E</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">x</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">x</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">; }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/** The capacity bound, or Integer.MAX_VALUE if none */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">capacity</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/** Current number of elements */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">AtomicInteger</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">AtomicInteger();</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Head of linked list.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Invariant: head.item == null</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">transient</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Tail of linked list.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Invariant: last.next == null</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">transient</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">last</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/** Lock held by take, poll, etc */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ReentrantLock</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">takeLock</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ReentrantLock();</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/** Wait queue for waiting takes */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Condition</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">notEmpty</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">takeLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.newCondition();</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/** Lock held by put, offer, etc */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ReentrantLock</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">putLock</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ReentrantLock();</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/** Wait queue for waiting puts */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Condition</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">notFull</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">putLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.newCondition();</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Signals a waiting take. Called only from put/offer (which do not</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * otherwise ordinarily lock takeLock.)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">void</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">signalNotEmpty() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ReentrantLock</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">takeLock</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">takeLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">takeLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.lock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">notEmpty</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.signal();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">takeLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.unlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Signals a waiting put. Called only from take/poll.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">void</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">signalNotFull() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ReentrantLock</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">putLock</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">putLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">putLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.lock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">notFull</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.signal();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">putLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.unlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Links node at end of queue.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">node the node</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">void</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">enqueue(Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">node</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// assert putLock.isHeldByCurrentThread();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// assert last.next == null;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">last</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">last</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">node</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Removes a node from head of queue.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">the node</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">E dequeue() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// assert takeLock.isHeldByCurrentThread();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// assert head.item == null;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">first</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// help GC</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">first</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        E</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">x</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">first</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">first</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">x</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Locks to prevent both puts and takes.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">void</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">fullyLock() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">putLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.lock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">takeLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.lock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Unlocks to allow both puts and takes.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">void</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">fullyUnlock() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">takeLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.unlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">putLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.unlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">//     /**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">//      * Tells whether both locks are held by current thread.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">//      */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">//     boolean isFullyLocked() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">//         return (putLock.isHeldByCurrentThread() &amp;&amp;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">//                 takeLock.isHeldByCurrentThread());</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">//     }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Creates a {@code LinkedBlockingQueue} with a capacity of</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link Integer#MAX_VALUE}</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">LinkedBlockingQueue() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(Integer.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">MAX_VALUE</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Creates a {@code LinkedBlockingQueue} with the given (fixed) capacity.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">capacity the capacity of this queue</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">IllegalArgumentException if {@code capacity} is not greater</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         than zero</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">LinkedBlockingQueue(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">capacity</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">capacity</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;= 0)</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">IllegalArgumentException();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">capacity</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">capacity</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">last</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Node&lt;E&gt;(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Creates a {@code LinkedBlockingQueue} with a capacity of</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link Integer#MAX_VALUE}</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">, initially containing the elements of the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * given collection,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * added in traversal order of the collection's iterator.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">c the collection of elements to initially contain</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">NullPointerException if the specified collection or any</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         of its elements are null</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">LinkedBlockingQueue(Collection&lt;?</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">extends</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(Integer.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">MAX_VALUE</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ReentrantLock</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">putLock</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">putLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">putLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.lock();</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// Never contended, but necessary for visibility</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">n</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= 0;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">for</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(E</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">:</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">NullPointerException();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">n</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">capacity</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">IllegalStateException(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(42, 0, 255); font-size: 14pt;">&quot;Queue full&quot;</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                enqueue(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Node&lt;E&gt;(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">));</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                ++</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">n</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.set(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">n</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">putLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.unlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// this doc comment is overridden to remove the reference to collections</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// greater in size than Integer.MAX_VALUE</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Returns the number of elements in this queue.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">the number of elements in this queue</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">size() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.get();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// this doc comment is a modified copy of the inherited doc comment,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// without the reference to unlimited queues.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Returns the number of additional elements that this queue can ideally</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * (in the absence of memory or resource constraints) accept without</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * blocking. This is always equal to the initial capacity of this queue</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * less the current {@code size} of this queue.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Note that you</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;em&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">cannot</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/em&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">always tell if an attempt to insert</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * an element will succeed by inspecting {@code remainingCapacity}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * because it may be the case that another thread is about to</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * insert or remove an element.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">remainingCapacity() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">capacity</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">-</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.get();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Inserts the specified element at the tail of this queue, waiting if</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * necessary for space to become available.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">InterruptedException</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@inheritDoc}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">NullPointerException</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@inheritDoc}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">void</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">put(E</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throws</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">InterruptedException {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">NullPointerException();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// Note: convention in all put/take/etc is to preset local var</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// holding count negative to indicate failure unless set.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= -1;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">node</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Node&lt;E&gt;(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ReentrantLock</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">putLock</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">putLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">AtomicInteger</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">count</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">putLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.lockInterruptibly();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">/*</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">             * Note that count is used in wait guard even though it is</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">             * not protected by lock. This works because count can</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">             * only decrease at this point (all other puts are shut</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">             * out by lock), and we (or some other waiting put) are</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">             * signalled if it ever changes from capacity. Similarly</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">             * for all other uses of count in other wait guards.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">             */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">while</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.get() ==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">capacity</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">notFull</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.await();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            enqueue(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">node</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.getAndIncrement();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">+ 1 &lt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">capacity</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">notFull</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.signal();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">putLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.unlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">== 0)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            signalNotEmpty();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Inserts the specified element at the tail of this queue, waiting if</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * necessary up to the specified wait time for space to become available.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">{@code true} if successful, or {@code false} if</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         the specified waiting time elapses before space is available</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">InterruptedException</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@inheritDoc}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">NullPointerException</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@inheritDoc}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">boolean</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">offer(E</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">long</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">timeout</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">, TimeUnit</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">unit</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throws</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">InterruptedException {</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">NullPointerException();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">long</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">nanos</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">unit</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.toNanos(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">timeout</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= -1;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ReentrantLock</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">putLock</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">putLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">AtomicInteger</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">count</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">putLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.lockInterruptibly();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">while</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.get() ==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">capacity</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">nanos</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;= 0)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">false</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">nanos</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">notFull</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.awaitNanos(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">nanos</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            enqueue(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Node&lt;E&gt;(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">));</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.getAndIncrement();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">+ 1 &lt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">capacity</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">notFull</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.signal();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">putLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.unlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">== 0)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            signalNotEmpty();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">true</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Inserts the specified element at the tail of this queue if it is</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * possible to do so immediately without exceeding the queue's capacity,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * returning {@code true} upon success and {@code false} if this queue</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * is full.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * When using a capacity</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">restricted queue, this method is generally</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * preferable to method</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link BlockingQueue#add add}</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">, which can fail to</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * insert an element only by throwing an exception.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">NullPointerException if the specified element is null</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">boolean</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">offer(E</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">NullPointerException();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">AtomicInteger</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">count</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.get() ==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">capacity</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">false</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= -1;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">node</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Node&lt;E&gt;(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ReentrantLock</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">putLock</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">putLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">putLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.lock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.get() &lt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">capacity</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                enqueue(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">node</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.getAndIncrement();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">+ 1 &lt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">capacity</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">notFull</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.signal();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">putLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.unlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">== 0)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            signalNotEmpty();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&gt;= 0;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">E take()</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throws</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">InterruptedException {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        E</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">x</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= -1;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">AtomicInteger</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">count</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ReentrantLock</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">takeLock</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">takeLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">takeLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.lockInterruptibly();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">while</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.get() == 0) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">notEmpty</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.await();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">x</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= dequeue();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.getAndDecrement();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&gt; 1)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">notEmpty</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.signal();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">takeLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.unlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">capacity</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            signalNotFull();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">x</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">E poll(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">long</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">timeout</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">, TimeUnit</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">unit</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throws</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">InterruptedException {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        E</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">x</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= -1;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">long</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">nanos</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">unit</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.toNanos(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">timeout</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">AtomicInteger</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">count</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ReentrantLock</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">takeLock</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">takeLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">takeLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.lockInterruptibly();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">while</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.get() == 0) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">nanos</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;= 0)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">nanos</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">notEmpty</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.awaitNanos(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">nanos</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">x</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= dequeue();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.getAndDecrement();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&gt; 1)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">notEmpty</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.signal();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">takeLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.unlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">capacity</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            signalNotFull();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">x</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">E poll() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">AtomicInteger</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">count</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.get() == 0)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        E</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">x</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= -1;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ReentrantLock</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">takeLock</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">takeLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">takeLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.lock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.get() &gt; 0) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">x</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= dequeue();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.getAndDecrement();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&gt; 1)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">notEmpty</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.signal();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">takeLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.unlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">capacity</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            signalNotFull();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">x</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">E peek() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.get() == 0)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ReentrantLock</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">takeLock</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">takeLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">takeLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.lock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">first</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">first</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">else</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">first</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">takeLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.unlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Unlinks interior Node p with predecessor trail.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">void</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">unlink(Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">, Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">trail</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// assert isFullyLocked();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// p.next is not changed, to allow iterators that are</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// traversing p to maintain their weak-consistency guarantee.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">trail</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">last</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">last</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">trail</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.getAndDecrement() ==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">capacity</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">notFull</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.signal();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Removes a single instance of the specified element from this queue,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * if it is present.  More formally, removes an element {@code e} such</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * that {@code o.equals(e)}, if this queue contains one or more such</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * elements.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Returns {@code true} if this queue contained the specified element</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * (or equivalently, if this queue changed as a result of the call).</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">o element to be removed from this queue, if present</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">{@code true} if this queue changed as a result of the call</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">boolean</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">remove(Object</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">o</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">o</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">false</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        fullyLock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">for</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">trail</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">trail</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">trail</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">o</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.equals(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                    unlink(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">trail</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">true</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">false</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            fullyUnlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Returns {@code true} if this queue contains the specified element.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * More formally, returns {@code true} if and only if this queue contains</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * at least one element {@code e} such that {@code o.equals(e)}.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">o object to be checked for containment in this queue</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">{@code true} if this queue contains the specified element</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">boolean</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">contains(Object</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">o</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">o</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">false</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        fullyLock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">for</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">o</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.equals(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">))</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">true</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">false</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            fullyUnlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Returns an array containing all of the elements in this queue, in</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * proper sequence.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">The returned array will be &quot;safe&quot; in that no references to it are</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * maintained by this queue.  (In other words, this method must allocate</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * a new array).  The caller is thus free to modify the returned array.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">This method acts as bridge between array</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">based and collection</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">based</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * APIs.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">an array containing all of the elements in this queue</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Object[] toArray() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        fullyLock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">size</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.get();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            Object[]</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Object[</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">size</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">];</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">k</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= 0;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">for</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">[</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">k</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">++] =</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            fullyUnlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Returns an array containing all of the elements in this queue, in</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * proper sequence; the runtime type of the returned array is that of</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * the specified array.  If the queue fits in the specified array, it</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * is returned therein.  Otherwise, a new array is allocated with the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * runtime type of the specified array and the size of this queue.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">If this queue fits in the specified array with room to spare</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * (i.e., the array has more elements than this queue), the element in</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * the array immediately following the end of the queue is set to</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * {@code null}.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Like the</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link #toArray()}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">method, this method acts as bridge between</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * array</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">based and collection</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">based APIs.  Further, this method allows</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * precise control over the runtime type of the output array, and may,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * under certain circumstances, be used to save allocation costs.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Suppose {@code x} is a queue known to contain only strings.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * The following code can be used to dump the queue into a newly</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * allocated array of {@code String}:</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;pre&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">{@code String[] y = x.toArray(new String[0]);}</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/pre&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Note that {@code toArray(new Object[0])} is identical in function to</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * {@code toArray()}.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">a the array into which the elements of the queue are to</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *          be stored, if it is big enough; otherwise, a new array of the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *          same runtime type is allocated for this purpose</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">an array containing all of the elements in this queue</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">ArrayStoreException if the runtime type of the specified array</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         is not a supertype of the runtime type of every element in</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         this queue</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">NullPointerException if the specified array is null</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(100, 100, 100); font-size: 14pt;">@SuppressWarnings</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(42, 0, 255); font-size: 14pt;">&quot;unchecked&quot;</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;T&gt; T[] toArray(T[]</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        fullyLock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">size</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.get();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">length</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">size</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= (T[])java.lang.reflect.Array.</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; font-style: italic; color: rgb(51, 51, 51);">newInstance</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                    (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.getClass().getComponentType(),</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">size</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">k</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= 0;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">for</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">[</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">k</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">++] = (T)</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">length</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">k</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">[</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">k</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">] =</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            fullyUnlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">String toString() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        fullyLock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(42, 0, 255); font-size: 14pt;">&quot;[]&quot;</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            StringBuilder</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">sb</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">StringBuilder();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">sb</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.append(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(42, 0, 255); font-size: 14pt;">'['</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">for</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(;;) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                E</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">sb</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.append(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">?</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(42, 0, 255); font-size: 14pt;">&quot;(this Collection)&quot;</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">:</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">sb</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.append(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(42, 0, 255); font-size: 14pt;">']'</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">).toString();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">sb</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.append(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(42, 0, 255); font-size: 14pt;">','</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">).append(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(42, 0, 255); font-size: 14pt;">' '</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            fullyUnlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Atomically removes all of the elements from this queue.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * The queue will be empty after this call returns.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">void</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">clear() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        fullyLock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">for</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">; (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) !=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">last</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// assert head.item == null &amp;&amp; head.next == null;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.getAndSet(0) ==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">capacity</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">notFull</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.signal();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            fullyUnlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">UnsupportedOperationException</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@inheritDoc}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">ClassCastException           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@inheritDoc}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">NullPointerException         </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@inheritDoc}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">IllegalArgumentException     </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@inheritDoc}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">drainTo(Collection&lt;?</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">super</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">drainTo(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">, Integer.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">MAX_VALUE</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">UnsupportedOperationException</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@inheritDoc}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">ClassCastException           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@inheritDoc}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">NullPointerException         </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@inheritDoc}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">IllegalArgumentException     </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@inheritDoc}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">drainTo(Collection&lt;?</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">super</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">maxElements</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">NullPointerException();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">IllegalArgumentException();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">maxElements</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;= 0)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">0;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">boolean</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">signalNotFull</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">false</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ReentrantLock</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">takeLock</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">takeLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">takeLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.lock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">n</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= Math.</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; font-style: italic; color: rgb(51, 51, 51);">min</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">maxElements</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.get());</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// count.get provides visibility to first n Nodes</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= 0;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">while</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">n</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                    Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">c</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.add(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                    ++</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">n</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// Restore invariants even if c.add() threw</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&gt; 0) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// assert h.item == null;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">signalNotFull</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.getAndAdd(-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) ==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">capacity</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">takeLock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.unlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">signalNotFull</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                signalNotFull();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Returns an iterator over the elements in this queue in proper sequence.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * The elements will be returned in order from first (head) to last (tail).</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">The returned iterator is</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * &lt;a href=&quot;package-summary.html#Weakly&quot;&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;i&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">weakly consistent</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/i&gt;&lt;/a&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">an iterator over the elements in this queue in proper sequence</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Iterator&lt;E&gt; iterator() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Itr();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">class</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Itr</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">implements</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Iterator&lt;E&gt; {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">/*</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">         * Basic weakly-consistent iterator.  At all times hold the next</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">         * item to hand out so that if hasNext() reports true, we will</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">         * still have it to return even if lost race with a take etc.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">         */</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">lastRet</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">E</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">currentElement</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        Itr() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            fullyLock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">currentElement</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                fullyUnlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">boolean</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">hasNext() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">         * Returns the next live successor of p, or null if no such.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">         *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">         * Unlike other traversal methods, iterators need to handle both:</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">         *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">dequeued nodes (p.next == p)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">         *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">(possibly multiple) interior removed nodes (p.item == null)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">         */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Node&lt;E&gt; nextNode(Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">for</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(;;) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">s</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">s</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">s</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">||</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">s</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">s</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">s</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">E next() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            fullyLock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">NoSuchElementException();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                E</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">x</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">currentElement</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">lastRet</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= nextNode(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">currentElement</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) ?</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">:</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">x</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                fullyUnlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">void</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">remove() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">lastRet</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">IllegalStateException();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            fullyLock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">node</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">lastRet</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">lastRet</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">for</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">trail</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">trail</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                    </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                    </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">trail</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">node</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                        unlink(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">trail</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">break</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                    }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                fullyUnlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/** A customized variant of Spliterators.IteratorSpliterator */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">class</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">LBQSpliterator&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">implements</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Spliterator&lt;E&gt; {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">MAX_BATCH</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= 1 &lt;&lt; 25; </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// max batch array size;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; background: #d4d4d4; color: rgb(51, 51, 51);">LinkedBlockingQueue</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">queue</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// current node; null until initialized</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">batch</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;         </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// batch size for splits</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">boolean</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">exhausted</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">; </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// true when no more nodes</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">long</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">est</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;          </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// size estimate</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        LBQSpliterator(</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; background: #d4d4d4; color: rgb(51, 51, 51);">LinkedBlockingQueue</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">queue</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">queue</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">queue</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">est</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">queue</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.size();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">long</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">estimateSize() {</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">est</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">; }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Spliterator&lt;E&gt; trySplit() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; background: #d4d4d4; color: rgb(51, 51, 51);">LinkedBlockingQueue</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">queue</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">b</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">batch</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">n</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">b</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;= 0) ? 1 : (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">b</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&gt;=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">MAX_BATCH</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) ?</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">MAX_BATCH</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">:</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">b</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">+ 1;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(!</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">exhausted</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&amp;&amp;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                ((</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) !=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">|| (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) !=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) &amp;&amp;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">h</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                Object[]</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Object[</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">n</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">];</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= 0;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.fullyLock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">|| (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) !=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">do</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">((</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">[</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">] =</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) !=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                                ++</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">while</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">((</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) !=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&amp;&amp;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">n</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                    }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.fullyUnlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">((</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) ==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">est</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= 0L;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">exhausted</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">true</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">else</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">((</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">est</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">-=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) &lt; 0L)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">est</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= 0L;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&gt; 0) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">batch</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Spliterators.</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; font-style: italic; color: rgb(51, 51, 51);">spliterator</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                        (</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">a</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">, 0,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">i</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">, Spliterator.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">ORDERED</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">| Spliterator.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">NONNULL</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">|</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                         Spliterator.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">CONCURRENT</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">void</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">forEachRemaining(Consumer&lt;?</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">super</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">action</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">action</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">NullPointerException();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; background: #d4d4d4; color: rgb(51, 51, 51);">LinkedBlockingQueue</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">queue</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(!</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">exhausted</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">exhausted</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">true</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">do</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                    E</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.fullyLock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">while</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">break</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                    }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.fullyUnlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                    }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">action</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.accept(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">while</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">boolean</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">tryAdvance(Consumer&lt;?</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">super</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">action</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">action</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">NullPointerException();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; background: #d4d4d4; color: rgb(51, 51, 51);">LinkedBlockingQueue</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">queue</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(!</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">exhausted</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                E</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.fullyLock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">while</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">break</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                    }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">q</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.fullyUnlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">current</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">exhausted</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">true</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">action</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.accept(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">e</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">true</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">false</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">characteristics() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Spliterator.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">ORDERED</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">| Spliterator.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">NONNULL</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">|</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                Spliterator.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt; font-weight: bold; font-style: italic;">CONCURRENT</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Returns a</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link Spliterator}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">over the elements in this queue.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">The returned spliterator is</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * &lt;a href=&quot;package-summary.html#Weakly&quot;&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;i&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">weakly consistent</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/i&gt;&lt;/a&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">The {@code Spliterator} reports</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link Spliterator#CONCURRENT}</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link Spliterator#ORDERED}</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">, and</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link Spliterator#NONNULL}</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@implNote</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * The {@code Spliterator} implements {@code trySplit} to permit limited</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * parallelism.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">a {@code Spliterator} over the elements in this queue</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@since</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">1.8</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Spliterator&lt;E&gt; spliterator() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">LBQSpliterator&lt;E&gt;(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Saves this queue to a stream (that is, serializes it).</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">s the stream</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">java.io.IOException if an I/O error occurs</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@serialData</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">The capacity is emitted (int), followed by all of</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * its elements (each an {@code Object}) in the proper order,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * followed by a null</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">void</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">writeObject(java.io.ObjectOutputStream</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">s</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throws</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">java.io.IOException {</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        fullyLock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// Write out any hidden stuff, plus capacity</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">s</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.defaultWriteObject();</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// Write out all elements in the proper order.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">for</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(Node&lt;E&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">next</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">s</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.writeObject(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// Use trailing null as sentinel</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">s</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.writeObject(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            fullyUnlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Reconstitutes this queue from a stream (that is, deserializes it).</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">s the stream</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">ClassNotFoundException if the class of a serialized object</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         could not be found</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">java.io.IOException if an I/O error occurs</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">void</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">readObject(java.io.ObjectInputStream</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">s</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throws</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">java.io.IOException, ClassNotFoundException {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// Read in capacity, and any hidden stuff</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">s</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.defaultReadObject();</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.set(0);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">last</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">head</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Node&lt;E&gt;(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// Read in all elements and place in queue</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">for</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(;;) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(100, 100, 100); font-size: 14pt;">@SuppressWarnings</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(42, 0, 255); font-size: 14pt;">&quot;unchecked&quot;</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            E</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">item</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= (E)</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">s</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.readObject();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">item</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">break</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            add(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">item</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div><b><font color="#1A90B9" style="font-size: 18pt;">原文</font></b></div><div><b>地址：<a href="https://www.jianshu.com/p/32d6526494fd">https://www.jianshu.com/p/32d6526494fd</a></b></div><h4>前言</h4><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">在之前的文章中，已经对</span><a href="https://www.jianshu.com/p/9a652250e0d1" style="font-weight: bold;-en-paragraph:true;">ArrayBlockingQueue</a><span style="font-weight: bold;-en-paragraph:true;">、</span><a href="https://www.jianshu.com/p/cc2281b1a6bc" style="font-weight: bold;-en-paragraph:true;">LinkedBlockingQueue</a><span style="-en-paragraph:true;">这两个比较常用的阻塞队列做了源码分析，我们知道其内部都是通过</span><span style="font-weight: bold;-en-paragraph:true;">ReentrantLock</span><span style="-en-paragraph:true;">来保证数据读写的</span><span style="font-weight: bold;-en-paragraph:true;">线程安全</span><span style="-en-paragraph:true;">，通过</span><span style="font-weight: bold;-en-paragraph:true;">Condition</span><span style="-en-paragraph:true;">来完成</span><span style="font-weight: bold;-en-paragraph:true;">线程等待和唤醒</span><span style="-en-paragraph:true;">，只不过</span><span style="font-weight: bold;-en-paragraph:true;">ArrayBlockingQueue</span><span style="-en-paragraph:true;">在读写时使用了一把锁所完成，而</span><span style="font-weight: bold;-en-paragraph:true;">LinkedBlockingQueue</span><span style="-en-paragraph:true;">对于读和写分别使用了两把锁来进行处理，从而达到</span><span style="font-weight: bold;-en-paragraph:true;">读写分离</span><span style="-en-paragraph:true;">的效果。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">然而，通过锁机制来实现一个线程安全的队列，在并发不是特别高的情况下并不是非常合适，因为在大多数情况下都只有几个线程同时访问，而每次执行都需要去加一次锁，从而导致线程进行上下文切换，影响整体性能。因此，JDK还为我们提供了一个</span><span style="font-weight: bold;-en-paragraph:true;">无锁线程安全的队列——ConcurrentLinkedQueue</span><span style="-en-paragraph:true;">，其底层使用</span><span style="font-weight: bold;-en-paragraph:true;">CAS</span><span style="-en-paragraph:true;">来实现无阻塞的并发控制。本文将该队列的实现机制和源码做一个分析，让我们共同看看Doug Lea大神是如何巧妙地通过无锁机制来实现一个线程安全的队列。</span></div><h2>1.ConcurrentLinkedQueue介绍</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">首先让我们看看JDK文档对该类的描述:</span></div><div style="max-width: 700px; max-height: 352px;"><div style="padding-bottom: 42.0%;"></div><div><img style="cursor: zoom-in;"></img></div></div><div>ConcurrentLinkedQueue的API描述.png</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">ConcurrentLinkedQueue是一个</span><span style="font-weight: bold;-en-paragraph:true;">基于链表、无界、线程安全</span><span style="-en-paragraph:true;">的队列。这个队列将元素按照</span><span style="font-weight: bold;-en-paragraph:true;">先进先出</span><span style="-en-paragraph:true;">的顺序进行存储。队列的</span><span style="font-weight: bold;-en-paragraph:true;">头节点</span><span style="-en-paragraph:true;">是在队列中存在时间最久的节点，队列的</span><span style="font-weight: bold;-en-paragraph:true;">尾节点</span><span style="-en-paragraph:true;">是在队列中存在时间最短的节点。新的元素会被插入到队列的尾部，而队列的元素的获取操作则会从队列的头部去获取元素。</span><span style="font-weight: bold;-en-paragraph:true;">ConcurrentLinekedQueue适合作为多个线程共享访问的集合</span><span style="-en-paragraph:true;">。与大多数并发集合的实现类似，该类也不允许添加null元素，该类的实现使用了一个</span><span style="font-weight: bold;-en-paragraph:true;">高效的无锁算法</span><span style="-en-paragraph:true;">，其算法的是基于</span><a href="https://link.jianshu.com/?t=https%3A%2F%2Fwww.research.ibm.com%2Fpeople%2Fm%2Fmichael%2Fpodc-1996.pdf" style="-en-paragraph:true;">podc-1996.pdf</a><span style="-en-paragraph:true;">所改进的。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">除了上面所描述的基本特性之外，ConcurrentLinkedQueue中还有一些其他的特点：</span></div><ul><li>队列中的最后一个元素的next属性总是为null，并且最后一个节点可以通过tail节点以时间复杂度为o(1)的方式到达，也可以通过head以时间复杂度o(n)的方式到达。即队列中的最后一个元素，其总是可达的。</li><li><span style="font-weight: bold;">节点出队列，是通过执行CAS操作，将其item设置为null。这里与我们传统想象的节点删除不太一样，它是通过将一个节点的item标记为null，标记这个节点已经出队列，在下次操作的时候，如果一旦发现节点的item为null时，就将该节点的next设置为自己，从而真正完成节点从队列的移除，因此节点的删除是延迟处理的。</span> (下面我们在分析节点出队列的过程时可以更加清楚地看到其实现细节)</li><li>如果队列中的节点其item不为null,它们从是可以从head开始，逐个查找到对应的节点。</li><li>ConcurrentLinkedQueue的size方法不是一个常量级别的操作，每一次获取队列的大小，都需要整体地对队列做一次遍历操作，并且得到值也是一个非精确的值，因为在遍历的过程中，队列的结构可能也会被其他线程所改变。</li></ul><h2>2. ConcurrentLinkedQueue内部结构分析</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">由于是基于链表的实现方式，与其他的并发队列类似，都会在内部定义一个节点类，ConcurrentLinedQueu亦是如此，首先我们看一下节点的定义：</span></div><div>//该节点是一个静态内部类，因此其只能作用于该队列内部</div><div>private static class Node&lt;E&gt; {</div><div>/*</div><div>* 当前节点存储的元素，注意到这里使用volatile关键字来对节点进行</div><div>* 修饰,其目的是在并发读的时候保证内存的可见性</div><div>*/</div><div>volatile E item;</div><div>//当前节点的下一个节点</div><div>volatile Node&lt;E&gt; next;</div><div><br/></div><div>/**</div><div>* 构建新的节点，这里没有使用volatile的方式来对节点的元素值进行设置，而是使用普通的写方式</div><div>* 因为对于一个新增的节点，只有在其被成功插入到队列尾部才对外可见，因此在这里没有对数据可见性的强制要求</div><div>*/</div><div>Node(E item) {</div><div>UNSAFE.putObject(this, itemOffset, item);</div><div>}</div><div>/*</div><div>* 通过Unsafe来完成对当前节点元素的CAS操作</div><div>*/</div><div>boolean casItem(E cmp, E val) {</div><div>return<a href="http://unsafe.compareandswapobject/">UNSAFE.compareAndSwapObject</a>(this, itemOffset, cmp, val);</div><div>}</div><div>/*</div><div>* 使用普通的方式来设置当前节点的下一个节点</div><div>*/</div><div>void lazySetNext(Node&lt;E&gt; val) {</div><div>UNSAFE.putOrderedObject(this, nextOffset, val);</div><div>}</div><div>/*</div><div>* 通过Unsafe来完成对当前节点的下一个节点的CAS操作</div><div>*/</div><div>boolean casNext(Node&lt;E&gt; cmp, Node&lt;E&gt; val) {</div><div>return<a href="http://unsafe.compareandswapobject/">UNSAFE.compareAndSwapObject</a>(this, nextOffset, cmp, val);</div><div>}</div><div><br/></div><div>// Unsafe mechanics</div><div>private static final sun.misc.Unsafe UNSAFE;</div><div>private static final long itemOffset;</div><div>private static final long nextOffset;</div><div><br/></div><div>static {</div><div>try {</div><div>UNSAFE = sun.misc.Unsafe.getUnsafe();</div><div>Class k = Node.class;</div><div>//通过Unsafe来获取一个Node节点的item属性在内存中相对该对象的位置偏移量</div><div>itemOffset = UNSAFE.objectFieldOffset</div><div>(k.getDeclaredField(&quot;item&quot;));</div><div><br/></div><div>//通过Unsafe来获取一个Node节点的next节点属性在内存中相对该对象的位置偏移量</div><div>nextOffset = UNSAFE.objectFieldOffset</div><div>(k.getDeclaredField(&quot;next&quot;));</div><div>} catch (Exception e) {</div><div>throw new Error(e);</div><div>}</div><div>}</div><div>}</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">上面节点的定义与之前分析的SynchronousQueue中的内部定义的节点非常类似，这里不再过多阐述。</span></div><h5>队列的属性定义</h5><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">为了提高快速查找队列中第一个节点和最后一个节点，因此ConcurrentLinkedQueue中分别定义了一个head节点和tail节点来快速定位。</span></div><div>/**</div><div>* 不变性:</div><div>* - 队列中所有未删除的节点都可以通过head节点的succ方法查找到</div><div>* - head节点一定不可能等于null</div><div>* - (tmp = head).next != tmp,即head的next不能指向自己。</div><div>*</div><div>* 可变性:</div><div>* - head的item可能为null,也可能不为null</div><div>* - tail节点可能会滞后于head节点，因此从head节点未必一定可以找到tail节点</div><div>*</div><div>*/</div><div>private transient volatile Node&lt;E&gt; head;</div><div>/**</div><div>* 不变性:</div><div>* - 节点中的最后一个元素总是可以通过tail的succ方法来获取</div><div>* - tail节点不等于null</div><div>*</div><div>* 可变性:</div><div>* - head的item可能为null,也可能不为null</div><div>* - tail 节点的next可能指向自己，也可能不指向自己</div><div>* - tail节点可能会滞后于head节点，因此从head节点未必一定可以找到tail节点</div><div>*/</div><div>private transient volatile Node&lt;E&gt; tail;</div><div><br/></div><div>public ConcurrentLinkedQueue() {</div><div>head = tail = new Node&lt;E&gt;(null);</div><div>}</div><h3>ConcurrentLinkedQueue源码分析</h3><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">通过上面的描述我们知道了该队列是通过一个头节点和一个尾节点，然后将中间链接节点之间两两相连接构成一个队列，下面让我们分析一下ConcurrentLinkedQueue的内部的具体实现。(在这里需要说明一下,由于其节点是完全地基于Unsafe来完成CAS的操作，如果你对该内容还不是很熟悉的话，可以参考我的</span><a href="https://www.jianshu.com/p/9ff426a784ad" style="-en-paragraph:true;">深入分析Java中的原子操作</a><span style="-en-paragraph:true;">这篇文章，里面对原子操作有一个比较细致的描述。</span></div><h4>入队列源码分析</h4><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">在分析源码之前，我们先通过几张图来说明一下ConcurrentLinkedQueue的入队列的整体过程。在了解完整体的过程后，再结合源码去分析细节会更加容易理解:</span></div><h6>队列初始化</h6><div style="max-width: 700px; max-height: 606px;"><div style="padding-bottom: 33.67%;"></div><div><img style="cursor: zoom-in;"></img></div></div><div>队列初始化状态</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">在队列刚创建时，head和tail同时指向空节点，我们也称其为</span><span style="-en-paragraph:true;">dummy</span><span style="-en-paragraph:true;">节点。</span></div><div style="max-width: 700px; max-height: 244px;"><div style="padding-bottom: 10.69%;"></div><div><img style="cursor: zoom-in;"></img></div></div><div>dummy节点的说明</div><h6>添加元素a</h6><div style="max-width: 700px; max-height: 630px;"><div style="padding-bottom: 35.47%;"></div><div><img style="cursor: zoom-in;"></img></div></div><div>添加元素a</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">向队列中添加元素a，此时只是新节点追加到第一个节点的后面，但是tail节点并未发生改变。</span></div><h6>添加元素b</h6><div style="max-width: 700px; max-height: 660px;"><div style="padding-bottom: 40.339999999999996%;"></div><div><img style="cursor: zoom-in;"></img></div></div><div>添加元素b</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">向队列中添加元素b，此时新节点与原先的tail节点之间的距离大于1，因此tail节点在这个时候会更新，真正的指向了最后一个节点</span></div><h6>添加元素c</h6><div style="max-width: 700px; max-height: 636px;"><div style="padding-bottom: 32.95%;"></div><div><img style="cursor: zoom-in;"></img></div></div><div>添加元素c</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">由于新节点与tail节点的距离没有大于1，因此此时tail节点同样不会发生更新。</span></div><h6>添加元素d</h6><div style="max-width: 700px; max-height: 682px;"><div style="padding-bottom: 34.55%;"></div><div><img style="cursor: zoom-in;"></img></div></div><div>添加元素d</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">通过上面的图示，我们可以看到ConcurrentLinkedQueue在入队列过程中非常明显的一个特点就是tail指针不是实时更新的，</span><span style="font-weight: bold;-en-paragraph:true;">即tail节点可能会滞后于队列中真正的最后一个节点</span><span style="-en-paragraph:true;">，只有当最后的一个节点与tail节点之前的距离大于1时才会更新，而这样设计的目的就是为了减少避免每增加一个节点，tail节点都需要去执行一次CAS操作的情况发生。</span></div><div>public boolean offer(E e) {</div><div>// 由于元素不允许为null,因此对元素做一个检查</div><div>checkNotNull(e);</div><div>// 生成待插入的节点</div><div>final Node&lt;E&gt; newNode = new Node&lt;E&gt;(e);</div><div>for (Node&lt;E&gt; t = tail, p = t;;) {</div><div>Node&lt;E&gt; q = p.next;</div><div>// 当q等于null时，则p就是队列中的最后一个元素</div><div>if (q == null) {</div><div>// 执行cas操作，如果执行成功,则newNode成为队列的最后一个元素,但它未必是tail指向的元素</div><div>if (p.casNext(null, newNode)) {</div><div>// 通过判断p!=t，从而确定当前新节点与tail指向的节点之间的距离是否大于1</div><div>// 如果大于1，则需要更新tail指针</div><div>if (p != t)</div><div>casTail(t, newNode);</div><div>return true;</div><div>}</div><div>}</div><div>// 如果p==q，则意味着当前p节点已经被从队列中移除(如果单纯从入队列看是看不出来的，后面结合出队列再回头分析)</div><div>else if (p == q)</div><div>/* 判断在执行过程中tail是否发生变化,如果未发生变化,则tail也已经脱落队列</div><div>* 因为 p = t = tail,而p已经脱离队列，从而推断出tail也脱离了队列</div><div>* 那么此时只能从head开始，重新查找队列的最后一个元素</div><div>* 如果tail发生了变化，则直接从当前队列的tail开始查找队列的最后一个元素</div><div>*/</div><div>p = (t != (t = tail)) ? t : head;</div><div>else</div><div>/**</div><div>* 由于p节点的next不为null，并且p节点并未从队列中删除，因此需要继续查找队列的最后一个节点</div><div>* 判断执行过程中tail节点是否发生了变化</div><div>* 如果发生了变化,则让p执行当前的tail，否则就让p直接指向它的next节点q</div><div>*/</div><div>p = (p != t &amp;&amp; t != (t = tail)) ? t : q;</div><div>}</div><div>}</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">可能会有不少朋友对上面</span><span style="-en-paragraph:true;">t != (t = tail)</span><span style="-en-paragraph:true;">的处理感到疑惑，疑惑的原因可能会觉得一个变量自己和自己比较，那不是一定为true嘛，怎么还会出现等于false的可能呢。为了理解这个问题，我们一起看一下下面的这段代码:</span></div><div>public class VarCompareTest {</div><div>static volatile int b = 2;</div><div><br/></div><div>public static void main(String[] args) {</div><div>int a = b;</div><div>int c = a != (a = b) ? 5 : 4;</div><div>System.out.println(a);</div><div>System.out.println(c);</div><div>}</div><div>}</div><div>这段代码的也用到了上面类似的t != (t = tail)，但是在编译完成后，我们通过IDEA本身的反编译工具来查看一下对应的Class文件的结果(目前由于对字节码指令不熟悉，因此不从那个角度去解读)：</div><div style="max-width: 700px; max-height: 361px;"><div style="padding-bottom: 51.580000000000005%;"></div><div><img style="cursor: zoom-in;"></img></div></div><div>反编译Class文件后的结果</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">通过上面的代码，我们可以看到，一开始a的值就等于b的值，其值为2；紧接着a的值首先通过一个局部变量记录，然后再将b的值赋值给a，由于b可能存在多线程修改的可能，此时b的值可能被其他线程改成了3，因此a的值也会变为3，最后再拿2与3进行比较，即</span><span style="-en-paragraph:true;">var10000 != b</span><span style="-en-paragraph:true;">进行比较，就会存在等于false的情况发生了。对于</span><span style="-en-paragraph:true;">t != (t = tail)</span><span style="-en-paragraph:true;">的情况也是如此，相信通过这个例子说明大家应该明白其中的原理了！</span></div><h4>出队列源码分析</h4><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">在分析出队列源码之前，我们也结合上面的图来看一下出队列的整体过程：</span></div><div style="max-width: 700px; max-height: 682px;"><div style="padding-bottom: 34.55%;"></div><div><img style="cursor: zoom-in;"></img></div></div><div>队列当前状态</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">这里假设队列是基于上面入队列之后的状态进行的。</span></div><h6>移除第1个节点</h6><div style="max-width: 700px; max-height: 604px;"><div style="padding-bottom: 29.15%;"></div><div><img style="cursor: zoom-in;"></img></div></div><div>移除第一个节点</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">原本指向head的节点，此时的next指向了自己，因此它从队列中真正的移除。存储a的节点，其item置为了null，并且head节点发生变更，真正指向了队列中第一个</span><span style="font-weight: bold;-en-paragraph:true;">有效(真正存储数据)</span><span style="-en-paragraph:true;">的节点。</span></div><h6>移除第2个节点</h6><div style="max-width: 700px; max-height: 604px;"><div style="padding-bottom: 28.52%;"></div><div><img style="cursor: zoom-in;"></img></div></div><div>移除第2个节点</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">此时只是仅仅将节点的item设置为了null，但是head节点没有发生变更，这样做的目的也是为了减少一次CAS操作，它会等到下一次才去变更。</span></div><h6>移除第3个节点</h6><div style="max-width: 700px; max-height: 644px;"><div style="padding-bottom: 30.81%;"></div><div><img style="cursor: zoom-in;"></img></div></div><div>移除第3个节点</div><h5>移除第4个节点</h5><div style="max-width: 700px; max-height: 604px;"><div style="padding-bottom: 25.97%;"></div><div><img style="cursor: zoom-in;"></img></div></div><div>移除第4个节点</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">看完上图的分析，相信大家对ConcurrentLinkedQueue出队列的操作应该有一个直观的理解了，下面我们看下源码的具体实现：</span></div><div>public E poll() {</div><div>restartFromHead:</div><div>for (;;) {</div><div>for (Node&lt;E&gt; h = head, p = h, q;;) {</div><div>E item = p.item;</div><div>// 如果元素的item不为null，则说明p节点是当前队列中的第一个未被删除的节点</div><div>// 此时也说明head指向的节点确实是队列中的第一个元素</div><div>// 通过CAS操作，将item设置为null,来标记其已经被删除</div><div>if (item != null &amp;&amp; p.casItem(item, null)) {</div><div>// 判断p节点与head指向的节点是否是同一个,如果不是则需要将head节点向前移动</div><div>if (p != h)</div><div>updateHead(h, ((q = p.next) != null) ? q : p);</div><div>return item;</div><div>}</div><div>// 节点的next为null,则说明队列为空，只有一个dummy节点</div><div>else if ((q = p.next) == null) {</div><div>// 尝试将dummy节点p设置为新的head</div><div>updateHead(h, p);</div><div>return null;</div><div>}</div><div>// 如果p节点被删除,只能从队列的head从头开始再次查找</div><div>else if (p == q)</div><div>// 跳回到最外层的循环，重新执行一次Node&lt;E&gt; h = head, p = h, q；操作</div><div>continue restartFromHead;</div><div>else</div><div>// 由于head指向的节点其item为null,即head指向的节点不是一个有效节点，因此继续通过head的next继续查找</div><div>p = q;</div><div>}</div><div>}</div><div>}</div><div><br/></div><div>final void updateHead(Node&lt;E&gt; h, Node&lt;E&gt; p) {</div><div>// 判断新设置的节点与原来的head节点是否是同一个,如果不是则将新节点设置为新的head节点，</div><div>// 并且将原来的head节点的next指向自己。</div><div>if (h != p &amp;&amp; casHead(h, p))</div><div>h.lazySetNext(h);</div><div>}</div><h4>tail节点滞后于head节点的场景分析</h4><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">一般来说，head节点都在队列的左边，而tail节点在队列的右边。然而，在ConcurrentLinkedQueue中，可能存在tail节点在左边，而head节点却跑到了右边的情况，这种场景我们将其称为</span><span style="font-weight: bold;-en-paragraph:true;">tail lag behind head</span><span style="-en-paragraph:true;">。下面我们分析一下在什么样的场景下会发生这样的情况，这对于真正理解ConcurrentLinkedQueue非常重要！</span></div><div style="max-width: 700px; max-height: 327px;"><div style="padding-bottom: 46.839999999999996%;"></div><div><img style="cursor: zoom-in;"></img></div></div><div>添加一个元素</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">从上图可以看到，在添加完一个元素后，tail节点并有发生改变。此时，假设我们去获取队列中的元素，队列的结构就变成如下的样子。</span></div><div style="max-width: 700px; max-height: 676px;"><div style="padding-bottom: 33.47%;"></div><div><img style="cursor: zoom-in;"></img></div></div><div>取出队列元素</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">从上面的结构我们可以看到，此时tail节点滞后于head节点，并且我们此时通过head节点也无法查找到tail节点，因为该节点已经从队列中移除。当下一次添加元素的时候，就会出现tail节点自己指向自己的情况，此时就需要重新获取到head，将新增的元素追加到head后面。</span></div><h3>总结</h3><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">至此，ConcurrentLinkedQueue的实现我们已经分析完成了。该类的核心设计就在于CAS的无阻塞以及head/tail节点的延迟更新。尽量我们在实际的开发中基本不会去实现一个如此复杂的队列，但是通过分析一个经典无阻塞队列，可以更加好地帮助我们理解并发编程。</span><span style="font-weight: bold;-en-paragraph:true;">如果存在分析不对的地方，还望大神指出。</span></div><div><br/></div><div><br/></div><div>作者：码农一枚</div><div>链接：<a href="https://www.jianshu.com/p/32d6526494fd">https://www.jianshu.com/p/32d6526494fd</a></div><div>來源：简书</div><div>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</div></div></span>
</div></body></html> 