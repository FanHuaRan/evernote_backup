<html>
<head>
  <title>PhantomReference &amp; Cleaner总结</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="903"/>
<h1>PhantomReference &amp; Cleaner总结</h1>

<div>
<span><div><div><font style="font-size: 18pt;"><span style="color: rgb(26, 144, 185); font-size: 18pt; font-weight: bold;">个人理解</span></font></div><div><span style="font-size: 12pt;">PhantomReference是Reference的一个子类，Cleaner是PhantomReference的一个子类。</span></div><div><span style="font-size: 12pt;">我们都知道虚引用不参与对象的引用分析当中，无法阻止对象的垃圾回收，即一个对象的所有强引用都已经没有了，只剩虚引用，那么这个对象还是会被垃圾回收。</span></div><div><span style="font-size: 12pt;">Cleaner继承自PhantomReference，它本质上仍然是一个Reference。所以它的处理逻辑与WeakReference，SoftReference十分相似，仍然是由GC标记，然后由Reference Handler线程来处理。</span></div><div><span style="font-size: 12pt;">Cleaner本身不带有清理逻辑，所有的逻辑都封装在thunk（Runnable字段对象）中，因此thunk是怎么实现的才是最关键的，Reference Handler线程会自动调用Cleaner的clean方法（看上面）。</span></div><div><span style="font-size: 16px;">总结来说：Cleaner是一个Reference子类，其自身可以携带一个Runnable对象来在被ReferenceHandler线程处理时进行回调，从而可以实现一些资源释放的操作。</span></div><div><span style="font-weight: bold; color: rgb(26, 144, 185); font-size: 18pt;">原文</span></div><div>地址：<a href="https://zhuanlan.zhihu.com/p/29454205">https://zhuanlan.zhihu.com/p/29454205</a></div><div style="margin: 0px 0px 20px; font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">在讲DirectBuffer的时候，圈里有同学问我，关于DirectBuffer如何回收的问题。我当时回答说别急，等我讲完GC再来讲这个问题。课程进行到现在，终于可以讲一下了。</span></div><div style="margin: 0px 0px 20px; font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">其实，在讲DirectBuffer的时候，就已经贴过这一段代码了，但是当时没有做为重点去讲解。今天我们再返回来看一下DirectByteBuffer的构造函数：</span></div><div style="-webkit-box-orient: vertical; -webkit-box-direction: normal; flex-direction: column; -webkit-box-align: stretch; align-items: stretch; flex-shrink: 0; font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="margin: 1em 0px; padding: 10px; overflow: auto; font-size: 14px; word-wrap: normal; background: rgb(246, 246, 246); border-radius: 4px;"><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">DirectByteBuffer</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">(</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(23, 81, 153); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">int</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">cap</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">)</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">{</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(153, 153, 153); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-style: italic;">// package-private</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">super</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">(-</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(0, 132, 255); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">1</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">,</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(0, 132, 255); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">0</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">,</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">cap</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">,</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">cap</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">);</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(23, 81, 153); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">boolean</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">pa</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">=</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">VM</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">.</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(0, 132, 255); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">isDirectMemoryPageAligned</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">();</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(23, 81, 153); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">int</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">ps</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">=</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">Bits</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">.</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(0, 132, 255); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">pageSize</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">();</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(23, 81, 153); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">long</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">size</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">=</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">Math</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">.</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(0, 132, 255); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">max</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">(</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(0, 132, 255); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">1L</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">,</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">(</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(23, 81, 153); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">long</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">)</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">cap</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">+</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">(</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">pa</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">?</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">ps</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">:</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(0, 132, 255); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">0</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">));</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">Bits</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">.</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(0, 132, 255); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">reserveMemory</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">(</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">size</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">,</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">cap</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">);</span></div><div><br/></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(23, 81, 153); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">long</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">base</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">=</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(0, 132, 255); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">0</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">try</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">{</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">base</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">=</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">unsafe</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">.</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(0, 132, 255); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">allocateMemory</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">(</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">size</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">);</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">}</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">catch</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">(</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">OutOfMemoryError</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">x</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">)</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">{</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">Bits</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">.</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(0, 132, 255); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">unreserveMemory</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">(</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">size</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">,</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">cap</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">);</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">throw</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">x</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">}</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">unsafe</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">.</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(0, 132, 255); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">setMemory</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">(</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">base</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">,</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">size</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">,</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">(</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(23, 81, 153); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">byte</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">)</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(0, 132, 255); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">0</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">);</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">if</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">(</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">pa</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">&amp;&amp;</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">(</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">base</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">%</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">ps</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">!=</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(0, 132, 255); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">0</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">))</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">{</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(153, 153, 153); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-style: italic;">// Round up to page boundary</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">address</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">=</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">base</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">+</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">ps</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">-</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">(</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">base</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">&amp;</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">(</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">ps</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">-</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(0, 132, 255); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">1</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">));</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">}</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">else</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">{</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">address</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">=</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">base</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">}</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(153, 153, 153); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-style: italic;">// 这个cleaner就是DirectBuffer回收的最关键部分。</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">cleaner</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">=</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">Cleaner</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">.</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(0, 132, 255); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">create</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">(</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">this</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">,</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">new</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">Deallocator</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">(</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">base</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">,</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">size</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">,</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">cap</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">));</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">att</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">=</span> <span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">null</span><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">}</span></div></div></div><div style="margin: 0px 0px 20px; font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">前边的部分大家再复习一下，今天的重点是倒数第三行的那个cleaner到底是什么鬼。我们点开Cleaner的定义看一下：</span></div><div style="-webkit-box-orient: vertical; -webkit-box-direction: normal; flex-direction: column; -webkit-box-align: stretch; align-items: stretch; flex-shrink: 0; font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="margin: 1em 0px; padding: 10px; overflow: auto; font-size: 14px; word-wrap: normal; background: rgb(246, 246, 246); border-radius: 4px;"><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">public class Cleaner</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">extends PhantomReference&lt;Object&gt;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">{</span></div><div><br/></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">// Dummy reference queue, needed because the PhantomReference constructor</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">// insists that we pass a queue. Nothing will ever be placed on this queue</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">// since the reference handler invokes cleaners explicitly.</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">// 就像英文注释所说的，这货没啥卵用。后面我会讲到的。</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">private static final ReferenceQueue&lt;Object&gt; dummyQueue = new ReferenceQueue&lt;&gt;();</span></div><div><br/></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">// Doubly-linked list of live cleaners, which prevents the cleaners</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">// themselves from being GC'd before their referents</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">// 所有的cleaner都会被加到一个双向链表中去，这样做是为了保证在referent被回收之前</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">// 这些Cleaner都是存活的。</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">static private Cleaner first = null;</span></div><div><br/></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">private Cleaner</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">next = null,</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">prev = null;</span></div><div><br/></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">// 构造的时候把自己加到双向链表中去</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">private static synchronized Cleaner add(Cleaner cl) {</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">if (first != null) {</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">cl.next = first;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">first.prev = cl;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">}</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">first = cl;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">return cl;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">}</span></div><div><br/></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">// clean方法会调用remove把当前的cleaner从链表中删除。</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">private static synchronized boolean remove(Cleaner cl) {</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">// If already removed, do nothing</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">if (cl.next == cl)</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">return false;</span></div><div><br/></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">// Update list</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">if (first == cl) {</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">if (cl.next != null)</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">first = cl.next;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">else</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">first = cl.prev;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">}</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">if (cl.next != null)</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">cl.next.prev = cl.prev;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">if (cl.prev != null)</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">cl.prev.next = cl.next;</span></div><div><br/></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">// Indicate removal by pointing the cleaner to itself</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">cl.next = cl;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">cl.prev = cl;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">return true;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">}</span></div><div><br/></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">// 用户自定义的一个Runnable对象，</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">private final Runnable thunk;</span></div><div><br/></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">// 私有有构造函数，保证了用户无法单独地使用new来创建Cleaner。</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">private Cleaner(Object referent, Runnable thunk) {</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">super(referent, dummyQueue);</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">this.thunk = thunk;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">}</span></div><div><br/></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">/**</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">* 所有的Cleaner都必须通过create方法进行创建。</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">*/</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">public static Cleaner create(Object ob, Runnable thunk) {</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">if (thunk == null)</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">return null;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">return add(new Cleaner(ob, thunk));</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">}</span></div><div><br/></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">/**</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">* 这个方法会被Reference Handler线程调用，来清理资源。</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">*/</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">public void clean() {</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">if (!remove(this))</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">return;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">try {</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">thunk.run();</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">} catch (final Throwable x) {</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() {</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">public Void run() {</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">if (System.err != null)</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">new Error(&quot;Cleaner terminated abnormally&quot;, x)</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">.printStackTrace();</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">System.exit(1);</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">return null;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">}});</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">}</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">}</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">}</span></div></div></div><div style="margin: 0px 0px 20px; font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">这段代码的关键注释我已经加上了。然后我再把要注意的点单独强调一下。</span></div><ol style="margin: 20px 0px; padding: 0px 0px 0px 40px; font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="box-sizing: inherit; list-style-type: decimal; margin-top: 10px; list-style-position: outside;"><span style="color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: medium; font-variant-caps: normal; font-variant-ligatures: normal;">Cleaner继承自PhantomReference，它本质上仍然是一个Reference。所以它的处理方法与WeakReference，SoftReference十分相似。仍然是由GC标记，Reference Handler线程处理的。</span></li><li style="box-sizing: inherit; list-style-type: decimal; margin-top: 10px; list-style-position: outside;"><span style="color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: medium; font-variant-caps: normal; font-variant-ligatures: normal;">Cleaner本身不带有清理逻辑，所有的逻辑都封装在thunk中，因此thunk是怎么实现的才是最关键的。</span></li><li style="box-sizing: inherit; list-style-type: decimal; margin-top: 10px; list-style-position: outside;"><span style="color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: medium; font-variant-caps: normal; font-variant-ligatures: normal;">Cleaner中的next和prev是private的，一定要记住这一点，不要和Reference的成员变量next 混淆了。它们不是一回事。这个next, prev是双向链表，而Reference的next则是由JVM维护的。</span></li></ol><div style="margin: 0px 0px 20px; font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">OK，关于Reference Handler的代码，请看这篇文章：</span><a href="https://zhuanlan.zhihu.com/p/28226360" style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); border-bottom: 1px solid rgba(68, 68, 68, 0.72); word-break: break-all; cursor: pointer; font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(34, 85, 153);">WeakReference</a></div><div style="margin: 0px 0px 20px; font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">注意看啊，Reference的定义里新启的那个线程，它的run方法会专门判断从pending链表上取出来的那个对象是不是Cleaner，如果是就会调用它的clean方法。所以我们知道了，</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">Cleaner的clean方法是由Reference Handler线程调用的</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">。</span></div><div style="margin: 0px 0px 20px; font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">好，到此为止，我们再回顾一下整个全景图：</span></div><div style="margin: 0px 0px 20px; font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">首先，DirectBuffer buf 如果已经没有强引用了，那么JVM就会发现只有一个Cleaner还在引用着这个buf，那么就会把与此buf相关的那个cleaner放到一个名为pending的链表里。这个链表是通过Reference.discovered域连接在一起的。</span></div><div style="margin: 0px 0px 20px; font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">接着，Reference Handler这个线程会不断地从这个pending链表上取出新的对象来。它可能是WeakReference，也可能是SoftReference，当然也可能是PhantomReference和Cleaner。</span></div><div style="margin: 0px 0px 20px; font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">最后，如果是Cleaner，那就直接调用Cleaner的clean方法，然后就结束了。其他的情况下，要交给这个对象所关联的queue，以便于后续的处理。</span></div><div style="margin: 0px 0px 20px; font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">关于Cleaner和PhantomReference就讲这么多了，下节课讲finalize，还会再补充一点cleaner和Finalizer的对比。如果有同学还想了解更多，就评论或者私信问我都行。当然，关于DirectBuffer，还有一点要补充，那就是Cleaner的第二个构造参数是一个Runnable类型的thunk：</span></div><div style="-webkit-box-orient: vertical; -webkit-box-direction: normal; flex-direction: column; -webkit-box-align: stretch; align-items: stretch; flex-shrink: 0; font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="margin: 1em 0px; padding: 10px; overflow: auto; font-size: 14px; word-wrap: normal; background: rgb(246, 246, 246); border-radius: 4px;"><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">private static class Deallocator</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">implements Runnable</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">{</span></div><div><br/></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">private static Unsafe unsafe = Unsafe.getUnsafe();</span></div><div><br/></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">private long address;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">private long size;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">private int capacity;</span></div><div><br/></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">private Deallocator(long address, long size, int capacity) {</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">assert (address != 0);</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">this.address = address;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">this.size = size;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">this.capacity = capacity;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">}</span></div><div><br/></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">public void run() {</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">if (address == 0) {</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">// Paranoia</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">return;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">}</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">unsafe.freeMemory(address);</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">address = 0;</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">Bits.unreserveMemory(size, capacity);</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">}</span></div><div><span style="border-radius: 3px; background-color: rgb(246, 246, 246); color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;lucida console&quot;, &quot;Courier New&quot;, monospace; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;">}</span></div></div></div><div style="margin: 0px 0px 20px; font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">嗯。在它的run方法里，真正地调用了freeMemory来释放内存。</span></div><div style="margin: 0px 0px 20px; font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">DirectBuffer释放的全部差不多就都在这里了。当然，说了这么多，其实DirectBuffer的释放时机还是不确定的。首先，得发生GC，其次，Reference Handler得调度到，然后处理到你的cleaner才行，还有一条，如果你自己要实现一个cleaner，千万千万不要在run方法里写一些执行时间很长，或者会阻塞线程的逻辑的。会把Reference Handler跑死的。</span></div><div style="margin: 0px 0px 20px; font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">上一节课：</span><a href="https://zhuanlan.zhihu.com/p/29415902" style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); border-bottom: 1px solid rgba(68, 68, 68, 0.72); word-break: break-all; cursor: pointer; font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(34, 85, 153);">WeakReference vs. SoftReference</a></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">下一节课：</span><a href="https://zhuanlan.zhihu.com/p/29522201" style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border-bottom: 1px solid rgba(68, 68, 68, 0.72); word-break: break-all; cursor: pointer; color: rgb(34, 85, 153); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">finalize方法</a></div><div><br/></div></div></span>
</div></body></html> 