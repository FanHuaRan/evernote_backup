<html>
<head>
  <title>jni基础入门</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="703"/>
<h1>jni基础入门</h1>

<div>
<span><div><div><span style="font-size: 18pt; color: rgb(26, 144, 185); font-weight: bold;">一.从java程序中调用C函数</span></div><div><span style="font-weight: bold;">   </span> <span style="font-size: 12pt;">java使用native关键字来修身一个本地方法</span></div><div><span style="font-size: 12pt;">    开发流程如下：</span></div><div><span style="font-size: 12pt;">    1.在java代码中声明一个本地方法（native关键字）</span></div><div><span style="font-size: 12pt;">    2.运行javah以获得包含该方法的C声明的头文件（使用javah工具 用法：javah 相对路径的类名）</span></div><div><span style="font-size: 12pt;">    3.用C实现该本地方法</span></div><div><span style="font-size: 12pt;">    4.将代码置于共享库中 （打包一个库，windows平台是dll，linux是so）</span></div><div><span style="font-size: 12pt;">    5.在java程序中加载该共享库（可将共享库放置在操作系统库、jre库、项目路径或者使用-Djava.library.path=共享库路径 </span></div><div><span style="font-size: 12pt;">                                                  在静态代码块中使用System.loadlibrary(共享库名称)来加载）</span></div><div><span style="font-size: 12pt; font-weight: bold;">    jni的开发和调用流程图解</span></div><div><img src="jni基础入门_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>  <font style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">java本地方法和C方法的命名原则</span></font></div><div>  <img src="jni基础入门_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>  </div><div>  <font style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">C++编译器注意事项</span></font></div><div>  <span style="font-size: 12pt;">可以使用不使用C++来实现本地方法，但是必须将本地方法的声明使用如下形式：</span></div><div><span style="font-size: 12pt;">   extern &quot;C”{方法声明}</span></div><div><span style="font-size: 12pt;">   只有这样才能阻止C++编译器生成C++特有的代码</span></div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;"> 在共享库初始化和虚拟机关闭时执行代码</span></div><div>  <span style="font-size: 12pt;">   实现如下两个函数：</span></div><div><span style="font-size: 12pt;">     </span><span style="min-height: 11pt; font-size: 12pt; color: rgb(0, 128, 0); font-family: NSimSun;">//当共享库被加载时调用</span></div><div style="min-height: 11pt;"><span style="min-height: 11pt; font-size: 12pt; color: rgb(111, 0, 138); font-family: NSimSun;">  JNIEXPORT</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jint</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(111, 0, 138); font-family: NSimSun;">JNICALL</span> <span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">JNI_OnLoad(</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">JavaVM</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">*</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">vm</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">,</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 255); font-family: NSimSun;">void</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">*</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">reserved</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">);</span></div><div style="min-height: 11pt;"></div><div style="min-height: 11pt;"><span style="min-height: 11pt;"><span style="font-size: 12pt; color: rgb(0, 128, 0); font-family: NSimSun;">  //当虚拟机关闭时调用</span></span></div><div style="min-height: 11pt;"><span style="min-height: 11pt; font-size: 12pt; color: rgb(111, 0, 138); font-family: NSimSun;">  JNIEXPORT</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jint</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(111, 0, 138); font-family: NSimSun;">JNICALL</span> <span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">JNI_OnLoad(</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">JavaVM</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">*</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">vm</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">,</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 255); font-family: NSimSun;">void</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">*</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">reserved</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">);</span></div><div style="min-height: 11pt;"><div><br/></div></div><div style="min-height: 11pt;"><span style="min-height: 11pt;"><font style="font-size: 12pt;"><span style="font-size: 12pt; font-family: NSimSun;">  </span><span style="min-height: 11pt;"><span style="font-size: 12pt; font-family: NSimSun;">JNI_OnLoad需要返回它所支持的最低的jni版本。eg:</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(111, 0, 138); font-family: NSimSun;">JNI_VERSION_1_6</span></span></font></span></div><div><br/></div><div><br/></div><div><font color="#1A90B9" style="font-size: 18pt;"><span style="font-size: 18pt; color: rgb(26, 144, 185); font-weight: bold;">二.数值参数和数值返回值</span></font></div><div>  <span style="font-size: 12pt;">  C和java之间函数交互，数字类型必须要有正确的对应关系，因为java平台独立性，其每个数据类型所占字节都是一定的，但C编译器并没有规定数字类型的位数，因此jvm使用</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 255); font-family: NSimSun;">typedef</span><span style="font-size: 12pt;">定义了和java交互的数字类型（jint,jdouble等），对应关系如下：</span></div><div>    <img src="jni基础入门_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><font style="font-size: 18pt;"><span style="font-size: 18pt; color: rgb(26, 144, 185); font-weight: bold;">三.字符串参数</span></font></div><div>    <span style="font-size: 12pt;">  java中的字符串是UTF-16编码的字符序列</span></div><div><span style="font-size: 12pt;">      C的字符串是以NULL结尾的字节序列</span></div><div><span style="font-size: 12pt;">      故两种语言中的字符串很不一样，互相转换需要使用一些转换操作，因为java中的字符串是不可变的，所以要和java交互的字符数组或者指针都必须是const类型</span></div><div><span style="font-size: 12pt;">      jni接口当中，有两种操作字符串的函数：</span></div><div><span style="font-size: 12pt;">      1.把java字符串=&gt;UTF-8字节序列，实际上就是转换成byte数组，适合使用ASCII的C代码</span></div><div><span style="font-size: 12pt;">      2.java字符串与=&gt; UTF-16数值的数组，实际上就是转换成jchar数组，适合使用Unicode的C代码</span></div><div>     <img src="jni基础入门_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div><div>      <img src="jni基础入门_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><span style="font-size: 24px;"><span style="font-size: 24px; color: rgb(26, 144, 185); font-weight: bold;">四.获取class</span></span></div><div><span style="font-size: 12pt; font-weight: bold;"> </span> <span style="font-size: 12pt;"> 通过类名获取class</span></div><div><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;"> </span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jclass</span> <span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">FindClass(</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 255); font-family: NSimSun;">const</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 255); font-family: NSimSun;">char</span> <span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">*</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">name</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">);</span></div><div><span style="font-size: 12pt; font-family: NSimSun;"> 通过jobject获取class</span></div><div><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;"> </span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jclass</span> <span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">GetObjectClass(</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jobject</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">obj</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">);</span></div><div><span style="font-size: 12pt;">    注意：</span></div><div><span style="font-size: 12pt;">   类引用只在本地方法返回前有效。因此不能在代码中缓存GetObjectClass和FindClass的返回值。不要将类引用保存下来供以后的方法调用时使用，尽量在每次方法调用时重新获取class。如果实在要做可以使用如下方法来长久的锁定该class的引用：</span></div><div><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;"> jobject</span> <span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">NewGlobalRef(</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jobject</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">lobj</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">) //锁定对象引用，对java对象加一个全局的强引用</span></div><div><span style="min-height: 11pt;"><span style="font-size: 12pt; font-family: NSimSun;"> 但是一定要记得使用如下方法释放class的引用</span></span></div><div><span style="min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 255); font-family: NSimSun;">  void</span> <span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">DeleteGlobalRef(</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jobject</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">gref</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">) //释放对象引用，类似于置NULL</span></div><div><br/></div><div><font color="#1A90B9" style="font-size: 18pt;"><span style="font-size: 18pt; color: rgb(26, 144, 185); font-weight: bold;">五.字段和方法签名编码</span></font></div><div>    <span style="font-size: 12pt;"> 先看看数据类型签名：</span></div><div>     </div><table border="1" style="margin: 0px; padding: 0px; border-collapse: collapse; border-spacing: 0px; border: 1px solid silver; word-break: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 247, 239);"><colgroup><col></col><col></col></colgroup><tbody style="margin: 0px; padding: 0px;"><tr style="margin: 0px; padding: 0px;"><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="92"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">Java 类型</span></div></td><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="476"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">符号</span></div></td></tr><tr style="margin: 0px; padding: 0px;"><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="92"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">Boolean</span></div></td><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="476"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">Z</span></div></td></tr><tr style="margin: 0px; padding: 0px;"><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="92"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">Byte</span></div></td><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="476"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">B</span></div></td></tr><tr style="margin: 0px; padding: 0px;"><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="92"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">Char</span></div></td><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="476"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">C</span></div></td></tr><tr style="margin: 0px; padding: 0px;"><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="92"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">Short</span></div></td><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="476"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">S</span></div></td></tr><tr style="margin: 0px; padding: 0px;"><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="92"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">Int</span></div></td><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="476"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">I</span></div></td></tr><tr style="margin: 0px; padding: 0px;"><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="92"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">Long</span></div></td><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="476"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">J</span></div></td></tr><tr style="margin: 0px; padding: 0px;"><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="92"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">Float</span></div></td><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="476"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">F</span></div></td></tr><tr style="margin: 0px; padding: 0px;"><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="92"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">Double</span></div></td><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="476"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">D</span></div></td></tr><tr style="margin: 0px; padding: 0px;"><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="92"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">Void</span></div></td><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="476"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">V</span></div></td></tr><tr style="margin: 0px; padding: 0px;"><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="92"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px; font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">objects对象</span></div></td><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;" valign="top" width="476"><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px;"><span style="font-size: 14px; color: rgb(227, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">以&quot;L&quot;开头，以&quot;;&quot;结尾，中间是用&quot;/&quot; 隔开的包及类名。</span></span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">比如：Ljava/lang/String;</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">如果是嵌套类，则用$来表示嵌套。例如</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"> &quot;(Ljava/lang/String;Landroid/os/FileUtils$FileStatus;)Z&quot;</span></div></td></tr><tr><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;"><div><span style="font-size: 14px; color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">数组类型</span></div></td><td style="margin: 0px; padding: 3px; border: 1px solid silver; border-collapse: collapse;"><div><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 247, 239); color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">用&quot;[&quot;加上对应类型的简写形式进行表示。例如：</span></div><div><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 247, 239); color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">[I 表示 int [];</span></div><div><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 247, 239); color: rgb(57, 57, 57); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">[L/java/lang/objects;表示Objects[],</span></div><div><font style="font-size: 11pt;"><span style="font-size: 11pt; color: rgb(227, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">引用类型（除基本类型的数组外）的标示最后都有个&quot;;&quot;</span></font></div></td></tr></tbody></table><div>  </div><div><span style="font-size: 12pt;">字段的签名就是数据类型的签名</span></div><div><span style="font-size: 12pt;">     </span></div><div><span style="font-size: 12pt;">方法的签名是</span><span style="font-size: 12pt; font-family: Verdana;">括号里放置参数，在括号后面放置返回类型，当一个函数不需要返回参数类型时，就使用&quot;V&quot;来表示。</span></div><div><span style="font-size: 12pt; font-family: Verdana;">比如:</span></div><div><span style="font-size: 12pt; font-family: Verdana;">&quot;()Ljava/lang/String;&quot;就是表示String f();</span></div><div><span style="font-size: 12pt; font-family: Verdana;">&quot;(ILjava/lang/Class;)J&quot;就是表示long f(int i, Class c);</span></div><div><span style="font-size: 12pt; font-family: Verdana;">&quot;([B)V&quot;就是表示void String(byte[] bytes);</span></div><div><span style="font-size: 12pt; font-family: Verdana;">&quot;()V&quot; 就表示void Func();</span></div><div><span style="font-size: 12pt; font-family: Verdana;">&quot;(II)V&quot; 表示 void Func(int, int);</span></div><div><span style="font-size: 12pt; font-family: Verdana;">&quot;(Ljava/lang/String;Ljava/lang/String;)I&quot;.表示 int Func(String,String)</span></div><div><br/></div><div><span style="font-size: 18pt; color: rgb(26, 144, 185); font-weight: bold;">六.访问和设置字段</span></div><div><br/></div><div><span style="font-size: 12pt;">获取fieldId</span></div><div><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;"> </span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jfieldID</span> <span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">GetFieldID(</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jclass</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">clazz</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">,</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 255); font-family: NSimSun;">const</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 255); font-family: NSimSun;">char</span> <span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">*</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">name</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">,</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 255); font-family: NSimSun;">const</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 255); font-family: NSimSun;">char</span> <span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">*</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">sig</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">) //字段签名看第五节</span></div><div><span style="font-size: 12pt;">根据fieldid和class获取静态字段值</span></div><div><span style="font-size: 12pt;">   j数据类型 GetStaticXXXField(</span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;">jclass</span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 0); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;">clazz</span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 0); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 0); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;">jfieldID</span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 0); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;">fieldID)</span></div><div><span style="min-height: 11pt;"><span style="font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;"> eg：</span></span></div><div><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;"> jbyte</span> <span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">GetStaticByteField(</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jclass</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">clazz</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">,</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jfieldID</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">fieldID</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">)</span></div><div><span style="font-size: 12pt;">根据fieldid和object获取对象字段值</span></div><div><span style="font-size: 12pt;">   j数据类型 GetXXXField(</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jobject</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">obj</span> <span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 0); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 0); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;">jfieldID</span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 0); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;">fieldID)</span></div><div><span style="min-height: 11pt;"><span style="font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;"> eg：</span></span></div><div><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;"> jbyte</span> <span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">GetByteField(</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jobject</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">obj</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">,</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jfieldID</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">fieldID</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">)</span></div><div><span style="font-size: 12pt;">根据fieldid和class设置静态字段值</span></div><div><span style="font-size: 12pt;">   j数据类型 SetStaticXXXField(</span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;">jclass</span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 0); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;">clazz</span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 0); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 0); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;">jfieldID</span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 0); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;">fieldID)</span></div><div><span style="min-height: 11pt;"><span style="font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;"> eg：</span></span></div><div><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;"> void s</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">etStaticByteField(</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jclass</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">clazz</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">,</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jfieldID</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">fieldID,</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jbyte</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">val</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">)</span></div><div><span style="font-size: 12pt;">根据fieldid和object设置对象字段值</span></div><div><span style="font-size: 12pt;">   void SetXXXField(</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jobject</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">obj</span> <span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 0); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 0); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;">jfieldID</span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 0); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun; font-variant-caps: normal; font-variant-ligatures: normal;">fieldID,J数据类型 value)</span></div><div><span style="min-height: 11pt;"><span style="font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;"> eg：</span></span></div><div><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;"> </span><span style="min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 255); font-family: NSimSun;">void</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">SetDoubleField(</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jobject</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">obj</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">,</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jfieldID</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">fieldID</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">,</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jdouble</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">val</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">)</span></div><div><span style="font-size: 18pt; color: rgb(26, 144, 185); font-weight: bold;">七.调用方法</span></div><div><span style="font-size: 12pt;">实例方法</span></div><div><img src="jni基础入门_files/Image [5].png" type="image/png" data-filename="Image.png" style="font-size: 12pt;"/></div><div><span style="font-size: 12pt;">静态方法</span></div><div><img src="jni基础入门_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: 18pt; color: rgb(26, 144, 185); font-weight: bold;">八.调用构造方法创建对象</span></div><div>   <span style="font-size: 12pt;">构造方法本身也是一个方法，实际上是调用构造方法来创建对象</span></div><div><span style="font-size: 12pt;">  Api如下：</span></div><div><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;"> </span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jobject</span> <span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">NewObject(</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jclass</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">clazz</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">,</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jmethodID</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">methodID</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">, ...)</span></div><div><span style="font-size: 12pt;">  比如：</span></div><div><span style="font-size: 12pt;">  </span></div><div><span style="font-size: 12pt;">                  </span><span style="min-height: 11pt; font-size: 12pt; color: rgb(0, 128, 0); font-family: NSimSun;">// find double class</span></div><div style="min-height: 11pt;"><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">       </span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jclass</span> <span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">doubleClass = (*</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">env</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">).FindClass(</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(163, 21, 21); font-family: NSimSun;">&quot;java/lang/Double&quot;</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">);</span></div><div style="min-height: 11pt;"></div><div style="min-height: 11pt;"><font style="font-size: 12pt;"><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">       </span><span style="min-height: 11pt; font-size: 12pt; color: rgb(0, 128, 0); font-family: NSimSun;">// init method id</span></font></div><div style="min-height: 11pt;"><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">       </span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jmethodID</span> <span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">initMethod = (*</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">env</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">).GetMethodID(doubleClass,</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(163, 21, 21); font-family: NSimSun;">&quot;&lt;init&gt;&quot;</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">,</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(163, 21, 21); font-family: NSimSun;">&quot;(D)V&quot;</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">);</span></div><div style="min-height: 11pt;"><span style="min-height: 11pt;"><span style="font-size: 12pt; font-family: NSimSun;">       </span></span></div><div style="min-height: 11pt;"><font style="font-size: 12pt;"><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">       </span><span style="min-height: 11pt; font-size: 12pt; color: rgb(0, 128, 0); font-family: NSimSun;">// build obj</span></font></div><div style="min-height: 11pt;"><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">       </span><span style="min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 255); font-family: NSimSun;">return</span> <span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">(*</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">env</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">).NewObject(doubleClass, initMethod,</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">value</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">);</span></div><div><span style="font-size: 12pt; color: rgb(227, 0, 0);">注意事项：</span><span style="font-size: 12pt; color: rgb(227, 0, 0);">init方法实际上在jvm虚拟机中实际上并不单是指构造方法，而是指对象的整个初始化节点，字段赋初值+代码块+构造方法</span></div><div><br/></div><div><font color="#1A90B9" style="font-size: 18pt;"><span style="font-size: 18pt; color: rgb(26, 144, 185); font-weight: bold;">九.操作数组元素</span></font></div><div> <span style="font-size: 12pt;">java编程语言中的所有数组类型都有与之相对应的C语言类型和C++语言类型。</span></div><div><span style="font-size: 12pt;"> java数组类型和C语言数组类型的对应关系：</span></div><div><img src="jni基础入门_files/Image [7].png" type="image/png" data-filename="Image.png" style="font-size: 12pt;"/></div><div><span style="font-size: 12pt;"> C和C++的区别：</span></div><div><img src="jni基础入门_files/Image [8].png" type="image/png" data-filename="Image.png" style="font-size: 12pt;"/></div><div><br/></div><div><span style="font-size: 12pt;">boolean数组的特例：</span></div><div><img src="jni基础入门_files/Image [9].png" type="image/png" data-filename="Image.png" style="font-size: 12pt;"/></div><div><span style="font-size: 12pt;">java数组API如下：</span></div><div><img src="jni基础入门_files/Image [10].png" type="image/png" data-filename="Image.png" style="font-size: 12pt;"/></div><div><img src="jni基础入门_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: 18pt; color: rgb(26, 144, 185); font-weight: bold;">十.错误处理</span></div><div><span style="font-size: 12pt;">C的运行系统对数组越界错误、不良指针造成的间接错误不提供任何保护。所以对于本地方法的程序员来说，处理所有出错的条件以保持java平台的完整性显得格外重要。尤其是当你的本地方法诊断出一个它无法解决的问题时，它应该将此问题上报给java虚拟机，然后，java程序会很自然的抛出一个异常。C语言没有异常，但可以使用jni中的api,  调用Throw或ThrowNew函数来创建一个新的异常对象(java异常)。当本地方法退出时，java虚拟机就会抛出该异常。</span></div><div><span style="font-size: 12pt;">函数原型如下：</span></div><div><span style="min-height: 11pt;"><span style="font-size: 12pt; font-family: NSimSun;"> </span><span style="font-size: 12pt; font-family: NSimSun;">  </span></span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jint</span> <span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">Throw(</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jthrowable</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">obj</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">);</span></div><div style="min-height: 11pt;"><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">   </span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jint</span> <span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">ThrowNew(</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jclass</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">clazz</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">,</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 255); font-family: NSimSun;">const</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 255); font-family: NSimSun;">char</span> <span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">*</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">msg</span><span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">);</span></div><div style="min-height: 11pt;"><span style="font-size: 12pt; font-family: NSimSun;">注意：C++代码有异常，但是使用C++代码抛出的异常目前还无法被jvm捕捉，未来将会实现，所以C++还是必须要try-catch，然后再调用上面的Throw函数</span></div><div style="min-height: 11pt;"><font style="font-size: 12pt;"><span style="font-size: 12pt; font-family: NSimSun;">由于使用函数抛出异常，所</span><span style="font-size: 12pt; font-family: NSimSun;">以就没有检查型异常一说，异常不带感染性，所以jni还提供了<span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">ExceptionOccurred方法来检查当前是否有异常抛出</span></span></font></div><div style="min-height: 11pt;"><div><span style="font-size: 12pt;">异常处理API如下：</span></div><div><img src="jni基础入门_files/Image [12].png" type="image/png" data-filename="Image.png" style="font-size: 12pt;"/></div></div><div style="min-height: 11pt;"></div><div><span style="font-size: 18pt; color: rgb(26, 144, 185); font-weight: bold;">十一.C/C++程序中使用调用API来反向调用JVM虚拟机</span></div><div><br/></div><div><span style="font-size: 12pt;">C程序反向调用JVM虚拟机需要更多的配置，参加日记-VS2017下的jni开发环境搭建。</span></div><div><span style="font-size: 12pt;">调用API如下：</span></div><div><span style="min-height: 11pt; font-size: 12pt; color: rgb(111, 0, 138); font-family: NSimSun;">_JNI_IMPORT_OR_EXPORT_</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jint</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(111, 0, 138); font-family: NSimSun;">JNICALL </span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">JNI_CreateJavaVM(</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">JavaVM</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">**</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">pvm</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">,</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 255); font-family: NSimSun;">void</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">**</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">penv</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">,</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(0, 0, 255); font-family: NSimSun;">void</span> <span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">*</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(128, 128, 128); font-family: NSimSun;">args</span><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">);</span></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; font-family: NSimSun;">初始化java虚拟机。如果成功，则返回0，否则返回JNI_ERR.(负数）</span><span style="font-size: 12pt; font-family: NSimSun;">:</span></font></div><div><span style="min-height: 11pt; font-size: 12pt; color: rgb(43, 145, 175); font-family: NSimSun;">jint</span> <span style="min-height: 11pt; font-size: 12pt; font-family: NSimSun;">DestroyJavaVM()</span></div><div><span style="font-size: 12pt;">销毁虚拟机。如果成功则返回0，否则返回一个负值。该函数必须通过一个虚拟机指针进行调用。</span></div><div><br/></div><div><br/></div><div><span style="font-size: 18pt;"><span style="color: rgb(26, 144, 185); font-size: 18pt; font-weight: bold;">参考</span></span></div><div><span style="font-size: 12pt;">1.java核心技术卷二 第八版</span></div><div><span style="font-size: 12pt;">2.<span style="font-size: 12pt;">oracle官方API:<a href="https://docs.oracle.com/javase/9/docs/specs/jni/" style="font-size: 12pt;">https://docs.oracle.com/javase/9/docs/specs/jni/</a></span></span></div><div><span style="font-size: 12pt;">3.JNI字段描述符合和方法描述符：</span><a href="http://www.cnblogs.com/yuyutianxia/p/4750752.html" style="font-size: 12pt;">http://www.cnblogs.com/yuyutianxia/p/4750752.html</a></div><div><span style="font-size: 12pt;">4.Android Ndk:</span><a href="http://blog.csdn.net/u013718120/article/details/64919645" style="font-size: 12pt;">http://blog.csdn.net/u013718120/article/details/64919645</a></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 