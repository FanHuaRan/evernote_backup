<html>
<head>
  <title>JVM中的指针和指针压缩</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="888"/>
<h1>JVM中的指针和指针压缩</h1>

<div>
<span><div><div>JVM的指针与操作系统和cpu的指针是一个道理。</div><div>64位和32位JVM的几个知识点：</div><div>     1.32位的JVM的指针是32位，即4个字节；64位的JVM的指针是64位，即8个字节。</div><div>     2.64位的JVM只能运行在64位机器上；32位的JVM可以运行在64位或者32位机器上。</div><div>     3.实际上一个JVM就是一个操作系统进程。</div><div>     4.32位指针的寻址范围是4GB， 64位指针的寻址范围是4GB*2的32次方（百亿亿字节）。</div><div>     5.32位JVM存在一个问题，32位JVM的内存最大限制是4GB。如果32位JVM运行在32位物理机上，因为内核需要占用一部分内存，所以往往jvm的内存无法达到4G，如：32位的windows系统的进程的内存最大限制为2GB。</div><div>     6.64位的JVM存在一个问题，64位JVM的内存最大限制非常大，其可以表示的内存远远高于当前企业服务器的内存大小，使用64位指针来存储对象引用是非常浪费内存的。</div><div>jvm中使用指针访问对象的知识点：</div><div>     1.64位的CPU使用的虚拟地址是64位的, 访问内存时, 必须使用64位的指针访问内存对象</div><div>     2.java对象是分配于具体的某个内存位置的, 对其访问必须使用64位地址</div><div>     3.对java对象内的引用字段进行访问时, 必须经过虚拟机这一层,操作某个对象引用不管是getfield还是putfield, 都是由虚拟机来执行. 或者简单来说, 要改变java对象某个引用字段, 必须经过虚拟机的参与。</div><div>     4.使用指针压缩，那到底是怎么个压缩法呢？公式如下：64位地址=起始地址+（压缩地址&lt;&lt;3位），因为jvm中的对象都是8字节对齐，所以地址的后三位都是0，故可以通过右移三位来压缩，从而多利用了3位，意味着32位指针可寻址内存变为了32G，够用了。</div><div>所以对于受jvm管理的对象，大部分都可以经过jvm层面进行一种指针压缩的技术，从而实现jvm和cpu交互的时候是64位地址，但是实际上jvm存储的地址是64位，这就是指针压缩技术，指针压缩技术通过几个简单的运行可以实现将64位指针压缩到32位，从而有效解决64位jvm因为指针膨胀导致的内存开销。</div><div>可以使用-xx:+/-UseCompressOops在64位的JVM上开启指针压缩</div><div><br/></div><div>摘一篇文章：</div><h1 style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 2em; transition: color 0.2s;"><span style="border: 0px; outline: 0px; font-size: 2em; color: rgb(85, 85, 85); font-weight: bold; line-height: 1.6em;">HotSpot JVM 中的对象指针压缩</span></h1><div><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">原文：</span><a href="https://wiki.openjdk.java.net/display/HotSpot/CompressedOops" style="border: 0px; outline: 0px; font-size: 14px; color: rgb(37, 143, 184); line-height: 1.6em;">https://wiki.openjdk.java.net/display/HotSpot/CompressedOops</a></div><h2 style="margin: 1.1em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 1.5em;"><span style="border: 0px; outline: 0px; font-size: 1.5em; font-weight: bold; line-height: 1.1em;">什么是一般对象指针？</span></h2><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">一般对象指针（oop, ordinary object pointer）是HotSpot虚拟机的一个术语，表示受托管的对象指针。它的大小通常和本地指针是一样的。Java应用程序和GC子系统会非常小心地跟踪这些受托管的指针，以便在销毁对象时回收内存空间，或是在对空间进行整理时移动（复制）对象。</span></div><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">在一些从Smalltalk和Self演变而来的虚拟机实现中都有一般对象指针这个术语，包括：</span></div><ul style="margin: 1.6em 20px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; list-style: disc;"><li style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><a href="https://github.com/russellallen/self/blob/master/vm/src/any/objects/oop.hh" style="border: 0px; outline: 0px; font-size: 14px; color: rgb(37, 143, 184); line-height: 1.6em;">Self</a><span style="font-size: 14px; line-height: 1.6em;">：一门基于原型的语言，是Smalltalk的近亲</span></li><li style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><a href="http://code.google.com/p/strongtalk/wiki/VMTypesForSmalltalkObjects" style="border: 0px; outline: 0px; font-size: 14px; color: rgb(37, 143, 184); line-height: 1.6em;">Strongtalk</a><span style="font-size: 14px; line-height: 1.6em;">：Smalltalk的一种实现</span></li><li style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><a href="http://hg.openjdk.java.net/hsx/hotspot-main/hotspot/file/0/src/share/vm/oops/oop.hpp" style="border: 0px; outline: 0px; font-size: 14px; color: rgb(37, 143, 184); line-height: 1.6em;">Hotspot</a></li><li style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><a href="http://code.google.com/p/v8/source/browse/trunk/src/objects.h" style="border: 0px; outline: 0px; font-size: 14px; color: rgb(37, 143, 184); line-height: 1.6em;">V8</a></li></ul><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">部分系统中会使用小整型（smi, small integers）这个名称，表示一个指向30位整型的虚拟指针。这个术语在Smalltalk的V8实现中也可以看到。</span></div><h2 style="margin: 1.1em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 1.5em;"><span style="border: 0px; outline: 0px; font-size: 1.5em; font-weight: bold; line-height: 1.1em;">为什么需要压缩？</span></h2><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">在</span><a href="http://docs.oracle.com/cd/E19620-01/805-3024/lp64-1/index.html" style="border: 0px; outline: 0px; font-size: 14px; color: rgb(37, 143, 184); line-height: 1.6em;">LP64</a><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">系统中，指针需要使用64位来表示；</span><a href="http://docs.oracle.com/cd/E19620-01/805-3024/lp64-1/index.html" style="border: 0px; outline: 0px; font-size: 14px; color: rgb(37, 143, 184); line-height: 1.6em;">ILP32</a><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">系统中则只需要32位。在ILP32系统中，堆内存的大小只能支持到4Gb，这对很多应用程序来说是不够的。在LP64系统中，所有应用程序运行时占用的空间都会比ILP32大1.5倍左右，这是因为指针占用的空间增加了。虽然内存是比较廉价的，但网络带宽和缓存容量是紧张的。所以，为了解决4Gb的限制而增加堆内存的占用空间，就有些得不偿失了。</span></div><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">在x86芯片中，ILP32模式可用的寄存器数量是LP64模式的一半。SPARC没有此限制；RISC芯片本来就提供了很多寄存器，LP64模式下会提供更多。</span></div><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">压缩后的一般对象指针在使用时需要将32位整型按因数8进行扩展，并加到一个64位的基础地址上，从而找到所指向的对象。这种方法可以表示四十亿个对象，相当于32Gb的堆内存。同时，使用此法压缩数据结构也能达到和ILP32系统相近的效果。</span></div><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">我们使用</span><span style="border: 0px; outline: 0px; font-size: 14px; font-style: italic; line-height: 1.6em;">解码</span><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">来表示从32位对象指针转换成64位地址的过程，其反过程则称为</span><span style="border: 0px; outline: 0px; font-size: 14px; font-style: italic; line-height: 1.6em;">编码</span><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">。</span></div><h2 style="margin: 1.1em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 1.5em;"><span style="border: 0px; outline: 0px; font-size: 1.5em; font-weight: bold; line-height: 1.1em;">什么情况下会进行压缩？</span></h2><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">运行在ILP32模式下的Java虚拟机，或在运行时将</span><span style="border: 0px; outline: 0px; font-size: 14px; background: rgb(238, 238, 238); text-shadow: rgb(255, 255, 255) 0px 1px; font-family: &quot;Source Code Pro&quot;, Consolas, Monaco, Menlo, Consolas, monospace; line-height: 1.6em;">UseCompressedOops</span><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">标志位关闭，则所有的对象指针都不会被压缩。</span></div><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">如果</span><span style="border: 0px; outline: 0px; font-size: 14px; background: rgb(238, 238, 238); text-shadow: rgb(255, 255, 255) 0px 1px; font-family: &quot;Source Code Pro&quot;, Consolas, Monaco, Menlo, Consolas, monospace; line-height: 1.6em;">UseCompressedOops</span><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">是打开的，则以下对象的指针会被压缩：</span></div><ul style="margin: 1.6em 20px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; list-style: disc;"><li style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><span style="font-size: 14px; line-height: 1.6em;">所有对象的</span><a href="http://stackoverflow.com/questions/16721021/what-is-klass-klassklass" style="border: 0px; outline: 0px; font-size: 14px; color: rgb(37, 143, 184); line-height: 1.6em;">klass</a><span style="font-size: 14px; line-height: 1.6em;">属性</span></li><li style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><span style="font-size: 14px; line-height: 1.6em;">所有</span><a href="http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/7-b147/sun/jvm/hotspot/oops/Oop.java#Oop" style="border: 0px; outline: 0px; font-size: 14px; color: rgb(37, 143, 184); line-height: 1.6em;">对象指针实例</a><span style="font-size: 14px; line-height: 1.6em;">的属性</span></li><li style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><span style="font-size: 14px; line-height: 1.6em;">所有对象指针数组的元素（objArray）</span></li></ul><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">HotSpot VM中，用于表示Java类的数据结构是不会压缩的，这部分数据都存放在永久代（PermGen）中。</span></div><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">在解释器中，一般对象指针也是不压缩的，包括JVM本地变量和栈内元素、调用参数、返回值等。解释器会在读取堆内对象时解码对象指针，并在存入时进行编码。</span></div><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">同样，方法调用序列（method calling sequence），无论是解释执行还是编译执行，都不会使用对象指针压缩。</span></div><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">在编译后的代码中，对象指针是否压缩取决于不同的优化结果。优化后的代码可能会将压缩后的对象指针直接从一处搬往另一处，而不进行编解码操作。如果芯片（如x86）支持解码，那在使用对象指针时就不需要自行解码了。</span></div><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">所以，以下数据结构在编译后的代码中既可以是压缩后的对象指针，也可能是本地地址：</span></div><ul style="margin: 1.6em 20px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; list-style: disc;"><li style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><span style="font-size: 14px; line-height: 1.6em;">寄存器或溢出槽（spill slot）中的数据</span></li><li style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><span style="font-size: 14px; line-height: 1.6em;">对象指针映射表（GC映射表）</span></li><li style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><span style="font-size: 14px; line-height: 1.6em;">调试信息</span></li><li style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><span style="font-size: 14px; line-height: 1.6em;">嵌套在机器码中的对象指针（在非RISC芯片中支持，如x86）</span></li><li style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><a href="http://openjdk.java.net/groups/hotspot/docs/HotSpotGlossary.html#nmethod" style="border: 0px; outline: 0px; font-size: 14px; color: rgb(37, 143, 184); line-height: 1.6em;">nmethod</a><span style="font-size: 14px; line-height: 1.6em;">常量区（包括那些影响到机器码的重定位操作）</span></li></ul><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">在HotSpot JVM的C++代码部分，对象指针压缩与否反映在C++的静态类型系统中。通常情况下，对象指针是不压缩的。具体来说，C++的成员函数在操作本地代码传递过来的指针时（如</span><span style="border: 0px; outline: 0px; font-size: 14px; font-style: italic; line-height: 1.6em;">this</span><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">），其执行过程不会有什么不同。JVM中的部分方法则提供了重载，能够处理压缩和不压缩的对象指针。</span></div><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">重要的C++数据不会被压缩：</span></div><ul style="margin: 1.6em 20px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; list-style: disc;"><li style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><span style="font-size: 14px; line-height: 1.6em;">C++对象指针（</span><span style="border: 0px; outline: 0px; font-size: 14px; font-style: italic; line-height: 1.6em;">this</span><span style="font-size: 14px; line-height: 1.6em;">）</span></li><li style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><span style="font-size: 14px; line-height: 1.6em;">受托管指针的句柄（Handle类型等）</span></li><li style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><span style="font-size: 14px; line-height: 1.6em;">JNI句柄（jobject类型）</span></li></ul><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">C++在使用对象指针压缩时（加载和存储等），会以</span><span style="border: 0px; outline: 0px; font-size: 14px; background: rgb(238, 238, 238); text-shadow: rgb(255, 255, 255) 0px 1px; font-family: &quot;Source Code Pro&quot;, Consolas, Monaco, Menlo, Consolas, monospace; line-height: 1.6em;">narrowOop</span><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">作为标记。</span></div><h2 style="margin: 1.1em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 1.5em;"><span style="border: 0px; outline: 0px; font-size: 1.5em; font-weight: bold; line-height: 1.1em;">使用压缩寻址</span></h2><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">以下是使用对象指针压缩的x86指令示例：</span></div><table style="outline: 0px; font-size: 14px; vertical-align: middle; border-spacing: 0px; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><tr style="padding: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><td style="outline: 0px; font-size: 14px; vertical-align: middle; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div style="margin: 0px; padding: 0px 20px 0px 0px; border: none; outline: 0px; font-weight: inherit; font-style: inherit; font-family: &quot;Source Code Pro&quot;, Consolas, Monaco, Menlo, Consolas, monospace; font-size: 0.85em; vertical-align: baseline; background: rgb(45, 45, 45); overflow: auto; color: rgb(102, 102, 102); line-height: 22.4px; text-align: right;"></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">1</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">2</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">3</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">4</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">5</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">6</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">7</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">8</span></div></td><td style="outline: 0px; font-size: 14px; vertical-align: middle; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div style="margin: 0px; padding: 0px; border: none; outline: 0px; font-weight: inherit; font-style: inherit; font-family: &quot;Source Code Pro&quot;, Consolas, Monaco, Menlo, Consolas, monospace; font-size: 14px; vertical-align: baseline; background: rgb(45, 45, 45); overflow: auto; color: rgb(204, 204, 204); line-height: 22.4px;"></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">! int R8; oop[] R9; // R9是64位</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">! oop R10 = R9[R8]; // R10是32位</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">! 从原始基址指针加载压缩对象指针：</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">movl R10, [R9 + R8&lt;&lt;3 + 16]</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">! klassOop R11 = R10._klass; // R11是32位</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">! void* const R12 = GetHeapBase();</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">! 从压缩基址指针加载klass指针：</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">movl R11, [R12 + R10&lt;&lt;3 + 8]</span></div></td></tr></tbody></table><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">以下sparc指令用于解压对象指针（可为空）：</span></div><table style="outline: 0px; font-size: 14px; vertical-align: middle; border-spacing: 0px; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><tr style="padding: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><td style="outline: 0px; font-size: 14px; vertical-align: middle; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div style="margin: 0px; padding: 0px 20px 0px 0px; border: none; outline: 0px; font-weight: inherit; font-style: inherit; font-family: &quot;Source Code Pro&quot;, Consolas, Monaco, Menlo, Consolas, monospace; font-size: 0.85em; vertical-align: baseline; background: rgb(45, 45, 45); overflow: auto; color: rgb(102, 102, 102); line-height: 22.4px; text-align: right;"></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">1</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">2</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">3</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">4</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">5</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">6</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">7</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">8</span></div></td><td style="outline: 0px; font-size: 14px; vertical-align: middle; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div style="margin: 0px; padding: 0px; border: none; outline: 0px; font-weight: inherit; font-style: inherit; font-family: &quot;Source Code Pro&quot;, Consolas, Monaco, Menlo, Consolas, monospace; font-size: 14px; vertical-align: baseline; background: rgb(45, 45, 45); overflow: auto; color: rgb(204, 204, 204); line-height: 22.4px;"></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">! java.lang.Thread::getThreadGroup@1 (line 1072)</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">! L1 = L7.group</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">ld [ %l7 + 0x44 ], %l1</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">! L3 = decode(L1)</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">cmp %l1, 0</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">sllx %l1, 3, %l3</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">brnz,a %l3, .+8</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">add %l3, %g6, %l3 ! %g6是常量堆基址</span></div></td></tr></tbody></table><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; font-style: italic; line-height: 1.6em;">输出中的注解来自</span><a href="https://wiki.openjdk.java.net/display/HotSpot/PrintAssembly" style="border: 0px; outline: 0px; font-size: 14px; color: rgb(37, 143, 184); font-style: italic; line-height: 1.6em;">PrintAssembly插件</a><span style="border: 0px; outline: 0px; font-size: 14px; font-style: italic; line-height: 1.6em;">。</span></div><h2 style="margin: 1.1em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 1.5em;"><span style="border: 0px; outline: 0px; font-size: 1.5em; font-weight: bold; line-height: 1.1em;">空值处理</span></h2><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">32位零值会被解压为64位空值，这就需要在解码逻辑中加入一段特殊的逻辑。或者说可以默认某些压缩对象指针肯定不会空（如klass的属性），这样就能使用简单一些的编解码逻辑了。</span></div><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">隐式空值检测对JVM的性能至关重要，包括解释执行和编译执行的字节码。对于一个偏移量较小的对象指针，如果基址指针为空，那很有可能造成系统崩溃，因为虚拟地址空间的前几页通常是没有映射的。</span></div><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">对于压缩对象指针，我们可以用一种类似的技巧来欺骗它：将堆内存前几页的映射去除，如果解压出的指针为空（相对于基址指针），仍可以用它来做加载和存储的操作，隐式空值检测也能照常运行。</span></div><h2 style="margin: 1.1em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 1.5em;"><span style="border: 0px; outline: 0px; font-size: 1.5em; font-weight: bold; line-height: 1.1em;">对象头信息</span></h2><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">对象头信息通常包含几个部分：固定长度的标志位；klass信息；如果对象是数组，则包含一个32位的信息，并可能追加一个32位的空隙进行对齐；零个或多个实例属性，数组元素，元信息等。（有趣的是，Klass的对象头信息包含了一个C++的</span><a href="https://en.wikipedia.org/wiki/Virtual_method_table" style="border: 0px; outline: 0px; font-size: 14px; color: rgb(37, 143, 184); line-height: 1.6em;">虚拟方法表</a><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">）</span></div><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">上述追加的32位空隙通常也可用于存储属性信息。</span></div><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">如果</span><span style="border: 0px; outline: 0px; font-size: 14px; background: rgb(238, 238, 238); text-shadow: rgb(255, 255, 255) 0px 1px; font-family: &quot;Source Code Pro&quot;, Consolas, Monaco, Menlo, Consolas, monospace; line-height: 1.6em;">UseCompressedOops</span><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">关闭，标志位和klass都是正常长度。对于数组，32位空隙在LP64系统中总是存在；而ILP32系统中，只有当数组元素是64位数据时才存在这个空隙。</span></div><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">如果</span><span style="border: 0px; outline: 0px; font-size: 14px; background: rgb(238, 238, 238); text-shadow: rgb(255, 255, 255) 0px 1px; font-family: &quot;Source Code Pro&quot;, Consolas, Monaco, Menlo, Consolas, monospace; line-height: 1.6em;">UseCompressedOops</span><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">打开，则klass是32位的。非数组对象在klass后会追加一个空隙，而数组对象则直接开始存储元素信息。</span></div><h2 style="margin: 1.1em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 1.5em;"><span style="border: 0px; outline: 0px; font-size: 1.5em; font-weight: bold; line-height: 1.1em;">零基压缩技术</span></h2><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">压缩对象指针（narrow-oop）是基于某个地址的偏移量，这个基础地址（narrow-oop-base）是由Java堆内存基址减去一个内存页的大小得来的，从而支持隐式空值检测。所以一个属性字段的地址可以这样得到：</span></div><table style="outline: 0px; font-size: 14px; vertical-align: middle; border-spacing: 0px; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><tr style="padding: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><td style="outline: 0px; font-size: 14px; vertical-align: middle; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div style="margin: 0px; padding: 0px 20px 0px 0px; border: none; outline: 0px; font-weight: inherit; font-style: inherit; font-family: &quot;Source Code Pro&quot;, Consolas, Monaco, Menlo, Consolas, monospace; font-size: 0.85em; vertical-align: baseline; background: rgb(45, 45, 45); overflow: auto; color: rgb(102, 102, 102); line-height: 22.4px; text-align: right;"></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">1</span></div></td><td style="outline: 0px; font-size: 14px; vertical-align: middle; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div style="margin: 0px; padding: 0px; border: none; outline: 0px; font-weight: inherit; font-style: inherit; font-family: &quot;Source Code Pro&quot;, Consolas, Monaco, Menlo, Consolas, monospace; font-size: 14px; vertical-align: baseline; background: rgb(45, 45, 45); overflow: auto; color: rgb(204, 204, 204); line-height: 22.4px;"></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">&lt;narrow-oop-base&gt; + (&lt;narrow-oop&gt; &lt;&lt; 3) + &lt;field-offset&gt;.</span></div></td></tr></tbody></table><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">如果基础地址可以是0（Java堆内存不一定要从0偏移量开始），那么公式就可以简化为：</span></div><table style="outline: 0px; font-size: 14px; vertical-align: middle; border-spacing: 0px; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><tr style="padding: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><td style="outline: 0px; font-size: 14px; vertical-align: middle; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div style="margin: 0px; padding: 0px 20px 0px 0px; border: none; outline: 0px; font-weight: inherit; font-style: inherit; font-family: &quot;Source Code Pro&quot;, Consolas, Monaco, Menlo, Consolas, monospace; font-size: 0.85em; vertical-align: baseline; background: rgb(45, 45, 45); overflow: auto; color: rgb(102, 102, 102); line-height: 22.4px; text-align: right;"></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">1</span></div></td><td style="outline: 0px; font-size: 14px; vertical-align: middle; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div style="margin: 0px; padding: 0px; border: none; outline: 0px; font-weight: inherit; font-style: inherit; font-family: &quot;Source Code Pro&quot;, Consolas, Monaco, Menlo, Consolas, monospace; font-size: 14px; vertical-align: baseline; background: rgb(45, 45, 45); overflow: auto; color: rgb(204, 204, 204); line-height: 22.4px;"></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">(&lt;narrow-oop &lt;&lt; 3) + &lt;field-offset&gt;</span></div></td></tr></tbody></table><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">理论上说，这一步可以省去一次寄存器上的加和操作。而且使用零基压缩技术后，空值检测也就不需要了。</span></div><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">之前的解压代码是：</span></div><table style="outline: 0px; font-size: 14px; vertical-align: middle; border-spacing: 0px; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><tr style="padding: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><td style="outline: 0px; font-size: 14px; vertical-align: middle; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div style="margin: 0px; padding: 0px 20px 0px 0px; border: none; outline: 0px; font-weight: inherit; font-style: inherit; font-family: &quot;Source Code Pro&quot;, Consolas, Monaco, Menlo, Consolas, monospace; font-size: 0.85em; vertical-align: baseline; background: rgb(45, 45, 45); overflow: auto; color: rgb(102, 102, 102); line-height: 22.4px; text-align: right;"></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">1</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">2</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">3</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">4</span></div></td><td style="outline: 0px; font-size: 14px; vertical-align: middle; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div style="margin: 0px; padding: 0px; border: none; outline: 0px; font-weight: inherit; font-style: inherit; font-family: &quot;Source Code Pro&quot;, Consolas, Monaco, Menlo, Consolas, monospace; font-size: 14px; vertical-align: baseline; background: rgb(45, 45, 45); overflow: auto; color: rgb(204, 204, 204); line-height: 22.4px;"></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">if (&lt;narrow-oop&gt; == NULL)</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">&lt;wide_oop&gt; = NULL</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">else</span></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">&lt;wide_oop&gt; = &lt;narrow-oop-base&gt; + (&lt;narrow-oop&gt; &lt;&lt; 3)</span></div></td></tr></tbody></table><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">使用零基压缩后，只需使用移位操作：</span></div><table style="outline: 0px; font-size: 14px; vertical-align: middle; border-spacing: 0px; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><tr style="padding: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><td style="outline: 0px; font-size: 14px; vertical-align: middle; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div style="margin: 0px; padding: 0px 20px 0px 0px; border: none; outline: 0px; font-weight: inherit; font-style: inherit; font-family: &quot;Source Code Pro&quot;, Consolas, Monaco, Menlo, Consolas, monospace; font-size: 0.85em; vertical-align: baseline; background: rgb(45, 45, 45); overflow: auto; color: rgb(102, 102, 102); line-height: 22.4px; text-align: right;"></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 12px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 12px; height: 22.4px; font-weight: normal; line-height: 1.6em;">1</span></div></td><td style="outline: 0px; font-size: 14px; vertical-align: middle; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div style="margin: 0px; padding: 0px; border: none; outline: 0px; font-weight: inherit; font-style: inherit; font-family: &quot;Source Code Pro&quot;, Consolas, Monaco, Menlo, Consolas, monospace; font-size: 14px; vertical-align: baseline; background: rgb(45, 45, 45); overflow: auto; color: rgb(204, 204, 204); line-height: 22.4px;"></div><div style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; height: 22.4px;"><span style="border: 0px; outline: 0px; font-size: 14px; height: 22.4px; font-weight: normal; line-height: 1.6em;">&lt;wide_oop&gt; = &lt;narrow-oop&gt; &lt;&lt; 3</span></div></td></tr></tbody></table><div style="margin: 1.6em 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px;"><span style="border: 0px; outline: 0px; font-size: 14px; line-height: 1.6em;">零基压缩技术会根据堆内存的大小以及平台特性来选择不同的策略：</span></div><ol style="margin: 1.6em 20px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; list-style: decimal;"><li style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><span style="font-size: 14px; line-height: 1.6em;">堆内存小于4Gb，直接使用压缩对象指针进行寻址，无需压缩和解压；</span></li><li style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><span style="font-size: 14px; line-height: 1.6em;">堆内存大于4Gb，则尝试分配小于32Gb的堆内存，并使用零基压缩技术；</span></li><li style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline;"><span style="font-size: 14px; line-height: 1.6em;">如果仍然失败，则使用普通的对象指针压缩技术，即</span><span style="border: 0px; outline: 0px; font-size: 14px; background: rgb(238, 238, 238); text-shadow: rgb(255, 255, 255) 0px 1px; font-family: &quot;Source Code Pro&quot;, Consolas, Monaco, Menlo, Consolas, monospace; line-height: 1.6em;">narrow-oop-base</span><span style="font-size: 14px; line-height: 1.6em;">。</span></li></ol></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 