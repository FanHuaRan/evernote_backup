<html>
<head>
  <title>MySQL索引之innodb索引为什么是B+树数据结构</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1569"/>
<h1>MySQL索引之innodb索引为什么是B+树数据结构</h1>

<div>
<span><div><br/></div><div style="box-sizing: border-box; font-size: 15px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 24px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">一、为什么mysql innodb索引是B+树数据结构？言简意赅，就是因为：</span></div><div style="box-sizing: border-box; font-size: 15px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><span style="box-sizing: border-box; font-size: 18px; color: rgb(85, 85, 85); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal;">1.文件很大，不可能全部存储在内存中，故要存储到磁盘上</span></div><div><span style="box-sizing: border-box; font-size: 18px; color: rgb(85, 85, 85); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal;">2.索引的结构组织要尽量减少查找过程中磁盘I/O的存取次数（为什么使用B-/+Tree，还跟磁盘存取原理有关。）</span></div><div><span style="box-sizing: border-box; font-size: 18px; color: rgb(85, 85, 85); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal;">3.B+树所有的Data域在叶子节点，一般来说都会进行一个优化，就是将所有的叶子节点用指针串起来，这样遍历叶子节点就能获得全部数据。</span></div></div><div style="box-sizing: border-box; font-size: 15px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br style="box-sizing: border-box;"/></div></div><div style="box-sizing: border-box; font-size: 15px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 24px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">二、什么是聚簇索引？</span></div><div style="box-sizing: border-box; font-size: 15px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><span style="box-sizing: border-box; font-size: 18px; color: rgb(85, 85, 85); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal;">像innodb中,主键的索引结构中,既存储了主键值,又存储了行数据,这种结构称为”聚簇索引”</span></div></div><div style="box-sizing: border-box; font-size: 15px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br style="box-sizing: border-box;"/></div></div><div style="box-sizing: border-box; font-size: 15px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><span style="box-sizing: border-box; font-size: 24px; color: rgb(85, 85, 85); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">三、为什么MongoDB采用B树索引，而Mysql用B+树做索引</span></div></div><div><span style="box-sizing: border-box; font-size: 18px; font-family: Arial;">先从数据结构的角度来答。</span></div><div><span style="box-sizing: border-box; font-size: 18px; font-family: Arial;">题主应该知道B-树和B+树最重要的一个区别就是B+树只有叶节点存放数据，其余节点用来索引，而B-树是每个索引节点都会有Data域。</span></div><div><span style="box-sizing: border-box; font-size: 18px; color: rgb(255, 0, 0); font-family: Arial;">这就决定了B+树更适合用来存储外部数据，也就是所谓的磁盘数据。</span></div><div><span style="box-sizing: border-box; font-size: 18px; font-family: Arial;">从Mysql（Inoodb）的角度来看，B+树是用来充当索引的，一般来说索引非常大，尤其是关系性数据库这种数据量大的索引能达到亿级别，所以为了减少内存的占用，索引也会被存储在磁盘上。</span></div><div><span style="box-sizing: border-box; font-size: 18px; font-family: Arial;">那么Mysql如何衡量查询效率呢？磁盘IO次数，B-树（B类树）的特定就是每层节点数目非常多，层数很少，目的就是为了就少磁盘IO次数，当查询数据的时候，最好的情况就是很快找到目标索引，然后读取数据，使用B+树就能很好的完成这个目的，但是B-树的每个节点都有data域（指针），这无疑增大了节点大小，说白了增加了磁盘IO次数（磁盘IO一次读出的数据量大小是固定的，单个数据变大，每次读出的就少，IO次数增多，一次IO多耗时啊！），</span><span style="box-sizing: border-box; font-size: 18px; color: rgb(255, 0, 0); font-family: Arial;">原因1：B+树除了叶子节点其它节点并不存储数据，节点小，磁盘IO次数就少。</span></div><div><span style="box-sizing: border-box; font-size: 18px; color: rgb(255, 0, 0); font-family: Arial;">原因2：B+树所有的Data域在叶子节点，一般来说都会进行一个优化，就是将所有的叶子节点用指针串起来。这样遍历叶子节点就能获得全部数据。</span></div><div><br style="box-sizing: border-box;"/></div><div><br style="box-sizing: border-box;"/></div><div><span style="box-sizing: border-box; font-size: 18px; font-family: Arial;">至于MongoDB为什么使用B-树而不是B+树，可以从它的设计角度来考虑，它并不是传统的关系性数据库，而是以Json格式作为存储的nosql，目的就是高性能，高可用，易扩展。首先它摆脱了关系模型，上面所述的优点2需求就没那么强烈了，其次Mysql由于使用B+树，数据都在叶节点上，每次查询都需要访问到叶节点，而MongoDB使用B-树，所有节点都有Data域，只要找到指定索引就可以进行访问，无疑单次查询平均快于Mysql（但侧面来看Mysql至少平均查询耗时差不多）。</span></div><div><br style="box-sizing: border-box;"/></div><div><br style="box-sizing: border-box;"/></div><div><span style="box-sizing: border-box; font-size: 18px; font-family: Arial;">总体来说，Mysql选用B+树和MongoDB选用B-树还是以自己的需求来选择的。</span></div><div><br/></div><div><span style="font-weight: bold; font-size: 12pt;">原文地址：</span><a href="http://blog.csdn.net/xuehuagongzi000/article/details/78985844" style="font-weight: bold; font-size: 12pt;">http://blog.csdn.net/xuehuagongzi000/article/details/78985844</a></div></span>
</div></body></html> 