<html>
<head>
  <title>InnoDB原理之浅谈InnoDB存储引擎</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1976"/>
<h1>InnoDB原理之浅谈InnoDB存储引擎</h1>

<div>
<span><div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; font-size: 16px; min-height: 26px; text-align: justify; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 16px; min-height: 26px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">InnoDB是事务安全的存储引擎，设计上借鉴了很多Oracle的架构思想，一般而言，在OLTP应用中，InnoDB应该作为核心应用表的首先存储引擎。InnoDB是由第三方的Innobase Oy公司开发，现已被Oracle收购，创始人是Heikki Tuuri，芬兰赫尔辛基人，和著名的Linux创始人Linus是校友。</span></div><div style="margin: 0px 0px 16px; padding: 0px; box-sizing: border-box; font-size: 16px; min-height: 26px; text-align: justify; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box;"/></div><h2 style="margin: 8px 0px 16px; padding: 0px; box-sizing: border-box; font-size: 24px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 24px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 32px;">InnoDB体系架构</span></h2><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><span style="font-size: 16px; color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;"><img src="InnoDB原理之浅谈InnoDB存储引擎_files/Image.jpg" type="image/jpeg" data-filename="Image.jpg" style="border: 0px; outline: 0px; box-sizing: border-box; max-width: 100%; margin: 0px 0px 24px;"/></span></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;">上面是InnoDB的一个简图，简单来说，InnoDB是由一系列后台线程和一大块内存组成。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box;"/></div><h3 style="margin: 8px 0px 16px; padding: 0px; box-sizing: border-box; font-size: 22px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 22px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 30px;">后台线程</span></h3><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;">默认情况下，InnoDB的后台线程有7个 —— 4个IO thread, 1个master thread, 1个lock monitor thread, 一个error monitor thread</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box;"/></div><h3 style="margin: 8px 0px 16px; padding: 0px; box-sizing: border-box; font-size: 22px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 22px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 30px;">内存</span></h3><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;">InnoDB的内存主要有以下几个部分组成：缓冲池 (buffer pool)、重做日志缓冲池(redo log buffer）以及额外的内存池（additional memory pool），如下图所示：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box;"/></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><span style="font-size: 16px; color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;"><img src="InnoDB原理之浅谈InnoDB存储引擎_files/Image [1].jpg" type="image/jpeg" data-filename="Image.jpg" style="border: 0px; outline: 0px; box-sizing: border-box; max-width: 100%; margin: 0px 0px 24px;"/></span></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box;"/></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box;"/></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;">其中缓冲池占最大块内存，用来缓存各自数据，数据文件按页（每页16K）读取到缓冲池，按最近最少使用算法（LRU）保留缓存数据。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;">缓冲池缓冲的数据类型有：数据页、索引页、插入缓冲、自适应哈希索引、锁信息、数据字典信息等，其中数据页和索引页占了绝大部分内存。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box;"/></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;">日志缓冲将重做日志信息先放入这个缓冲区，然后按一定频率（默认为1s）将其刷新至重做日志文件。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box;"/></div><h2 style="margin: 8px 0px 16px; padding: 0px; box-sizing: border-box; font-size: 24px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 24px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 32px;">Master 后台线程</span></h2><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;">InnoDB的主要工作都是在一个单独的Master线程里完成的。Master线程的优先级最高，它主要分为以下几个循环：主循环（loop）、后台循环（background loop）、刷新循环（flush loop）、暂停循环（suspend loop）。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="box-sizing: border-box;"/></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;">先来看看主循环，下面是它的伪代码：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="margin: 0px 0px 24px; padding: 1px 0px 0px; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; font-size: 12px; background-color: rgb(231, 229, 220); width: 851.391px; text-align: left;"><div style="margin: 0px; padding: 0px 0px 0px 45px; box-sizing: border-box;"><div style="margin: 0px; padding: 3px 8px 10px 10px; box-sizing: border-box; font-size: 9px; background-color: rgb(248, 248, 248); border-left: 3px solid rgb(108, 226, 108); border-right: 1px solid rgb(231, 229, 220);"><div><span style="box-sizing: border-box; font-size: 9px; color: silver; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: normal;">[plain]</span><span style="font-size: 9px; color: silver; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; line-height: normal;"> </span><a href="http://blog.csdn.net/dbanote/article/details/9074641#" style="outline: 0px; box-sizing: border-box; background-image: url(&quot;//csdnimg.cn/release/phoenix/images/ico_plain.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px; color: rgb(103, 149, 181); font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; line-height: normal;" title="view plain">view plain</a><span style="box-sizing: border-box; font-size: 9px; color: silver; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; line-height: normal;"> </span><a href="http://blog.csdn.net/dbanote/article/details/9074641#" style="box-sizing: border-box; outline: 0px; background-image: url(&quot;//csdnimg.cn/release/phoenix/images/ico_copy.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px; color: rgb(103, 149, 181); font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; line-height: normal;" title="copy">copy</a></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; position: absolute; left: 341px; top: 1859px; width: 16px; height: 16px; z-index: 99;"></div></div></div><ol start="1" style="margin: 0px 0px 24px; padding: 0px; box-sizing: border-box; list-style: decimal; border-top: none; border-right: 1px solid rgb(231, 229, 220); border-bottom: none; border-left: none; background-color: rgb(255, 255, 255);"><li style="margin-top: 8px; margin-left: 40px; box-sizing: border-box; list-style-type: decimal; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px 3px 0px 10px !important; list-style-position: outside !important;"><span style="box-sizing: border-box; border: none; font-size: 12px; color: rgb(0, 0, 0); font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">void master_thread() (  </span></li><li style="margin-top: 8px; margin-left: 40px; box-sizing: border-box; list-style-type: decimal; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px 3px 0px 10px !important; list-style-position: outside !important;"><span style="box-sizing: border-box; border: none; font-size: 12px; color: rgb(0, 0, 0); font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">loop:  </span></li><li style="margin-top: 8px; margin-left: 40px; box-sizing: border-box; list-style-type: decimal; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px 3px 0px 10px !important; list-style-position: outside !important;"><span style="box-sizing: border-box; border: none; font-size: 12px; color: rgb(0, 0, 0); font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">for (int i =0; i &lt;10; i++){  </span></li><li style="margin-top: 8px; margin-left: 40px; box-sizing: border-box; list-style-type: decimal; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px 3px 0px 10px !important; list-style-position: outside !important;"><span style="box-sizing: border-box; border: none; font-size: 12px; color: rgb(0, 0, 0); font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">    do thing once per second  </span></li><li style="margin-top: 8px; margin-left: 40px; box-sizing: border-box; list-style-type: decimal; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px 3px 0px 10px !important; list-style-position: outside !important;"><span style="box-sizing: border-box; border: none; font-size: 12px; color: rgb(0, 0, 0); font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">    sleep 1 second if necessary  </span></li><li style="margin-top: 8px; margin-left: 40px; box-sizing: border-box; list-style-type: decimal; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px 3px 0px 10px !important; list-style-position: outside !important;"><span style="box-sizing: border-box; border: none; font-size: 12px; color: rgb(0, 0, 0); font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">}  </span></li><li style="margin-top: 8px; margin-left: 40px; box-sizing: border-box; list-style-type: decimal; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px 3px 0px 10px !important; list-style-position: outside !important;"><span style="box-sizing: border-box; border: none; font-size: 12px; color: rgb(0, 0, 0); font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">do things once per ten seconds  </span></li><li style="margin-top: 8px; margin-left: 40px; box-sizing: border-box; list-style-type: decimal; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px 3px 0px 10px !important; list-style-position: outside !important;"><span style="box-sizing: border-box; border: none; font-size: 12px; color: rgb(0, 0, 0); font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">goto loop;  </span></li><li style="margin-top: 8px; margin-left: 40px; box-sizing: border-box; list-style-type: decimal; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px 3px 0px 10px !important; list-style-position: outside !important;"><span style="box-sizing: border-box; border: none; font-size: 12px; color: rgb(0, 0, 0); font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">}  </span></li></ol></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><br style="box-sizing: border-box;"/></div><div><span style="font-size: 16px; color: rgb(69, 69, 69); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;">其中每秒一次的操作包括：</span></div></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box;">刷新日志缓冲区（总是）</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box;">合并插入缓冲（可能）</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box;">至多刷新100个脏数据页（可能）</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box;">如果没有当前用户活动，切换至background loop （可能）</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box;">和Oracle类似，即使事务未提交，也会每秒刷新重做日志缓冲区。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><br style="box-sizing: border-box;"/></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box;">其中每10秒一次的操作包括：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box;">合并至多5个插入缓冲（总是）</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box;">刷新日志缓冲（总是）</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box;">刷新100个或10个脏页到磁盘（总是）</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box;">产生一个检查点（总是）</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box;">删除无用Undo 页 （总是）</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><br style="box-sizing: border-box;"/></div></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box;">接着来看后台循环，若当前没有用户活动或数据库关闭时，会切换至该循环执行以下操作：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box;">删除无用的undo页（总是）</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box;">合并20个插入缓冲（总是）</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box;">跳回到主循环（总是）</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box;">不断刷新100个页，直到符合条件跳转到flush loop（可能）</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box;"><span style="box-sizing: border-box;">如果flush loop中也没有什么事情可做，边切换到suspend loop，将master线程挂起。</span></div></div><div><br/></div></div></span>
</div></body></html> 