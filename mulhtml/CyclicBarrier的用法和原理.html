<html>
<head>
  <title>CyclicBarrier的用法和原理</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1615"/>
<h1>CyclicBarrier的用法和原理</h1>

<div>
<span><div><b><font style="color: rgb(20, 113, 145); font-size: 18pt;">CyclicBarrier的用法</font></b></div><div><font style="font-size: 12pt;">CyclicBarrier是可重用的屏障，也称栅栏。</font></div><div style="margin: 10px 0px; padding: 3px 0px 0px; font-weight: bold; box-sizing: border-box; color: rgb(69, 69, 69); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border-width: 0px 0px 1px; border-bottom-style: solid; border-bottom-color: rgb(222, 223, 225); font-size: 20px; line-height: 30px; font-family: &quot;Courier New&quot;, 宋体, Consolas, &quot;YaHei Consolas Hybrid&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, Courier, monospace;"><span style="font-weight: bold; box-sizing: border-box; color: rgb(69, 69, 69); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border-width: 0px 0px 1px; border-bottom-style: solid; border-bottom-color: rgb(222, 223, 225); font-size: 20px; line-height: 30px; font-family: &quot;Courier New&quot;, 宋体, Consolas, &quot;YaHei Consolas Hybrid&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, Courier, monospace;">1、类说明：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); line-height: 23px; min-height: 26px; text-align: justify; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border: 0px; text-indent: 2em; font-family: &quot;Courier New&quot;, 宋体, Consolas, &quot;YaHei Consolas Hybrid&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, Courier, monospace;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); line-height: 23px; min-height: 26px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border: 0px; text-indent: 2em; font-family: &quot;Courier New&quot;, 宋体, Consolas, &quot;YaHei Consolas Hybrid&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, Courier, monospace;">一个同步辅助类，它允许一组线程互相等待，直到到达某个公共屏障点 (common barrier point)。在涉及一组固定大小的线程的程序中，这些线程必须不时地互相等待，此时 CyclicBarrier 很有用。因为该 barrier 在释放等待线程后可以重用，所以称它为循环 的 barrier。</span></div><div style="margin: 10px 0px; padding: 3px 0px 0px; font-weight: bold; box-sizing: border-box; color: rgb(69, 69, 69); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border-width: 0px 0px 1px; border-bottom-style: solid; border-bottom-color: rgb(222, 223, 225); font-size: 20px; line-height: 30px; font-family: &quot;Courier New&quot;, 宋体, Consolas, &quot;YaHei Consolas Hybrid&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, Courier, monospace;"><span style="font-weight: bold; box-sizing: border-box; color: rgb(69, 69, 69); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border-width: 0px 0px 1px; border-bottom-style: solid; border-bottom-color: rgb(222, 223, 225); font-size: 20px; line-height: 30px; font-family: &quot;Courier New&quot;, 宋体, Consolas, &quot;YaHei Consolas Hybrid&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, Courier, monospace;">2、使用场景：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); line-height: 23px; min-height: 26px; text-align: justify; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border: 0px; text-indent: 2em; font-family: &quot;Courier New&quot;, 宋体, Consolas, &quot;YaHei Consolas Hybrid&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, Courier, monospace;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); line-height: 23px; min-height: 26px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border: 0px; text-indent: 2em; font-family: &quot;Courier New&quot;, 宋体, Consolas, &quot;YaHei Consolas Hybrid&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, Courier, monospace;">需要所有的子任务都完成时，才执行主任务，这个时候就可以选择使用CyclicBarrier。</span></div><div style="margin: 10px 0px; padding: 3px 0px 0px; font-weight: bold; box-sizing: border-box; color: rgb(69, 69, 69); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border-width: 0px 0px 1px; border-bottom-style: solid; border-bottom-color: rgb(222, 223, 225); font-size: 20px; line-height: 30px; font-family: &quot;Courier New&quot;, 宋体, Consolas, &quot;YaHei Consolas Hybrid&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, Courier, monospace;"><span style="font-weight: bold; box-sizing: border-box; color: rgb(69, 69, 69); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border-width: 0px 0px 1px; border-bottom-style: solid; border-bottom-color: rgb(222, 223, 225); font-size: 20px; line-height: 30px; font-family: &quot;Courier New&quot;, 宋体, Consolas, &quot;YaHei Consolas Hybrid&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, Courier, monospace;">3、常用方法：</span></div><div style="margin: 0px 8px 10px 40px; padding: 10px 20px; box-sizing: border-box; color: rgb(69, 69, 69); font-size: 16px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border: 0px; background-color: rgb(246, 246, 246); overflow: auto; font-family: &quot;Courier New&quot;, 宋体, Consolas, &quot;YaHei Consolas Hybrid&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, Courier, monospace; line-height: 23px;"><h3 style="font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; margin: 0px; padding: 0px; font-weight: bold; box-sizing: border-box; color: rgb(79, 79, 79); font-size: 12px; line-height: 30px; border: 0px;"><span style="font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-weight: bold; box-sizing: border-box; color: rgb(79, 79, 79); font-size: 12px; line-height: 30px; border: 0px;">await</span></h3><div style="margin: 0px 0px 24px; padding: 0px; box-sizing: border-box; background-color: rgb(240, 240, 240); font-family: Consolas, Inconsolata, Courier, monospace; font-size: 14px; line-height: 22px; color: rgb(0, 0, 0);"><div>public int <span style="font-weight: bold; box-sizing: border-box;">await</span>()</div><div>throws <span style="color: rgb(1, 150, 227); outline: 0px; box-sizing: border-box;" title="java.lang 中的类">InterruptedException</span>,</div><div><span style="color: rgb(1, 150, 227); outline: 0px; box-sizing: border-box;" title="java.util.concurrent 中的类">BrokenBarrierException</span></div></div><dl style="margin: 24px; padding: 0px; box-sizing: border-box; list-style: none;"><dd style="margin: 0px 0px 8px 40px; padding: 0px; font-weight: 400; box-sizing: border-box; list-style: none;"></dd><dd>在所有<a style="color: rgb(1, 150, 227); outline: 0px; margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; text-decoration: none;" target="_blank">参与者</a>都已经在此 barrier 上调用 <tt style="box-sizing: border-box;">await</tt>方法之前，将一直等待。如果当前线程不是将到达的最后一个线程，出于调度目的，将禁用它，且在发生以下情况之一前，该线程将一直处于休眠状态：</dd><dd><div style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; border: 0px; background-color: transparent;"></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box;">最后一个线程到达；或者</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box;">其他某个线程</span><span style="box-sizing: border-box; color: rgb(1, 150, 227); outline: 0px;">中断</span><span style="box-sizing: border-box;">当前线程；或者</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box;">其他某个线程</span><span style="box-sizing: border-box; color: rgb(1, 150, 227); outline: 0px;">中断</span><span style="box-sizing: border-box;">另一个等待线程；或者</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box;">其他某个线程在等待 barrier 时超时；或者</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box;">其他某个线程在此 barrier 上调用 </span><span style="box-sizing: border-box; color: rgb(199, 37, 78); outline: 0px; font-family: Consolas, Inconsolata, Courier, monospace; font-size: 14px; line-height: 22px; background-color: rgb(249, 242, 244); border-radius: 4px;">reset()</span><span style="box-sizing: border-box;">。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; border: 0px;"><span style="box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; border: 0px;">如果当前线程：</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box;">在进入此方法时已经设置了该线程的中断状态；或者</span></div><div style="margin: 8px 0px 0px 32px; padding: 0px; box-sizing: border-box; list-style: disc;"><span style="box-sizing: border-box;">在等待时被</span><span style="box-sizing: border-box; color: rgb(1, 150, 227); outline: 0px;">中断</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; border: 0px;"><span style="box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; border: 0px;">则抛出 </span><span style="box-sizing: border-box; font-size: 14px; color: rgb(199, 37, 78); line-height: 22px; min-height: 26px; border: 0px; background-color: rgb(249, 242, 244); outline: 0px; font-family: Consolas, Inconsolata, Courier, monospace; border-radius: 4px;" title="java.lang 中的类">InterruptedException</span><span style="box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; border: 0px;">，并且清除当前线程的已中断状态。如果在线程处于等待状态时 barrier 被 </span><span style="box-sizing: border-box; font-size: 14px; color: rgb(199, 37, 78); line-height: 22px; min-height: 26px; border: 0px; background-color: rgb(249, 242, 244); outline: 0px; font-family: Consolas, Inconsolata, Courier, monospace; border-radius: 4px;">reset()</span><span style="box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; border: 0px;">，或者在调用 </span><span style="box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; border: 0px;">await</span><span style="box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; border: 0px;"> 时 barrier </span><span style="box-sizing: border-box; font-size: 16px; color: rgb(1, 150, 227); line-height: 26px; min-height: 26px; border: 0px; outline: 0px;">被损坏</span><span style="box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; border: 0px;">，抑或任意一个线程正处于等待状态，则抛出 </span><span style="box-sizing: border-box; font-size: 14px; color: rgb(199, 37, 78); line-height: 22px; min-height: 26px; border: 0px; background-color: rgb(249, 242, 244); outline: 0px; font-family: Consolas, Inconsolata, Courier, monospace; border-radius: 4px;" title="java.util.concurrent 中的类">BrokenBarrierException</span><span style="box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; border: 0px;"> 异常。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; border: 0px;"><span style="box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; border: 0px;">如果任何线程在等待时被 </span><span style="box-sizing: border-box; font-size: 16px; color: rgb(1, 150, 227); line-height: 26px; min-height: 26px; border: 0px; outline: 0px;">中断</span><span style="box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; border: 0px;">，则其他所有等待线程都将抛出 </span><span style="box-sizing: border-box; font-size: 14px; color: rgb(199, 37, 78); line-height: 22px; min-height: 26px; border: 0px; background-color: rgb(249, 242, 244); outline: 0px; font-family: Consolas, Inconsolata, Courier, monospace; border-radius: 4px;" title="java.util.concurrent 中的类">BrokenBarrierException</span><span style="box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; border: 0px;"> 异常，并将 barrier 置于损坏状态。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; border: 0px;"><span style="box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; border: 0px;">如果当前线程是最后一个将要到达的线程，并且构造方法中提供了一个非空的屏障操作，则在允许其他线程继续运行之前，当前线程将运行该操作。如果在执行屏障操作过程中发生异常，则该异常将传播到当前线程中，并将 barrier 置于损坏状态。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; text-align: justify; border: 0px;"><span style="box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; min-height: 26px; border: 0px;"> </span></div></dd><dd style="margin: 0px 0px 8px 40px; padding: 0px; font-weight: 400; box-sizing: border-box; list-style: none;"><dl style="margin: 24px; padding: 0px; font-weight: 400; box-sizing: border-box; list-style: none;"><dt style="margin: 8px; padding: 0px; font-weight: 700; box-sizing: border-box; list-style: none;"><strong style="box-sizing: border-box; font-weight: 700;">返回：</strong></dt><dd style="margin: 0px 0px 8px 40px; padding: 0px; font-weight: 400; box-sizing: border-box; list-style: none;">到达的当前线程的索引，其中，索引 <tt style="box-sizing: border-box;"><a style="color: rgb(1, 150, 227); outline: 0px; margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; text-decoration: none;" target="_blank"><code style="box-sizing: border-box; font-family: Consolas, Inconsolata, Courier, monospace; font-size: 14px; line-height: 22px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 4px;">getParties()</code></a> - 1</tt> 指示将到达的第一个线程，零指示最后一个到达的线程</dd><dt style="margin: 8px; padding: 0px; font-weight: 700; box-sizing: border-box; list-style: none;"><strong style="box-sizing: border-box; font-weight: 700;">抛出：</strong></dt><dd style="margin: 0px 0px 8px 40px; padding: 0px; font-weight: 400; box-sizing: border-box; list-style: none;"><code style="box-sizing: border-box; font-family: Consolas, Inconsolata, Courier, monospace; font-size: 14px; line-height: 22px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 4px;"><a style="color: rgb(1, 150, 227); outline: 0px; margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; text-decoration: none;" target="_blank" title="java.lang 中的类">InterruptedException</a></code> - 如果当前线程在等待时被中断</dd><dd style="margin: 0px 0px 8px 40px; padding: 0px; font-weight: 400; box-sizing: border-box; list-style: none;"><code style="box-sizing: border-box; font-family: Consolas, Inconsolata, Courier, monospace; font-size: 14px; line-height: 22px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 4px;"><a style="color: rgb(1, 150, 227); outline: 0px; margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; text-decoration: none;" target="_blank" title="java.util.concurrent 中的类">BrokenBarrierException</a></code> - 如果<em style="font-style: italic; box-sizing: border-box;">另一个</em> 线程在当前线程等待时被中断或超时，或者重置了 barrier，或者在调用 <code style="box-sizing: border-box; font-family: Consolas, Inconsolata, Courier, monospace; font-size: 14px; line-height: 22px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 4px;">await</code> 时 barrier 被损坏，抑或由于异常而导致屏障操作（如果存在）失败。</dd></dl></dd></dl></div><div style="margin: 10px 0px; padding: 3px 0px 0px; font-weight: bold; box-sizing: border-box; color: rgb(69, 69, 69); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border-width: 0px 0px 1px; border-bottom-style: solid; border-bottom-color: rgb(222, 223, 225); font-size: 20px; line-height: 30px; font-family: &quot;Courier New&quot;, 宋体, Consolas, &quot;YaHei Consolas Hybrid&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, Courier, monospace;"><span style="font-weight: bold; box-sizing: border-box; color: rgb(69, 69, 69); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border-width: 0px 0px 1px; border-bottom-style: solid; border-bottom-color: rgb(222, 223, 225); font-size: 20px; line-height: 30px; font-family: &quot;Courier New&quot;, 宋体, Consolas, &quot;YaHei Consolas Hybrid&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, Courier, monospace;">4、相关实例</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); line-height: 23px; min-height: 26px; text-align: justify; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border: 0px; text-indent: 2em; font-family: &quot;Courier New&quot;, 宋体, Consolas, &quot;YaHei Consolas Hybrid&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, Courier, monospace;"><span style="box-sizing: border-box; font-size: 14px; color: rgb(79, 79, 79); line-height: 23px; min-height: 26px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border: 0px; text-indent: 2em; font-family: &quot;Courier New&quot;, 宋体, Consolas, &quot;YaHei Consolas Hybrid&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, Courier, monospace;">赛跑时，等待所有人都准备好时，才起跑：</span></div><div style="margin: 0px 0px 24px; padding: 0px; box-sizing: border-box; background-color: rgb(240, 240, 240); font-family: &quot;Courier New&quot;, Consolas, &quot;YaHei Consolas Hybrid&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, Courier, monospace; font-size: 14px; line-height: 18px; color: rgb(0, 0, 0);"></div><div style="margin: 0px 0px 24px; padding: 1px 0px 0px; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-size: 12px; background-color: rgb(231, 229, 220); width: 833.578px; text-align: left;"><div style="margin: 0px; padding: 0px 0px 0px 45px; box-sizing: border-box;"><div style="margin: 0px; padding: 3px 8px 10px 10px; box-sizing: border-box; font-variant: normal; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; background-color: rgb(248, 248, 248); border-left: 3px solid rgb(108, 226, 108); border-right: 1px solid rgb(231, 229, 220);"><div><span style="font-weight: bold; box-sizing: border-box;">[java]</span> <a href="http://blog.csdn.net/shihuacai/article/details/8856407#" style="color: rgb(103, 149, 181); outline: 0px; box-sizing: border-box; background-image: url(&quot;//csdnimg.cn/release/phoenix/images/ico_plain.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px;" title="view plain">view plain</a><span style="box-sizing: border-box;"> </span><a href="http://blog.csdn.net/shihuacai/article/details/8856407#" style="box-sizing: border-box; color: rgb(103, 149, 181); outline: 0px; background-image: url(&quot;//csdnimg.cn/release/phoenix/images/ico_copy.gif&quot;); background-position: left top; background-repeat: no-repeat; border: none; font-size: 9px; width: 16px; height: 16px; text-indent: -2000px;" title="copy">copy</a></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; position: absolute; left: 345px; top: 1564px; width: 16px; height: 16px; z-index: 99;"></div></div></div><ol start="1" style="margin: 0px 0px 24px; padding: 0px; box-sizing: border-box; list-style: decimal; border-top: none; border-right: 1px solid rgb(231, 229, 220); border-bottom: none; border-left: none; background-color: rgb(255, 255, 255); color: rgb(92, 92, 92);"><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> </span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">class</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> CyclicBarrierTest {  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">    </span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> </span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">static</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> </span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">void</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> main(String[] args) </span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">throws</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> IOException, InterruptedException {  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">        </span><span style="box-sizing: border-box; border: none; color: rgb(0, 130, 0);">//如果将参数改为4，但是下面只加入了3个选手，这永远等待下去</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">        </span><span style="box-sizing: border-box; border: none; color: rgb(0, 130, 0);">//Waits until all parties have invoked await on this barrier. </span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">        CyclicBarrier barrier = </span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">new</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> CyclicBarrier(</span><span style="box-sizing: border-box; border: none; color: rgb(192, 0, 0);">3</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">);  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">        ExecutorService executor = Executors.newFixedThreadPool(</span><span style="box-sizing: border-box; border: none; color: rgb(192, 0, 0);">3</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">);  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">        executor.submit(</span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">new</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> Thread(</span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">new</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> Runner(barrier, </span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 255);">&quot;1号选手&quot;</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">)));  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">        executor.submit(</span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">new</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> Thread(</span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">new</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> Runner(barrier, </span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 255);">&quot;2号选手&quot;</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">)));  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">        executor.submit(</span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">new</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> Thread(</span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">new</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> Runner(barrier, </span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 255);">&quot;3号选手&quot;</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">)));  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">        executor.shutdown();  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">    }  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">}  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">class</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> Runner </span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">implements</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> Runnable {  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">    </span><span style="box-sizing: border-box; border: none; color: rgb(0, 130, 0);">// 一个同步辅助类，它允许一组线程互相等待，直到到达某个公共屏障点 (common barrier point)</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">    </span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">private</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> CyclicBarrier barrier;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">    </span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">private</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> String name;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">    </span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> Runner(CyclicBarrier barrier, String name) {  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">        </span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">super</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">();  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">        </span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">this</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">.barrier = barrier;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">        </span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">this</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">.name = name;  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">    }  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">    </span><span style="box-sizing: border-box; border: none; color: rgb(100, 100, 100);">@Override</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">    </span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">public</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> </span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">void</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> run() {  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">        </span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">try</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> {  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">            Thread.sleep(</span><span style="box-sizing: border-box; border: none; color: rgb(192, 0, 0);">1000</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> * (</span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">new</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> Random()).nextInt(</span><span style="box-sizing: border-box; border: none; color: rgb(192, 0, 0);">8</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">));  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">            System.out.println(name + </span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 255);">&quot; 准备好了...&quot;</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">);  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">            </span><span style="box-sizing: border-box; border: none; color: rgb(0, 130, 0);">// barrier的await方法，在所有参与者都已经在此 barrier 上调用 await 方法之前，将一直等待。</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">            barrier.await();  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">        } </span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">catch</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> (InterruptedException e) {  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">            e.printStackTrace();  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">        } </span><span style="font-weight: bold; box-sizing: border-box; border: none; color: rgb(0, 102, 153); font-size: 14px; border-radius: 2px; word-wrap: normal;">catch</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);"> (BrokenBarrierException e) {  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">            e.printStackTrace();  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">        }  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">        System.out.println(name + </span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 255);">&quot; 起跑！&quot;</span><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">);  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(248, 248, 248); color: rgb(92, 92, 92); line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">    }  </span></li><li style="margin-top: 8px; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 40px; padding: 0px 3px 0px 10px !important; font-weight: 400; box-sizing: border-box; list-style-type: decimal; list-style-position: outside !important; list-style-image: initial; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(108, 226, 108); border-image: initial; background-color: rgb(255, 255, 255); color: inherit; line-height: 18px;"><span style="box-sizing: border-box; border: none; color: rgb(0, 0, 0);">}  </span></li></ol></div><div><br style="box-sizing: border-box;"/></div><div><br style="box-sizing: border-box;"/></div><div style="margin: 0px 0px 24px; padding: 0px; box-sizing: border-box; background-color: rgb(240, 240, 240); font-family: &quot;Courier New&quot;, Consolas, &quot;YaHei Consolas Hybrid&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, Courier, monospace; font-size: 14px; line-height: 18px; color: rgb(0, 0, 0);"><span style="box-sizing: border-box; background-color: rgb(240, 240, 240); font-family: &quot;Courier New&quot;, Consolas, &quot;YaHei Consolas Hybrid&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, Courier, monospace; font-size: 14px; line-height: 18px; color: rgb(0, 0, 0);">输出结果：</span></div><div style="margin: 0px 0px 24px; padding: 0px; box-sizing: border-box; background-color: rgb(240, 240, 240); font-family: &quot;Courier New&quot;, Consolas, &quot;YaHei Consolas Hybrid&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, Courier, monospace; font-size: 14px; line-height: 18px; color: rgb(0, 0, 0);"><div>3号选手 准备好了...</div><div>2号选手 准备好了...</div><div>1号选手 准备好了...</div><div>1号选手 起跑！</div><div>2号选手 起跑！</div><div>3号选手 起跑！</div></div><div style="margin: 0px 0px 24px; padding: 0px; box-sizing: border-box; background-color: rgb(240, 240, 240); font-family: &quot;Courier New&quot;, Consolas, &quot;YaHei Consolas Hybrid&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, Courier, monospace; font-size: 14px; line-height: 18px; color: rgb(0, 0, 0);"><span style="box-sizing: border-box; background-color: rgb(240, 240, 240); font-family: &quot;Courier New&quot;, Consolas, &quot;YaHei Consolas Hybrid&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, Courier, monospace; font-size: 14px; line-height: 18px; color: rgb(0, 0, 0);">转载地址：</span><span style="box-sizing: border-box; background-color: rgb(240, 240, 240); font-family: &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, &quot;Lucida Grande&quot;, Tahoma, sans-serif; font-size: 12px; line-height: 20px; color: rgb(1, 150, 227);"><a href="http://www.itzhai.com/the-introduction-and-use-of-cyclicbarrier.html">http://www.itzhai.com/the-introduction-and-use-of-cyclicbarrier.html</a></span></div><div><br/></div><div><b><font color="#147191" style="font-size: 18pt;"><br/></font></b></div><div><b><font color="#147191" style="font-size: 18pt;">CyclicBarrier源码解析</font></b></div><div><font color="#147191"><span style="font-size: 16px;">CyclicBarrier基于ReetrantLock和Condtion</span></font></div><div><font color="#147191"><span style="font-size: 16px;">源码如下：</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * A synchronization aid that allows a set of threads to all wait for</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * each other to reach a common barrier point.  CyclicBarriers are</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * useful in programs involving a fixed sized party of threads that</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * must occasionally wait for each other. The barrier is called</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;em&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">cyclic</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/em&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">because it can be re</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">used after the waiting threads</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * are released.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">A {@code CyclicBarrier} supports an optional</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link Runnable}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">command</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * that is run once per barrier point, after the last thread in the party</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * arrives, but before any threads are released.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * This</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;em&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">barrier action</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/em&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">is useful</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * for updating shared</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">state before any of the parties continue.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;&lt;b&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Sample usage:</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/b&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Here is an example of using a barrier in a</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * parallel decomposition design:</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;pre&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">{@code</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * class Solver {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *   final int N;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *   final float[][] data;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *   final CyclicBarrier barrier;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *   class Worker implements Runnable {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *     int myRow;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *     Worker(int row) { myRow = row; }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *     public void run() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *       while (!done()) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *         processRow(myRow);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *         try {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *           barrier.await();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *         } catch (InterruptedException ex) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *           return;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *         } catch (BrokenBarrierException ex) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *           return;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *         }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *       }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *     }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *   }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *   public Solver(float[][] matrix) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *     data = matrix;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *     N = matrix.length;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *     Runnable barrierAction =</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *       new Runnable() { public void run() { mergeRows(...); }};</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *     barrier = new CyclicBarrier(N, barrierAction);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *     List</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;Thread&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">threads = new ArrayList</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;Thread&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">(N);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *     for (int i = 0; i &lt; N; i++) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *       Thread thread = new Thread(new Worker(i));</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *       threads.add(thread);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *       thread.start();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *     }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *     // wait until done</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *     for (Thread thread : threads)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *       thread.join();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *   }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * }}</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/pre&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * Here, each worker thread processes a row of the matrix then waits at the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * barrier until all rows have been processed. When all rows are processed</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * the supplied</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link Runnable}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">barrier action is executed and merges the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * rows. If the merger</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * determines that a solution has been found then {@code done()} will return</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * {@code true} and each worker will terminate.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">If the barrier action does not rely on the parties being suspended when</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * it is executed, then any of the threads in the party could execute that</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * action when it is released. To facilitate this, each invocation of</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link #await}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">returns the arrival index of that thread at the barrier.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * You can then choose which thread should execute the barrier action, for</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * example:</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;pre&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">{@code</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * if (barrier.await() == 0) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *   // log the completion of this iteration</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * }}</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/pre&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">The {@code CyclicBarrier} uses an all</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">or</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">none breakage model</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * for failed synchronization attempts: If a thread leaves a barrier</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * point prematurely because of interruption, failure, or timeout, all</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * other threads waiting at that barrier point will also leave</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * abnormally via</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link BrokenBarrierException}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">(or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link InterruptedException}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">if they too were interrupted at about</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * the same time).</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Memory consistency effects: Actions in a thread prior to calling</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * {@code await()}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * &lt;a href=&quot;package-summary.html#MemoryVisibility&quot;&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;i&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">happen</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">before</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/i&gt;&lt;/a&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * actions that are part of the barrier action, which in turn</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;i&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">happen</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">before</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/i&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">actions following a successful return from the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> * corresponding {@code await()} in other threads.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@since</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">1.5</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@see</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">CountDownLatch</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@author</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Doug Lea</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;"> */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">class</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">CyclicBarrier {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Each use of the barrier is represented as a generation instance.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * The generation changes whenever the barrier is tripped, or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * is reset. There can be many generations associated with threads</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * using the barrier</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">due to the non</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">deterministic way the lock</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * may be allocated to waiting threads</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">but only one of these</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * can be active at a time (the one to which {@code count} applies)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * and all the rest are either broken or tripped.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * There need not be an active generation if there has been a break</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * but no subsequent reset.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">static</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">class</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Generation {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">boolean</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">broken</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">false</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/** The lock for guarding barrier entry */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ReentrantLock</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">lock</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ReentrantLock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/** Condition to wait on until tripped */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Condition</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">trip</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">lock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.newCondition();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/** The number of parties */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">parties</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">/* The command to run when tripped */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Runnable</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">barrierCommand</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/** The current generation */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Generation</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">generation</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Generation();</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Number of parties still waiting. Counts down from parties to 0</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * on each generation.  It is reset to parties on each new</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * generation or when broken.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Updates state on barrier trip and wakes up everyone.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Called only while holding lock.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">void</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">nextGeneration() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// signal completion of last generation</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">trip</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; background: #d4d4d4; color: rgb(51, 51, 51);">signalAll</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// set up next generation</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">parties</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">generation</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Generation();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Sets current barrier generation as broken and wakes up everyone.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Called only while holding lock.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">void</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">breakBarrier() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">generation</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">broken</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">true</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">parties</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">trip</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; background: #d4d4d4; color: rgb(51, 51, 51);">signalAll</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Main barrier code, covering the various policies.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">private</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">dowait(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">boolean</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">timed</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">long</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">nanos</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throws</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">InterruptedException, BrokenBarrierException,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               TimeoutException {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ReentrantLock</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">lock</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">lock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">lock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.lock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Generation</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">g</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">generation</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">g</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">broken</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">BrokenBarrierException();</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(Thread.</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; font-style: italic; color: rgb(51, 51, 51);">interrupted</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">()) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                breakBarrier();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">InterruptedException();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">index</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">= --</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">index</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">== 0) { </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// tripped</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">boolean</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ranAction</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">false</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Runnable</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">command</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">barrierCommand</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">command</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">command</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.run();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ranAction</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">true</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                    nextGeneration();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">0;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(!</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ranAction</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                        breakBarrier();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// loop until tripped, broken, interrupted, or timed out</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">for</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(;;) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(!</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">timed</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">trip</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.await();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">else</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">nanos</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&gt; 0L)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">nanos</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">trip</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.awaitNanos(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">nanos</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">catch</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(InterruptedException</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ie</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">g</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">==</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">generation</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&amp;&amp; !</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">g</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">broken</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                        breakBarrier();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">ie</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                    }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">else</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// We're about to finish waiting even if we had not</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// been interrupted, so this interrupt is deemed to</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// &quot;belong&quot; to subsequent execution.</span></div><div style="min-height: 11pt;"><span style="min-height: 11pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                        Thread.</span><span style="min-height: 11pt; font-family: Consolas; font-size: 14pt; font-style: italic; color: rgb(51, 51, 51);">currentThread</span><span style="min-height: 11pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">().interrupt();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                    }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">g</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">broken</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">BrokenBarrierException();</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">g</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">!=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">generation</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">index</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">timed</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&amp;&amp;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">nanos</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;= 0L) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                    breakBarrier();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">TimeoutException();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">                }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">lock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.unlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Creates a new {@code CyclicBarrier} that will trip when the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * given number of parties (threads) are waiting upon it, and which</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * will execute the given barrier action when the barrier is tripped,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * performed by the last thread entering the barrier.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">parties the number of threads that must invoke</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link #await}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *        before the barrier is tripped</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">barrierAction the command to execute when the barrier is</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *        tripped, or {@code null} if there is no action</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">IllegalArgumentException if {@code parties} is less than 1</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">CyclicBarrier(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">parties</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">, Runnable</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">barrierAction</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">if</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">parties</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">&lt;= 0)</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">IllegalArgumentException();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">parties</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">parties</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">parties</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">barrierCommand</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">barrierAction</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Creates a new {@code CyclicBarrier} that will trip when the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * given number of parties (threads) are waiting upon it, and</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * does not perform a predefined action when the barrier is tripped.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">parties the number of threads that must invoke</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link #await}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *        before the barrier is tripped</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">IllegalArgumentException if {@code parties} is less than 1</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">CyclicBarrier(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">parties</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">parties</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">null</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Returns the number of parties required to trip this barrier.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">the number of parties required to trip this barrier</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">getParties() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">parties</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Waits until all</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@linkplain #getParties parties}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">have invoked</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * {@code await} on this barrier.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">If the current thread is not the last to arrive then it is</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * disabled for thread scheduling purposes and lies dormant until</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * one of the following things happens:</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;ul&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">The last thread arrives; or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Some other thread</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@linkplain Thread#interrupt interrupts}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * the current thread; or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Some other thread</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@linkplain Thread#interrupt interrupts}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * one of the other waiting threads; or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Some other thread times out while waiting for barrier; or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Some other thread invokes</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link #reset}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">on this barrier.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/ul&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">If the current thread:</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;ul&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">has its interrupted status set on entry to this method; or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">is</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@linkplain Thread#interrupt interrupted}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">while waiting</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/ul&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * then</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link InterruptedException}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">is thrown and the current thread's</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * interrupted status is cleared.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">If the barrier is</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link #reset}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">while any thread is waiting,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * or if the barrier</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@linkplain #isBroken is broken}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">when</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * {@code await} is invoked, or while any thread is waiting, then</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link BrokenBarrierException}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">is thrown.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">If any thread is</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@linkplain Thread#interrupt interrupted}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">while waiting,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * then all other waiting threads will throw</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link BrokenBarrierException}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">and the barrier is placed in the broken</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * state.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">If the current thread is the last thread to arrive, and a</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * non</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">null barrier action was supplied in the constructor, then the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * current thread runs the action before allowing the other threads to</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * continue.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * If an exception occurs during the barrier action then that exception</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * will be propagated in the current thread and the barrier is placed in</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * the broken state.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">the arrival index of the current thread, where index</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         {@code getParties() - 1} indicates the first</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         to arrive and zero indicates the last to arrive</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">InterruptedException if the current thread was interrupted</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         while waiting</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">BrokenBarrierException if</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;em&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">another</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/em&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">thread was</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         interrupted or timed out while the current thread was</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         waiting, or the barrier was reset, or the barrier was</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         broken when {@code await} was called, or the barrier</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         action (if present) failed due to an exception</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">await()</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throws</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">InterruptedException, BrokenBarrierException {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">dowait(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">false</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">, 0L);</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">catch</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">(TimeoutException</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">toe</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">) {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">new</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">Error(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">toe</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">);</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// cannot happen</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Waits until all</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@linkplain #getParties parties}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">have invoked</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * {@code await} on this barrier, or the specified waiting time elapses.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">If the current thread is not the last to arrive then it is</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * disabled for thread scheduling purposes and lies dormant until</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * one of the following things happens:</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;ul&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">The last thread arrives; or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">The specified timeout elapses; or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Some other thread</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@linkplain Thread#interrupt interrupts}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * the current thread; or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Some other thread</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@linkplain Thread#interrupt interrupts}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * one of the other waiting threads; or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Some other thread times out while waiting for barrier; or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">Some other thread invokes</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link #reset}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">on this barrier.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/ul&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">If the current thread:</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;ul&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">has its interrupted status set on entry to this method; or</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;li&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">is</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@linkplain Thread#interrupt interrupted}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">while waiting</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/ul&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * then</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link InterruptedException}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">is thrown and the current thread's</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * interrupted status is cleared.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">If the specified waiting time elapses then</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link TimeoutException}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * is thrown. If the time is less than or equal to zero, the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * method will not wait at all.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">If the barrier is</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link #reset}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">while any thread is waiting,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * or if the barrier</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@linkplain #isBroken is broken}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">when</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * {@code await} is invoked, or while any thread is waiting, then</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link BrokenBarrierException}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">is thrown.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">If any thread is</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@linkplain Thread#interrupt interrupted}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">while</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * waiting, then all other waiting threads will throw</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">     * BrokenBarrierException}</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">and the barrier is placed in the broken</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * state.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;p&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">If the current thread is the last thread to arrive, and a</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * non</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">null barrier action was supplied in the constructor, then the</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * current thread runs the action before allowing the other threads to</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * continue.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * If an exception occurs during the barrier action then that exception</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * will be propagated in the current thread and the barrier is placed in</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * the broken state.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">timeout the time to wait for the barrier</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@param</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">unit the time unit of the timeout parameter</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">the arrival index of the current thread, where index</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         {@code getParties() - 1} indicates the first</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         to arrive and zero indicates the last to arrive</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">InterruptedException if the current thread was interrupted</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         while waiting</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">TimeoutException if the specified timeout elapses.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         In this case the barrier will be broken.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@throws</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">BrokenBarrierException if</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;em&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">another</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/em&gt;</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">thread was</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         interrupted or timed out while the current thread was</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         waiting, or the barrier was reset, or the barrier was broken</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         when {@code await} was called, or the barrier action (if</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         present) failed due to an exception</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">await(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">long</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">timeout</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">, TimeUnit</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">unit</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">)</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">throws</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">InterruptedException,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               BrokenBarrierException,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">               TimeoutException {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">dowait(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">true</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">,</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">unit</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.toNanos(</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">timeout</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">));</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Queries if this barrier is in a broken state.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">{@code true} if one or more parties broke out of this</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         barrier due to interruption or timeout since</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         construction or the last reset, or a barrier action</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *         failed due to an exception; {@code false} otherwise.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">boolean</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">isBroken() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ReentrantLock</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">lock</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">lock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">lock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.lock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">generation</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">broken</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">lock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.unlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Resets the barrier to its initial state.  If any parties are</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * currently waiting at the barrier, they will return with a</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link BrokenBarrierException}</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">. Note that resets</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;em&gt;</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">after</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">&lt;/em&gt;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * a breakage has occurred for other reasons can be complicated to</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * carry out; threads need to re</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 127, 159); font-size: 14pt;">-</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">synchronize in some other way,</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * and choose one to perform the reset.  It may be preferable to</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * instead create a new barrier for subsequent use.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">void</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">reset() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ReentrantLock</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">lock</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">lock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">lock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.lock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            breakBarrier();  </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// break the current generation</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">            nextGeneration();</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 127, 95); font-size: 14pt;">// start a new generation</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">lock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.unlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">/**</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * Returns the number of parties currently waiting at the barrier.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     * This method is primarily useful for debugging and assertions.</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     *</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 159, 191); font-size: 14pt; font-weight: bold;">@return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">the number of parties currently blocked in</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 63, 191); font-size: 14pt;">{@link #await}</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; color: rgb(63, 95, 191); font-size: 14pt;">     */</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">   </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">public</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">int</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">getNumberWaiting() {</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">final</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">ReentrantLock</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">lock</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">=</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">this</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.</span><span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">lock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">lock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.lock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">       </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">try</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">return</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">parties</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">-</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(0, 0, 192); font-size: 14pt;">count</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">;</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(127, 0, 85); font-size: 14pt; font-weight: bold;">finally</span> <span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">{</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">           </span> <span style="min-height: 16pt; font-family: Consolas; color: rgb(106, 62, 62); font-size: 14pt;">lock</span><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">.unlock();</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">        }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">    }</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: Consolas; font-size: 14pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div></span>
</div></body></html> 