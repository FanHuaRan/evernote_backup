<html>
<head>
  <title>weakreference实现原理分析</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="337"/>
<h1>weakreference实现原理分析</h1>

<div>
<span><div><h2 style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">原文地址：<a href="http://blog.51cto.com/rockybalboa/813161" style="font-weight: bold; font-family: Helvetica Neue; font-size: 12pt; color: rgb(51, 51, 51);">http://blog.51cto.com/rockybalboa/813161</a></h2><h2 style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"> </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 26px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">前言</span></h2><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">若干年前看了Java的四种引用类型，只是简单知道了不同类型的作用，但对其实现原理一直未能想明白，本文尝试结合jdk，openjdk6的部分源码分析弱引用实现的原理，供大家参考，部分技术细节没有仔细研究，如有疑问欢迎留言讨论</span></div><h2 style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 26px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> 实例分析</span></h2><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">我们以WeakHashMap的处理过程为例介绍一个weak reference的生命周期，首先我们调用WeakHashMap的put方法放入对象到Map中，WeakHashMap的Entry继承了WeakReference</span></div><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </span></div><div style="font-family: &quot;Courier New&quot;, monospace; margin: 0px 0px 1em; padding: 0px; font-size: 16px; width: 823.672px; overflow: auto; background: rgb(247, 247, 247); max-width: 100%; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></div><ol style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 5px 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(20, 107, 0); list-style: decimal; background: rgb(247, 247, 247); color: rgb(92, 92, 92); max-width: 100%; font-size: 16px;"><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">private</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">static</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">class</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> Entry&lt;K,V&gt; </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">extends</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> WeakReference&lt;K&gt; </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">implements</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> Map.Entry&lt;K,V&gt; { </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">        </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">private</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> V value; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">        </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">private</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">final</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">int</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> hash; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">        </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">private</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> Entry&lt;K,V&gt; next; </span></li></ol><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">下面是put的部分代码</span></div><div style="font-family: &quot;Courier New&quot;, monospace; margin: 0px 0px 1em; padding: 0px; font-size: 16px; width: 823.672px; overflow: auto; background: rgb(247, 247, 247); max-width: 100%; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></div><ol style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 5px 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(20, 107, 0); list-style: decimal; background: rgb(247, 247, 247); color: rgb(92, 92, 92); max-width: 100%; font-size: 16px;"><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">Entry</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">&lt;</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">K</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">,V</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">&gt;</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: red; max-width: 100%; font-size: 16px;">e</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> = </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: blue; max-width: 100%; font-size: 16px;">tab</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">[i]; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">        tab[i] = new Entry</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">&lt;</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">K</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">,V</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">&gt;</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">(k, value, </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(255, 0, 0); max-width: 100%; font-size: 16px;">queue</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">, h, e); </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">        if (++size </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">&gt;</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">= threshold) </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">            resize(tab.length * 2); </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">        return null; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">    } </span></li></ol><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">注意new Entry传递了一个reference queue到构造函数中，此构造函数最终会调用Reference的构造函数</span></div><div style="font-family: &quot;Courier New&quot;, monospace; margin: 0px 0px 1em; padding: 0px; font-size: 16px; width: 823.672px; overflow: auto; background: rgb(247, 247, 247); max-width: 100%; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></div><ol style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 5px 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(20, 107, 0); list-style: decimal; background: rgb(247, 247, 247); color: rgb(92, 92, 92); max-width: 100%; font-size: 16px;"><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">Reference(T referent, ReferenceQueue</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">&lt;?</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">super</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> T</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">&gt;</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> queue) { </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">    </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: red; max-width: 100%; font-size: 16px;">this.referent</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> = referent; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">    </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: red; max-width: 100%; font-size: 16px;">this.queue</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> = (</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: red; max-width: 100%; font-size: 16px;">queue</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> == null) ? ReferenceQueue.NULL : queue; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">    } </span></li></ol><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">referent是我们之前传入的hashmap的key对象，queue的作用是用来读取referent被回收的weak reference，生产者是谁后续介绍，此时WeakHashMap中已经存在了一个对象，先将key对象的strong ref制空并尝试触发gc，比如使用System.gc()来显式的触发gc，然后调用WeakHashMap的size方法返回集合的个数，绝大多数情况下会是0，这个过程中发生了什么呢？</span></div><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">第一步，key没有可达的strong ref，仅仅存在一个weak reference的referent变量仍然指向了key，触发GC时，以openjdk6的parNew为例，jvm在young generation gc时会尝试获取Reference对象里的静态全局锁</span></div><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </span></div><div style="font-family: &quot;Courier New&quot;, monospace; margin: 0px 0px 1em; padding: 0px; font-size: 16px; width: 823.672px; overflow: auto; background: rgb(247, 247, 247); max-width: 100%; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></div><ol style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 5px 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(20, 107, 0); list-style: decimal; background: rgb(247, 247, 247); color: rgb(92, 92, 92); max-width: 100%; font-size: 16px;"><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 130, 0); max-width: 100%; font-size: 16px;">/* Object used to synchronize with the garbage collector.  The collector</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 130, 0); max-width: 100%; font-size: 16px;">     * must acquire this lock at the beginning of each collection cycle.  It is</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 130, 0); max-width: 100%; font-size: 16px;">     * therefore critical that any code holding this lock complete as quickly</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 130, 0); max-width: 100%; font-size: 16px;">     * as possible, allocate no new objects, and avoid calling user code.</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 130, 0); max-width: 100%; font-size: 16px;">     */</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">    </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">static</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">private</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">class</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> Lock { }; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">    </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">private</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">static</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> Lock lock = </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">new</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> Lock(); </span></li></ol><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">在openjdk6里的部分源代码,完整代码请参考instanceRefKlass.cpp文件</span></div><div style="font-family: &quot;Courier New&quot;, monospace; margin: 0px 0px 1em; padding: 0px; font-size: 16px; width: 823.672px; overflow: auto; background: rgb(247, 247, 247); max-width: 100%; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></div><ol style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 5px 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(20, 107, 0); list-style: decimal; background: rgb(247, 247, 247); color: rgb(92, 92, 92); max-width: 100%; font-size: 16px;"><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">void</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> instanceRefKlass::acquire_pending_list_lock(BasicLock *pending_list_basic_lock) { </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">  </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 130, 0); max-width: 100%; font-size: 16px;">// we may enter this with pending exception set</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">  PRESERVE_EXCEPTION_MARK;  </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 130, 0); max-width: 100%; font-size: 16px;">// exceptions are never thrown, needed for TRAPS argument</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">  Handle h_lock(THREAD, java_lang_ref_Reference::pending_list_lock()); </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">  ObjectSynchronizer::fast_enter(h_lock, pending_list_basic_lock, </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">false</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">, THREAD); </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">  assert(ObjectSynchronizer::current_thread_holds_lock( </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">           JavaThread::current(), h_lock), </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">         </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: blue; max-width: 100%; font-size: 16px;">&quot;Locking should have succeeded&quot;</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">); </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">  </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">if</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> (HAS_PENDING_EXCEPTION) CLEAR_PENDING_EXCEPTION; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">} </span></li></ol><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> 此处代码在parNew gc时执行，目的就是尝试获取全局锁，在gc完成后，jvm会将key被回收的weak reference组成一个queue并赋值到Reference的pending属性然后释放锁，参考方法：</span></div><div style="font-family: &quot;Courier New&quot;, monospace; margin: 0px 0px 1em; padding: 0px; font-size: 16px; width: 823.672px; overflow: auto; background: rgb(247, 247, 247); max-width: 100%; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></div><ol style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 5px 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(20, 107, 0); list-style: decimal; background: rgb(247, 247, 247); color: rgb(92, 92, 92); max-width: 100%; font-size: 16px;"><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">void</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> instanceRefKlass::release_and_notify_pending_list_lock( </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">  BasicLock *pending_list_basic_lock) { </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">  </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 130, 0); max-width: 100%; font-size: 16px;">// we may enter this with pending exception set</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">  PRESERVE_EXCEPTION_MARK;  </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 130, 0); max-width: 100%; font-size: 16px;">// exceptions are never thrown, needed for TRAPS argument</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">  </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 130, 0); max-width: 100%; font-size: 16px;">//</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">  Handle h_lock(THREAD, java_lang_ref_Reference::pending_list_lock()); </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">  assert(ObjectSynchronizer::current_thread_holds_lock( </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">           JavaThread::current(), h_lock), </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">         </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: blue; max-width: 100%; font-size: 16px;">&quot;Lock should be held&quot;</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">); </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">  </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 130, 0); max-width: 100%; font-size: 16px;">// Notify waiters on pending lists lock if there is any reference.</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">  </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">if</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> (java_lang_ref_Reference::pending_list() != NULL) { </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">    ObjectSynchronizer::notifyall(h_lock, THREAD); </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">  } </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">  ObjectSynchronizer::fast_exit(h_lock(), pending_list_basic_lock, THREAD); </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">  </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">if</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> (HAS_PENDING_EXCEPTION) CLEAR_PENDING_EXCEPTION; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">} </span></li></ol><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">在一次gc后，Reference对象的pending属性不再为空，让我们看看Reference的部分代码</span></div><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">首先是pending属性的说明：</span></div><div style="font-family: &quot;Courier New&quot;, monospace; margin: 0px 0px 1em; padding: 0px; font-size: 16px; width: 823.672px; overflow: auto; background: rgb(247, 247, 247); max-width: 100%; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></div><ol style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 5px 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(20, 107, 0); list-style: decimal; background: rgb(247, 247, 247); color: rgb(92, 92, 92); max-width: 100%; font-size: 16px;"><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 130, 0); max-width: 100%; font-size: 16px;">/* List of References waiting to be enqueued.  The collector adds</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 130, 0); max-width: 100%; font-size: 16px;"> * References to this list, while the Reference-handler thread removes</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 130, 0); max-width: 100%; font-size: 16px;"> * them.  This list is protected by the above lock object.</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 130, 0); max-width: 100%; font-size: 16px;"> */</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">private</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">static</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> Reference pending = </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">null</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">; </span></li></ol><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">接下来是Reference中的内部类ReferenceHandler，它继承了Thread，看看run方法的代码</span></div><div style="font-family: &quot;Courier New&quot;, monospace; margin: 0px 0px 1em; padding: 0px; font-size: 16px; width: 823.672px; overflow: auto; background: rgb(247, 247, 247); max-width: 100%; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></div><ol style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 5px 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(20, 107, 0); list-style: decimal; background: rgb(247, 247, 247); color: rgb(92, 92, 92); max-width: 100%; font-size: 16px;"><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">public</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">void</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> run() { </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">        </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">for</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> (;;) { </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">        Reference r; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">        </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">synchronized</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> (lock) { </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">            </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">if</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> (pending != </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">null</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">) { </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">            r = pending; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">            Reference rn = r.next; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">            </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(255, 0, 0); max-width: 100%; font-size: 16px;">pending = (rn == r) ? </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">null</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(255, 0, 0); max-width: 100%; font-size: 16px;"> : rn; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">            r.next = r; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">            } </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">else</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> { </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">            </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">try</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> { </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">                </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(255, 0, 0); max-width: 100%; font-size: 16px;">lock.wait(); </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">            } </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">catch</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> (InterruptedException x) { } </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">            </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">continue</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">            } </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">        } </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">        </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 130, 0); max-width: 100%; font-size: 16px;">// Fast path for cleaners</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">        </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">if</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> (r </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">instanceof</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> Cleaner) { </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">            ((Cleaner)r).clean(); </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">            </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">continue</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">        } </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">        </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(255, 0, 0); max-width: 100%; font-size: 16px;">ReferenceQueue q = r.queue; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(255, 0, 0); max-width: 100%; font-size: 16px;">        </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">if</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(255, 0, 0); max-width: 100%; font-size: 16px;"> (q != ReferenceQueue.NULL) q.enqueue(r); </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(255, 0, 0); max-width: 100%; font-size: 16px;">        } </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">    } </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">    } </span></li></ol><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">一旦jvm notify了前面提到的锁，这个线程就被激活并开始执行，作用是将之前jvm赋值过来的pending对象中的WeakReference对象enqueue到指定的队列中，比如WeakHashMap内部定义的ReferenceQueue属性</span></div><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">此时map的queue中保存了referent已经被回收的WeakReference队列，也就是map的Entry对象，当调用size方法时，内部首先调用expungStaleEntries方法清除被回收掉的Entry，代码如下</span></div><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </span></div><div style="font-family: &quot;Courier New&quot;, monospace; margin: 0px 0px 1em; padding: 0px; font-size: 16px; width: 823.672px; overflow: auto; background: rgb(247, 247, 247); max-width: 100%; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></div><ol style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 5px 0px; border-top: none; border-right: none; border-bottom: none; border-left: 3px solid rgb(20, 107, 0); list-style: decimal; background: rgb(247, 247, 247); color: rgb(92, 92, 92); max-width: 100%; font-size: 16px;"><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">private</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">void</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> expungeStaleEntries() { </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">    Entry&lt;K,V&gt; e; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">        </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">while</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> ( (e = (Entry&lt;K,V&gt;) queue.poll()) != </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">null</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">) { </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">            </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">int</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> h = e.hash; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">            </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">int</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> i = indexFor(h, table.length); </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">            Entry&lt;K,V&gt; prev = table[i]; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">            Entry&lt;K,V&gt; p = prev; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">            </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">while</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> (p != </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">null</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">) { </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">                Entry&lt;K,V&gt; next = p.next; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">                </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">if</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> (p == e) { </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">                    </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">if</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> (prev == e) </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">                        table[i] = next; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">                    </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">else</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">                        prev.next = next; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">                    e.next = </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">null</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">;  </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 130, 0); max-width: 100%; font-size: 16px;">// Help GC</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">                    e.value = </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">null</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">; </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 130, 0); max-width: 100%; font-size: 16px;">//  &quot;   &quot;</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;"> </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">                    size--; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">                    </span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: rgb(0, 102, 153); max-width: 100%; font-size: 16px; font-weight: bold;">break</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">                } </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">                prev = p; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">                p = next; </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">            } </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: rgb(92, 92, 92); line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">        } </span></li><li style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style-type: decimal-leading-zero; list-style-image: initial; color: inherit; line-height: 1.3em; list-style-position: outside !important; max-width: 100%; font-size: 16px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; border: none; color: black; max-width: 100%; font-size: 16px;">    } </span></li></ol><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">ok，就这样map的废弃Entry被clear，size返回为0</span></div><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">经过简单的测试程序发现：</span></div><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">一次gc未必能完全回收所有的weak ref</span></div><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">weak对象也可能会出现在old generation</span></div><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </span></div><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">参考：</span></div><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </span></div><div style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; margin: 0px; padding: 0px; max-width: 100%; font-size: 16px; color: rgb(51, 51, 51); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a href="http://weblogs.java.net/blog/2006/05/04/understanding-weak-references" style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(66, 133, 244); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">http://weblogs.java.net/blog/2006/05/04/understanding-weak-references</a></div><div><a href="http://weblogs.java.net/blog/2006/05/04/understanding-weak-references" style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, Arial, sans-serif; max-width: 100%; font-size: 16px; color: rgb(66, 133, 244); font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"> http://stackoverflow.com/questions/154724/when-would-you-use-a-weakhashmap-or-a-weakreference</a></div></div></span>
</div></body></html> 